slots:
  "0":
    name: receiver
    class: Receiver
    select: null
    type:
      events: []
      methods: []
  "1":
    name: spaceRadar
    class: RadarPVPUnit
    select: null
    type:
      events: []
      methods: []
  "2":
    name: atmoRadar
    class: RadarPVPUnit
    select: null
    type:
      events: []
      methods: []
  "-5":
    name: library
    class: null
    select: null
    type:
      events: []
      methods: []
  "-4":
    name: system
    class: null
    select: null
    type:
      events: []
      methods: []
  "-3":
    name: player
    class: null
    select: null
    type:
      events: []
      methods: []
  "-2":
    name: construct
    class: null
    select: null
    type:
      events: []
      methods: []
  "-1":
    name: unit
    class: null
    select: null
    type:
      events: []
      methods: []
handlers:
  - key: 1
    filter:
      slotKey: -5
      signature: onStart()
      args: []
    code: >-
      ;(function()

      local a={}local b=0;function library.addEventHandlers(c)if not c or c.onEvent and c.triggerEvent then return false end;b=b+1;a[b]=c;local d,e,f='table','function','thread'if d~=type(c)then error('You can only add event handlers to table objects!')end;local g={}local function h(c)local i=type(c)return e==i or d==i and h(getmetatable(c).__call)or f==i end;c.onEvent=function(self,j,k,l)if not h(k)then error('Event handler must be a function, a callable object or a thread!')end;l=l or self;if d~=type(l)then error('The value of self must be a table!')end;if not g[j]then g[j]={_=0}end;local m=f==type(k)and function(...)coroutine.resume(k,...)end or k;local k=g[j]local n=k._+1;k[n]={m,l}k._=n;return n end;c.clearEvent=function(self,j,o)if g[j]and g[j][o]then g[j][o]=nil end end;c.clearAllEvents=function(self)g={}end;c.triggerEvent=function(self,j,...)local p=g[j]if p then for q=1,p._ do local k=p[q]if k then k[1](k[2],...)end end end end;return true end;function library.clearAllEventHandlers()for q=1,b do local c=a[q]if c and c.clearAllEvents then c:clearAllEvents()end end end

      end)()
  - key: 2
    filter:
      slotKey: -5
      signature: onStart()
      args: []
    code: >-
      ;(function()

      local a=DULibrary or{}function a.getLinks(b,c)local d={}if not b then b={}end;for e,f in pairs(unit.getOutPlugs())do local g=unit[f.name]if'table'==type(g)and'function'==type(g.getClass)then local h=true;for i,j in pairs(b)do if not('function'==type(g[i])and j==g[i]():sub(1,#j))then h=false;break end end;if h then if c then table.insert(d,g)else d[f.name]=g end end end end;return d end;function a.getLinksByClass(k,c)return a.getLinks({getClass=k},c)end;function a.getLinkByClass(k)return a.getLinksByClass(k,true)[1]end;function a.getCoreUnit()return a.getLinkByClass('CoreUnit')end;function a.getLinkByName(l)local m=a.getCoreUnit()if not m then error('getLinkByName requires a linked CoreUnit to work')end;local d=a.getLinks()for n,o in pairs(d)do if l==m.getElementNameById(o.getLocalId())then return o end end end

      end)()
  - key: 3
    filter:
      slotKey: -5
      signature: onStart()
      args: []
    code: >-
      package.preload['YFS:../e/lib/src/input/Keys.lua']=(function()

      local a={}a.__index=a;a["lshift"]=1;a["lalt"]=2;a["brake"]=3;a["forward"]=4;a["backward"]=5;a["yawleft"]=6;a["yawright"]=7;a["strafeleft"]=8;a["straferight"]=9;a["left"]=10;a["right"]=11;a["up"]=12;a["down"]=13;a["groundaltitudeup"]=14;a["groundaltitudedown"]=15;a["gear"]=16;a["light"]=17;a["stopengines"]=18;a["speedup"]=19;a["speeddown"]=20;a["antigravity"]=21;a["booster"]=22;a["option0"]=23;a["option1"]=24;a["option2"]=25;a["option3"]=26;a["option4"]=27;a["option5"]=28;a["option6"]=29;a["option7"]=30;a["option8"]=31;a["option9"]=32;a["option10"]=33;a["option11"]=34;a["option12"]=35;a["option13"]=36;a["option14"]=37;a["option15"]=38;a["option16"]=39;a["option17"]=40;a["option18"]=41;a["option19"]=42;a["option20"]=43;a["option21"]=44;a["option22"]=45;a["option23"]=46;a["option24"]=47;a["option25"]=48;a["option26"]=49;a["option27"]=50;a["option28"]=51;a["option29"]=52;local b={}for c,d in pairs(a)do b[d]=c end;function a.Name(d)return b[d]or"unknown key"end;return setmetatable({},a)

      end)

      package.preload['YFS:../e/lib/src/input/Criteria.lua']=(function()

      local a=require('YFS:../e/lib/src/input/Keys.lua')local b={}b.__index=b;function b.New()local c={}local d={}local e={[a.lshift]=true,[a.brake]=true}local f=false;local g=false;local h=false;local i=false;function c.Matches(j,k,l)local m=h and not l;if not f and k then return false end;if l then for n,o in pairs(d)do if not j.IsPressed(o)then return false end end;for o,p in pairs(e)do if p and j.IsPressed(o)then return false end end;i=true end;if m then if not i then return false end;i=false end;return f and k or g and l or m end;function b.__tostring()local q=""for n,r in pairs(d)do q=q.." "..r end;return""..q end;function c.LShift()table.insert(d,a.lshift)e[a.lshift]=false;return c end;function c.LCtrl()table.insert(d,a.brake)e[a.brake]=false;return c end;function c.IgnoreLCtrl()e[a.brake]=false;return c end;function c.IgnoreLShift()e[a.lshift]=false;return c end;function c.OnPress()g=true;return c end;function c.OnRelease()h=true;return c end;function c.OnRepeat()f=true;return c end;return setmetatable(c,b)end;return b

      end)

      package.preload['YFS:../e/lib/src/math/Vec3.lua']=(function()

      local a=math.sqrt;local b=math.cos;local c=math.sin;local d=math.acos;local e=180/math.pi;local f={}f.__index=f;function f.New(g,h,i)local j={}if g and h and i then j.x=g;j.y=h;j.z=i elseif type(g)=="table"then j.x,j.y,j.z=g.x or g[1],g.y or g[2],g.z or g[3]elseif type(g)=="number"then j.x=g;j.y=g;j.z=g else j.x=0;j.y=0;j.z=0 end;return setmetatable(j,f)end;f.unit_x=f.New(1,0,0)f.unit_y=f.New(0,1,0)f.unit_z=f.New(0,0,1)f.zero=f.New(0,0,0)function f.Clone(k)return f.New(k.x,k.y,k.z)end;function f.Add(k,l)return f.New(k.x+l.x,k.y+l.y,k.z+l.z)end;function f.Sub(k,l)return f.New(k.x-l.x,k.y-l.y,k.z-l.z)end;function f.Mul(k,l)return f.New(k.x*l.x,k.y*l.y,k.z*l.z)end;function f.Div(k,l)return f.New(k.x/l.x,k.y/l.y,k.z/l.z)end;function f.Normalize(k)if k:IsZero()then return f.New()end;return k:Scale(1/k:Len())end;function f.NormalizeInPlace(k)if k:IsZero()then return k end;return k:ScaleInPlace(1/k:Len())end;function f.NormalizeLen(k)if k:IsZero()then return f.New(),0 end;local m=k:Len()return k:Scale(1/m),m end;function f.Trim(k,m)return k:Normalize():Scale(math.min(k:Len(),m))end;function f.TrimInPlace(k,m)return k:NormalizeInPlace():ScaleInPlace(math.min(k:Len(),m))end;function f.Cross(k,l)return f.New(k.y*l.z-k.z*l.y,k.z*l.x-k.x*l.z,k.x*l.y-k.y*l.x)end;function f.Dot(k,l)return k.x*l.x+k.y*l.y+k.z*l.z end;function f.Len(k)return a(k.x*k.x+k.y*k.y+k.z*k.z)end;function f.Len2(k)return k.x*k.x+k.y*k.y+k.z*k.z end;function f.Dist(k,l)local n=k.x-l.x;local o=k.y-l.y;local p=k.z-l.z;return a(n*n+o*o+p*p)end;function f.Dist2(k,l)local n=k.x-l.x;local o=k.y-l.y;local p=k.z-l.z;return n*n+o*o+p*p end;function f.Scale(k,l)return f.New(k):ScaleInPlace(l)end;function f.ScaleInPlace(k,l)k.x=k.x*l;k.y=k.y*l;k.z=k.z*l;return k end;function f.Rotate(k,q,r)if not f.IsVec3(r)then return k end;local s=r:Normalize()local t=b(q)local j=c(q)local u=f.New(t+s.x*s.x*(1-t),s.x*s.y*(1-t)-s.z*j,s.x*s.z*(1-t)+s.y*j)local v=f.New(s.y*s.x*(1-t)+s.z*j,t+s.y*s.y*(1-t),s.y*s.z*(1-t)-s.x*j)local w=f.New(s.z*s.x*(1-t)-s.y*j,s.z*s.y*(1-t)+s.x*j,t+s.z*s.z*(1-t))return f.New(k:Dot(u),k:Dot(v),k:Dot(w))end;function f.Perpendicular(k)return f.New(-k.y,k.x,0)end;function f.Lerp(k,l,j)return k+(l-k)*j end;function f.Unpack(k)return k.x,k.y,k.z end;function f.ComponentMin(k,l)return f.New(math.min(k.x,l.x),math.min(k.y,l.y),math.min(k.z,l.z))end;function f.ComponentMax(k,l)return f.New(math.max(k.x,l.x),math.max(k.y,l.y),math.max(k.z,l.z))end;function f.FlipX(k)return f.New(-k.x,k.y,k.z)end;function f.FlipY(k)return f.New(k.x,-k.y,k.z)end;function f.FlipZ(k)return f.New(k.x,k.y,-k.z)end;function f.AngleTo(k,l)local x=k:Normalize():Dot(l:Normalize())return d(x)end;function f.AngleToDeg(k,l)return k:AngleTo(l)*e end;function f.ProjectOn(k,x)local j=(k.x*x.x+k.y*x.y+k.z*x.z)/(x.x*x.x+x.y*x.y+x.z*x.z)return f.New(j*x.x,j*x.y,j*x.z)end;function f.ProjectOnPlane(k,y)return k-y*k:Dot(y)end;function f.IsVec3(k)return type(k)=="table"and type(k.x)=="number"and type(k.y)=="number"and type(k.z)=="number"end;function f.IsZero(k)return k.x==0 and k.y==0 and k.z==0 end;function f.ToString(k)return string.format("(%+0.3f,%+0.3f,%+0.3f)",k.x,k.y,k.z)end;function f.__tostring(k)return k:ToString()end;function f.__unm(k)return f.New(-k.x,-k.y,-k.z)end;function f.__eq(k,l)if not f.IsVec3(k)or not f.IsVec3(l)then return false end;return k.x==l.x and k.y==l.y and k.z==l.z end;function f.__add(k,l)return k:Add(l)end;function f.__sub(k,l)return k:Sub(l)end;function f.__mul(k,l)local z=f.IsVec3(k)local A=f.IsVec3(l)if z and A then return k:Mul(l)end;if type(k)=="number"and A then return l:Scale(k)end;return k:Scale(l)end;function f.__div(k,l)if f.IsVec3(l)then return k:Div(l)end;return k:Scale(1/l)end;return f

      end)

      package.preload['YFS:../e/lib/src/system/Taskmanager.lua']=(function()

      local a={}a.__index={}local b;function a.Instance()if b then return b end;local c={}local d={}function c.Add(e)d[#d+1]=e end;function c.Count()return#d end;local function f()local g={}for h,i in ipairs(d)do local j=d[h]if j.Run()==TaskState.Dead then if not j.Success()then if j.catcher then j.catcher(j)end end;if j.finalizer then j.finalizer(j)end else g[#g+1]=j end end;d=g end;b=setmetatable(c,a)system:onEvent("onUpdate",f)return b end;return a

      end)

      package.preload['YFS:../e/lib/src/system/Task.lua']=(function()

      local a=require('YFS:../e/lib/src/system/Taskmanager.lua').Instance()local b=coroutine.status;local c=coroutine.resume;TaskState={Dead=0,Running=1}local d={}d.__index=d;function d.New(e,f,g,...)local h={catcher=nil,finalizer=nil}local i={}local function j(k,...)i[#i+1]={co=coroutine.create(k),args={...}}end;local l;local m;local n=true;local o=false;local p=e;local function q()if#i==0 then return TaskState.Dead end;local r=b(i[1].co)=="dead"if r then table.remove(i,1)o=#i==0;if o then return TaskState.Dead end end;return TaskState.Running end;function h.Run()local s;if q()==TaskState.Running then local t=i[1]n,s=c(t.co,table.unpack(t.args))end;if n then l=s;return q()end;m=s;return TaskState.Dead end;function h.Then(u,v,...)j(u,v,...)return h end;function h.Catch(w)if type(w)~="function"then error("Can only add function as catchers")end;h.catcher=w;return h end;function h.Finally(x)if type(x)~="function"then error("Can only add function as catchers")end;h.finalizer=x;return h end;function h.Success()return n end;function h.Result()return l end;function h.Error()return m end;function h.Exited()return o end;function h.Name()return p end;j(f,g,...)setmetatable(h,d)a.Add(h)return h end;function d.Await(y)while not y.Exited()do coroutine.yield()end;return y.Result()end;return d

      end)

      package.preload['YFS:../e/lib/src/util/Table.lua']=(function()

      TableLen=function(a)local b=0;for c in pairs(a)do b=b+1 end;return b end;ReverseInplace=function(d)local b=#d;for e=1,b/2 do d[e],d[b]=d[b],d[e]b=b-1 end end;CopyList=function(f,g)local h=#f;for e,i in ipairs(g)do f[h+e]=i end end;local function j(k,l)l=l or{}local m=type(k)local n;if m=='table'then if l[k]then n=l[k]else n={}l[k]=n;for o,p in next,k,nil do n[j(o,l)]=j(p,l)end;setmetatable(n,j(getmetatable(k),l))end else n=k end;return n end;DeepCopy=function(q)return j(q)end

      end)

      package.preload['YFS:flight/route/PointOptions.lua']=(function()

      local a=require('YFS:../e/lib/src/util/Table.lua')local b={}b.__index=b;function b.New(c)local d={}local e=DeepCopy(c or{})function d.Set(f,g)e[f]=g end;function d.Get(f,h)local i=e[f]if i~=nil then return i end;return h end;function d.Data()return e end;function d.Clone()return b.New(DeepCopy(e))end;return setmetatable(d,b)end;b.LOCK_DIRECTION="lockDir"b.MARGIN="margin"b.FINAL_SPEED="finalSpeed"b.MAX_SPEED="maxSpeed"b.FORCE_FINAL_SPEED="forcefinalspeed"b.SKIPPABLE="skippable"b.SELECTABLE="selectable"b.GATE="gate"b.FORCE_VERT="forceVert"b.ALL={b.LOCK_DIRECTION,b.MARGIN,b.FINAL_SPEED,b.MAX_SPEED,b.FORCE_FINAL_SPEED,b.SKIPPABLE,b.SELECTABLE,b.GATE,b.FORCE_VERT}return b

      end)

      package.preload['YFS:flight/route/Point.lua']=(function()

      local a=require('YFS:flight/route/PointOptions.lua')local b={}b.__index=b;function b.New(c,d,e)local f={}local g=c;local h=d;local i=e or a.New()function f.Pos()return g end;function f.HasWaypointRef()return h~=nil and#h>0 end;function f.WaypointRef()return h end;function f.SetWaypointRef(j)h=j end;function f.Persist()local k;k={pos=g,waypointRef=h,opt=i.Data()or{}}return k end;function f.Options()return i end;function f.SetOptions(l)i=l end;return setmetatable(f,b)end;function b.LoadFromPOD(m)return b.New(m.pos,m.waypointRef,a.New(m.opt))end;return b

      end)

      package.preload['YFS:../e/lib/src/system/Stopwatch.lua']=(function()

      local a={}a.__index=a;function a.New()local b={}local c=system.getUtcTime;local d=nil;local e=nil;function b.Start()if not b.IsRunning()then d=c()e=nil end end;function b.Restart()b.Stop()b.Start()end;function b.Stop()e=c()end;function b.Reset()d=nil;e=nil end;function b.Elapsed()if d==nil then return 0 elseif e==nil then return c()-d else return e-d end end;function b.IsRunning()return d~=nil and e==nil end;return setmetatable(b,a)end;return a

      end)

      package.preload['YFS:../e/lib/src/abstraction/Vehicle.lua']=(function()

      local a=require('YFS:../e/lib/src/math/Vec3.lua').New;local b=library.getCoreUnit()local c=construct;local d={}d.__index=d;local e=0.09;local f={acceleration={Angular=function()return a(c.getWorldAngularAcceleration())end},player={position={Current=function()return a(player.getWorldPosition())end},orientation={Up=function()return a(player.getWorldUp())end}}}Current=function()return a(c.getWorldPosition())end;Up=function()return a(c.getWorldOrientationUp())end;Right=function()return a(c.getWorldOrientationRight())end;Forward=function()return a(c.getWorldOrientationForward())end;LocalUp=function()return a(c.getOrientationUp())end;LocalRight=function()return a(c.getOrientationRight())end;LocalForward=function()return a(c.getOrientationForward())end;AtmoDensity=unit.getAtmosphereDensity;IsInAtmo=function()return AtmoDensity()>e end;IsInSpace=function()return not IsInAtmo()end;GravityDirection=function()return a(b.getWorldVertical())end;G=b.getGravityIntensity;AirFrictionAcceleration=function()return a(c.getWorldAirFrictionAcceleration())end;MaxSpeed=function()return IsInAtmo()and c.getFrictionBurnSpeed()*0.99 or c.getMaxSpeed()end;Acceleration=function()return a(c.getWorldAcceleration())end;Velocity=function()return a(c.getWorldAbsoluteVelocity())end;LocalAngVel=function()return a(c.getAngularVelocity())end;LocalAngAcc=function()return a(c.getAngularAcceleration())end;IsFrozen=player.isFrozen;TotalMass=c.getTotalMass;return f

      end)

      package.preload['YFS:YFSConstants.lua']=(function()

      local a=require('YFS:../e/lib/src/math/Vec3.lua')local b={ticksPerSecond=60.0,flushTick=1/60.0,universe={up=a.New(0,1,0),forward=a.New(1,0,0),right=a.New(0,0,1)},direction={counterClockwise=1,clockwise=-1,rightOf=1,leftOf=-1,still=0},flight={speedPid={p=5,i=0.005,d=100,a=0.99},axis={light={p=10,i=0,d=800,a=0.1},heavy={p=6,i=1,d=1600,a=0.1}},throttleStep=10,defaultMargin=0.1,defaultStartEndMargin=0.3,defaultTurnAngle=1,lightConstructMassThreshold=10000,minimumPathCheckOffset=2,pathAlignmentAngleLimit=10,pathAlignmentDistanceLimit=200},route={routeStartDistanceLimit=10,autoShutdownFloorDistance=5,yawAlignmentThrustLimiter=3,pitchAlignmentThrustLimiter=5,rollAlignmentThrustLimiter=5,gateControlDistance=5},widgets={showOnStart=false}}return b

      end)

      package.preload['YFS:../e/lib/src/debug/Log.lua']=(function()

      local a={}a.__index=a;LVL={OFF=0,INFO=2,ERROR=3,WARNING=4,DEBUG=5}local b;function a.Instance()if b then return b end;local c={}local d=LVL.WARNING;local function e(f)if f==LVL.DEBUG then return"D"elseif f==LVL.ERROR then return"E"elseif f==LVL.INFO then return"I"elseif f==LVL.WARNING then return"W"else return"UNKOWN"end end;local function g(...)local h={}local i={...}for j=1,#i,1 do local k;k=i[j]if k==nil then k=""end;local l=""local m=type(k)if m=="string"then l=string.format("%s",k)elseif m=="number"then l=string.format("%s",tonumber(k))elseif m=="boolean"then l=tostring(k)elseif m=="function"then l=tostring(k)elseif m=="table"then l="{"for n,o in pairs(k)do l=l..g(n,": ",o,",")end;l=l.."}"else l="unprintable: '"..m.."'"end;h[#h+1]=string.format("%s",l)end;return table.concat(h)end;function c.print(p,...)if p<=d then system.print(string.format("[%s] %s",e(p),g(...)))end end;function c.SetLevel(p)d=p end;function c.Info(q,...)c.print(LVL.INFO,q,...)end;function c.Warning(q,...)c.print(LVL.WARNING,q,...)end;function c.Error(q,...)c.print(LVL.ERROR,q,...)end;function c.Debug(q,...)c.print(LVL.DEBUG,q,...)end;return setmetatable(c,a)end;return a

      end)

      package.preload['YFS:../e/lib/src/util/StringUtil.lua']=(function()

      local a={}function a.CoSplit(b,c)local d={}local e="(.-)"..c;local f=1;local g,h,i=b:find(e,1)while g do if g~=1 or i~=""then table.insert(d,i)end;f=h+1;g,h,i=b:find(e,f)coroutine.yield()end;if f<=#b then i=b:sub(f)table.insert(d,i)end;return d end;function a.Round(j,k)local l=10^(k or 0)return math.floor(j*l+0.5)/l end;function a.RemoveDecimal(g)return g:gsub("%.%d","")end;function PadLeft(g,m)if#g<m then g=string.rep('&nbsp;',m-#g)..g end;return g end;function a.FormatThousands(n)local o=n;local p;local q=false;while not q do o,p=string.gsub(o,"^(-?%d+)(%d%d%d)",'%1 %2')q=p==0 end;return o end;function a.Trim(g)return g:match"^%s*(.-)%s*$"end;function a.SplitQuoted(g)local function r(s)return s=='"'or s=="'"end;local function t(s)return s==" "end;local function u(v,w)w=a.Trim(w)if w:len()>0 then table.insert(v,#v+1,w)end end;local x=false;local y={}local z=""for s in g:gmatch(".")do if t(s)and not x then u(y,z)z=""elseif r(s)then if x then u(y,z)z=""x=false else u(y,z)z=""x=true end else z=z..s end end;u(y,z)return y end;function a.StartsWith(A,B)return A:find(B,1,true)==1 end;function a.EndsWith(b,C)return C==""or b:sub(-#C)==C end;function a.RemovePrefix(A,B)if a.StartsWith(A,B)then return A:sub(#B+1,#A)else return A end end;return a

      end)

      package.preload['YFS:../e/lib/src/commandline/Types.lua']=(function()

      local a=require('YFS:../e/lib/src/debug/Log.lua').Instance()local b={EMPTY=0,BOOLEAN=1,NUMBER=2,STRING=3,EMPTY_BOOLEAN=4}function b.parseValue(c,d)if c==b.EMPTY and d==nil then return true,""elseif d==nil then return true,d end;if c==b.BOOLEAN then if d=="true"or d=="1"then return true,true elseif d=="false"or d=="0"then return true,false else a.Error("Not a boolean: ",d)end elseif c==b.NUMBER then local e=string.match(d,"([+-]?%d*%.?%d+)")if e==nil then a.Error("Not a number: ",d)else return true,tonumber(e)end else return true,d end;return false,nil end;return b

      end)

      package.preload['YFS:../e/lib/src/commandline/Option.lua']=(function()

      local a=require('YFS:../e/lib/src/debug/Log.lua').Instance()local b=require('YFS:../e/lib/src/commandline/Types.lua')local c={}c.__index=c;function c.New(d)if d:sub(1,1)~="-"then d="-"..d end;local e={}local f=d:gsub("^%-*","")local g=b.EMPTY;local h=false;local i=nil;function e.AsString()g=b.STRING;return e end;function e.AsNumber()g=b.NUMBER;return e end;function e.AsBoolean()g=b.BOOLEAN;return e end;function e.Must()h=true;return e end;function e.AsEmptyBoolean()g=b.EMPTY_BOOLEAN;return e end;function e.Default(j)i=j;return e end;function e.Parse(k,l)for m,n in ipairs(k)do if n==d then if g==b.EMPTY_BOOLEAN then l[f]=true;table.remove(k,m)elseif m+1<=#k then table.remove(k,m)local j=table.remove(k,m)local o;o,l[f]=b.parseValue(g,j)if not o then return false end elseif h then a.Error("Missing value for mandatory option ",n)return false end;break end end;if g==b.EMPTY_BOOLEAN and l[f]==nil then l[f]=false end;if l[f]==nil and i~=nil then l[f]=i end;local p=not h or l[f]~=nil;if not p then a.Error("Option ",d," not complete")end;return p end;return setmetatable(e,c)end;return c

      end)

      package.preload['YFS:../e/lib/src/util/Calc.lua']=(function()

      local a=require('YFS:../e/lib/src/math/Vec3.lua')local b=library.systemResolution3;local c=math.atan;local d=math.cos;local e=math.acos;local f=math.max;local g=math.min;local h=math.abs;local i=math.sqrt;local j=math.pi/180;local k=180/math.pi;local l={}l.AbsDiff=function(m,n)m,n=h(m),h(n)return f(m,n)-g(m,n)end;l.Round=function(o,p)local q=10^(p or 0)return math.floor(o*q+0.5)/q end;l.Sign=function(r)if r>0 then return 1 elseif r<0 then return-1 else return 0 end end;l.SetSign=function(s,t)s=h(s)if t~=0 then return s*t end;return s end;l.Scale=function(s,u,v,w,x)return(x-w)/(v-u)*(s-u)+w end;l.WorldToLocal=function(y)local z=y-a.New(construct.getWorldPosition())return a.New(b(construct.getWorldRight(),construct.getWorldForward(),construct.getWorldUp(),{z:Unpack()}))end;l.WorldDirectionToLocal=function(A)return a.New(b(construct.getWorldRight(),construct.getWorldForward(),construct.getWorldUp(),{A:Unpack()}))end;l.LocalToWorld=function(B)local C=B.x*a.New(construct.getWorldOrientationRight())local D=B.y*a.New(construct.getWorldOrientationForward())local E=B.z*a.New(construct.getWorldOrientationUp())return C+D+E+a.New(construct.getWorldPosition())end;l.SignedRotationAngle=function(F,G,H)G=G:ProjectOnPlane(F)H=H:ProjectOnPlane(F)return c(G:Cross(H):Dot(F),G:Dot(H))end;l.StraightForward=function(I,J)return I:Cross(J)end;l.Mps2Kph=function(K)return K*3.6 end;l.Kph2Mps=function(L)return L/3.6 end;l.Clamp=function(r,M,N)return g(N,f(r,M))end;l.NearestPointOnLine=function(O,P,Q)local R=P:Normalize()local r=Q-O;local S=r:Dot(R)return O+R*S end;l.NearestOnLineBetweenPoints=function(m,n,T)local U=n-m;local V=T-m;local W=V:Dot(U)local X=U:Len2()if X<=0 then return m end;local S=W/X;if S<=0 then return m elseif S>=1 then return n else return m+U*S end end;l.LineIntersectSphere=function(Y,Z,_)local a0=Y.Start-Z;local n=a0:Dot(Y.Dir)local a1=a0:Dot(a0)-_*_;if a1>0 and n>0 then return false,a.New(),0 end;local a2=n*n-a1;if a2<0 then return false,a.New(),0 end;local a3=-n-i(a2)a3=a3<0 and 0 or a3;return true,Y.Start+Y.Dir*a3,a3 end;l.IsNaN=function(s)return s~=s end;l.AreAlmostEqual=function(m,n,a4)return h(m-n)<a4 end;l.Ternary=function(a5,m,n)if a5 then return m end;return n end;l.RotateAroundAxis=function(a6,a7,a8,a9)return(a6-a7):Rotate(a8*j,a9:NormalizeInPlace())+a7 end;l.SignLargestAxis=function(a6)local aa={a6:Unpack()}local ab=1;local ac=h(aa[ab])for ad=1,#aa,1 do local r=h(aa[ad])if r>ac then ac=r;ab=ad end end;return l.Sign(aa[ab])end;l.CalcBrakeDistance=function(ae,af)local S=ae^2/(2*af)if l.IsNaN(S)or af==0 then return 0 end;return S end;l.CalcBrakeAcceleration=function(ae,ag)return l.CalcBrakeDistance(ae,ag)end;local function ah(ai,aj,ak)return ai:Dot(ak-aj)end;l.ProjectPointOnPlane=function(ai,aj,ak)local al=ah(ai,aj,ak)al=al*-1;local am=ai*al;return ak+am end;l.DotToAngle=function(an)return k*e(an)end;l.AngleToDot=function(ao)return d(ao*j)end;l.BetweenOrEqual=function(r,ap,aq)return r>=ap and r<=aq end;return l

      end)

      package.preload['YFS:../e/lib/src/commandline/Command.lua']=(function()

      local a=require('YFS:../e/lib/src/debug/Log.lua').Instance()local b=require('YFS:../e/lib/src/commandline/Option.lua')local c=require('YFS:../e/lib/src/commandline/Types.lua')local d=require('YFS:../e/lib/src/util/Calc.lua')require('YFS:../e/lib/src/util/Table.lua')local e={}e.__index=e;function e.New()local f={}local g=c.EMPTY;local h={}local i=false;function f.AsString()g=c.STRING;return f end;function f.AsNumber()g=c.NUMBER;return f end;function f.AsBoolean()g=c.BOOLEAN;return f end;function f.AsEmpty()if i then error("Command is mandatory, cannot set as type empty")end;g=c.EMPTY;return f end;function f.Must()if g==c.EMPTY then error("Command is of type empty, cannot set as mandatory")end;i=true;return f end;function f.Option(j)local k=b.New(j)h[j]=k;return k end;function f.Parse(l)local m={}for n,k in pairs(h)do if not k.Parse(l,m)then return nil end end;local o=g==c.EMPTY and 0 or 1;local p=TableLen(l)if p<o then a.Error("Too few arguments for command.")return nil elseif p>o then a.Error("Too many arguments for command.")a.Error(l)return nil end;local q;q,m.commandValue=c.parseValue(g,l[1])if not q then return nil end;if m.commandValue==nil and i then a.Error("Missing mandatory value for command")return nil end;return m end;return setmetatable(f,e)end;return e

      end)

      package.preload['YFS:../e/lib/src/commandline/CommandLine.lua']=(function()

      local a=require('YFS:../e/lib/src/debug/Log.lua').Instance()local b=require('YFS:../e/lib/src/util/StringUtil.lua')local c=require('YFS:../e/lib/src/commandline/Command.lua')local d={}d.__index=d;local e;function d.Instance()if e then return e end;local f={}local g={}local h=function(i)return true end;function f.SetAccess(j)h=j end;function f.Accept(k,l)local m=c.New()g[k]={cmd=m,exec=l}return m end;function f.Clear()g={}end;local function n(o)local p=function(q)local r=b.SplitQuoted(q)local s=table.remove(r,1)local t=g[s]if t==nil then a.Error("Command not supported: ",s)else local u=t.cmd.Parse(r)if u==nil then a.Error("Cannot execute: ",q)else if h(s)then a.Info("Executing: ",q)t.exec(u)else a.Error("Not authorized to execute command '",s,"'")end end end end;local v,w=xpcall(p,traceback,o)if not v then a.Error(w)end end;function f.Exec(g)n(g)end;function f.inputText(x,y)n(y)end;e=setmetatable(f,d)system:onEvent("onInputText",f.inputText,f)return e end;return d

      end)

      package.preload['YFS:../e/lib/src/input/Input.lua']=(function()

      local a=require('YFS:../e/lib/src/input/Keys.lua')local b=require('YFS:../e/lib/src/util/Calc.lua').Clamp;local c={}c.__index=c;local d;function c.Instance()if d then return d end;local e={}local f={}local g={}local h=0;local i=0.1;function e.decode(j,k,l)local m=a[j]if m==nil then return end;g[m]=k;local n=f[m]if n~=nil then for o,p in ipairs(n)do if p.criteria.Matches(e,l,k)then p.func()end end end end;local function q(o,m)e.decode(m,true,false)end;local function r(o,m)e.decode(m,false,false)end;local function s(o,m)e.decode(m,true,true)end;local function t()h=b(h+i*system.getThrottleInputFromMouseWheel(),0,1)end;function e.IsPressed(m)return g[m]or false end;function e.AnyPressed(a)for o,u in ipairs(a)do if e.IsPressed(u)then return true end end;return false end;function e.KeyStates()return g end;function e.Register(m,v,w)local x=f[m]if x==nil then x={}f[m]=x end;table.insert(x,{criteria=v,func=w})end;function e.RegisterMany(a,y,w)for o,z in ipairs(a)do e.Register(z,y,w)end end;function e.Clear()f={}g={}end;function e.Throttle()return h end;function e.SetThrottle(A)h=b(A,0,1)end;function e.SetThrottleStep(A)i=b(A,0.01,1)end;d=setmetatable(e,c)system:onEvent("onActionStart",q)system:onEvent("onActionStop",r)system:onEvent("onActionLoop",s)system:onEvent("onUpdate",t)return d end;return c

      end)

      package.preload['YFS:../e/lib/src/util/PubSub.lua']=(function()

      local a={}a.__index=a;local b;function a.Instance()if b then return b end;local c={}local d={number={},string={},table={},boolean={}}local function e(f,g,h)local i=f[g]if not i then i={}f[g]=i end;table.insert(i,h)end;function c.Unregister(g,h)for j,k in pairs(d)do local f=k[g]if f then for l,m in ipairs(f)do if m==h then table.remove(f,l)return end end end end end;function c.RegisterString(g,h)e(d[type("")],g,h)end;function c.RegisterNumber(g,h)e(d[type(1)],g,h)end;function c.RegisterTable(g,h)e(d[type({})],g,h)end;function c.RegisterBool(g,h)e(d[type(true)],g,h)end;function c.Publish(g,n)local f=d[type(n)]if not f then return end;local i=f[g]if not i then return end;for j,o in ipairs(i)do o(g,n)end end;b=setmetatable(c,a)return b end;return a

      end)

      package.preload['YFS:flight/Brakes.lua']=(function()

      require('YFS:../e/lib/src/abstraction/Vehicle.lua')local a,b,c,d,e=require('YFS:../e/lib/src/util/Calc.lua'),require('YFS:../e/lib/src/math/Vec3.lua').New(),require("cpml/pid"),require('YFS:../e/lib/src/util/PubSub.lua').Instance(),require('YFS:../e/lib/src/system/Stopwatch.lua').New()local f=a.Clamp;local g=math.max;local h=a.Kph2Mps(360)local i=0.9;local j=0.9;local k={}k.__index=k;local l;function k.Instance()if l then return l end;local m=c(1,0,0.01)local n=c(0.1,0.0,1)local o=b;local p=0;local q=a.Kph2Mps(100)local r={maxDeceleration=0,currentDeceleration=0,pid=0,setAutoBrakeAngle=0,autoBrakeAngle=0}local s=45;local t=1;local u=a.Kph2Mps(1)local v={engaged=false,forced=false,totalMass=TotalMass()}local function w()return construct.getMaxBrake()/v.totalMass end;local function x()if v.forced then return-Velocity():Normalize()*w()else return o end end;function v.BrakeUpdate()v.totalMass=TotalMass()local y=w()r.maxDeceleration=y;r.currentDeceleration=construct.getCurrentBrake()/v.totalMass;if IsInAtmo()then p=g(y,p)end;r.setAutoBrakeAngle=s;d.Publish("BrakeData",r)end;function v.Forced(z)v.forced=z end;function v.BrakeFlush()local A=x()unit.setEngineCommand("brake",{A:Unpack()},{0,0,0},true,true,"","","",0.001)end;function v.GravityInfluencedAvailableDeceleration()local B=GravityDirection():Dot(Velocity():Normalize())local C=B>0;local D=a.Ternary(C,-1,1)return g(0,w()+D*B*G())end;function v.MaxSeenGravityInfluencedAvailableAtmoDeceleration()local B=GravityDirection():Dot(Velocity():Normalize())local C=B>0;local D=a.Ternary(C,-1,1)return g(0,p+D*B*G())end;function v.Feed(E,F,H)local I,J=Velocity():NormalizeLen()local K=0;if J>u then if not F:IsZero()then K=F:AngleToDeg(I)elseif not E:IsZero()then K=E:AngleToDeg(I)end end;if K>s then e.Start()else e.Reset()end;if e.Elapsed()>t then H=0 end;local L=J-H;m:inject(L)n:inject(L)local M=J>q and m or n;local N=f(M:get(),0,1)if J<=H then m:reset()n:reset()N=0 end;r.pid=N;r.autoBrakeAngle=K;o=-I*N*w()end;function v.Active()return r.pid>0 end;function v.BrakeEfficiency(O,P)if not O then return j end;if P<=h then return 0.1 else return i end end;function v.EffectiveBrakeDeceleration()local J=Velocity():Len()local O=IsInAtmo()local Q=v.BrakeEfficiency(O,J)local R=AtmoDensity()if R>0 then Q=Q*R end;local S=-v.GravityInfluencedAvailableDeceleration()*Q;if O and J<a.Kph2Mps(3)then local T=v.MaxSeenGravityInfluencedAvailableAtmoDeceleration()S=-g(T,G())end;return S end;function v.CalcMaxAllowedSpeed(U,V,W)W=W or v.EffectiveBrakeDeceleration()local X=(V*V-2*W*U)^0.5;return X end;function v.MaxBrakeAcc()return w()end;function v.SetAutoBrakeAngle(K)s=K end;function v.SetAutoBrakeDelay(Y)t=Y end;l=setmetatable(v,k)return l end;return k

      end)

      package.preload['YFS:../e/lib/src/system/locale.lua']=(function()

      local a={"en-US","fr-FR","de-DE"}function LocaleIndex()local b=system.getLocale()for c,d in ipairs(a)do if b==d then return c end end;return 1 end

      end)

      package.preload['YFS:../e/lib/src/universe/Body.lua']=(function()

      require('YFS:../e/lib/src/system/locale.lua')local a=require('YFS:../e/lib/src/math/Vec3.lua')local b=math.abs;local c=math.max;local d={}d.__index=d;function d.New(e,f)local g=LocaleIndex()local h={Galaxy=e,Id=f.id,Name=f.name[g],Type=f.type[g],Physics={Gravity=f.gravity},Geography={Center=a.New(f.center),Radius=f.radius},Atmosphere={Present=f.hasAtmosphere,Thickness=f.atmosphereThickness,Radius=f.atmosphereRadius},Surface={MaxAltitude=f.surfaceMaxAltitude,MinAltitude=f.surfaceMinAltitude},Pvp={LocatedInSafeZone=f.isInSafeZone}}function d.__tostring(i)return i.Name end;function h:DistanceToAtmo(j)return c(0,(j-h.Geography.Center):Len()-h.Atmosphere.Radius)end;function h:DistanceToAtmoEdge(j)local k=h:DistanceToAtmo(j)if k==0 then return h.Atmosphere.Radius-(j-h.Geography.Center):Len()end;return k end;function h:IsInAtmo(j)return h:DistanceToAtmo(j)==0 end;function h:HasAtmo()return h.Atmosphere.Radius>0 end;function h.DistanceToHighestPossibleSurface(j)return c(0,(j-h.Geography.Center):Len()-h.Geography.Radius-h.Surface.MaxAltitude)end;function h.AboveSeaLevel(j)local l=h.Geography.Radius;local m=(j-h.Geography.Center):Len()return m>=l,b(m-l)end;return setmetatable(h,d)end;return d

      end)

      package.preload['YFS:../e/lib/src/universe/Galaxy.lua']=(function()

      local a=require('YFS:../e/lib/src/universe/Body.lua')local b=require('YFS:../e/lib/src/util/Calc.lua')local c=math.max;local d={}d.__index=d;function d.New(e,f)local g={Id=e}local h={}for i,j in pairs(f)do h[i]=a.New(g,j)end;function g:BodyById(k)return h[k]end;function g:GetBodyClosestToPosition(l)local m;local n;for o,p in pairs(h)do local q=(p.Geography.Center-l):Len()if n==nil or q<n then n=q;m=p end end;return m end;function g:BodiesInPath(r)local s={}local t=function(u,p)return(u.Geography.Center-r.Start):Len2()<(p.Geography.Center-r.Start):Len2()end;for o,p in pairs(h)do local v=c(p.Geography.Radius,p.Atmosphere.Radius)local w,o,o=b.LineIntersectSphere(r,p.Geography.Center,v)if w then table.insert(s,p)end end;table.sort(s,t)return s end;return setmetatable(g,d)end;return d

      end)

      package.preload['YFS:../e/lib/src/universe/Position.lua']=(function()

      local a=string.format;local b={}b.__index=b;function b.New(c,d,e)local f={Body=d,Galaxy=c,Coords=e}function f.AsPosString()return tostring(f)end;function f.Coordinates()return f.Coords end;function b.__tostring(g)local h=(g.Coords-g.Body.Geography.Center):Len()-g.Body.Geography.Radius;if h<g.Body.Geography.Radius+70000 then local i=g.Body.Geography.Radius+h;local j=g.Coords-g.Body.Geography.Center;local k=0;local l=0;if j:Len2()>0 then k=math.asin(j.z/i)l=math.atan(j.y,j.x)end;return a("::pos{%d,%d,%.4f,%.4f,%.4f}",g.Galaxy.Id,g.Body.Id,math.deg(k),math.deg(l),h)else return a("::pos{%d,0,%.4f,%.4f,%.4f}",g.Galaxy.Id,g.Coords.x,g.Coords.y,g.Coords.z)end end;return setmetatable(f,b)end;return b

      end)

      package.preload['YFS:../e/lib/src/universe/Universe.lua']=(function()

      local a=require('YFS:../e/lib/src/debug/Log.lua').Instance()local b=require('YFS:../e/lib/src/universe/Galaxy.lua')local c=require('YFS:../e/lib/src/universe/Position.lua')local d=require('YFS:../e/lib/src/math/Vec3.lua')local e=math.cos;local f=math.sin;local g=string.match;local h=" *([+-]?%d+%.?%d*e?[+-]?%d*)"local i="::pos{"..h..","..h..","..h..","..h..","..h.."}"local j={}j.__index=j;local k=nil;function j.Instance()if k then return k end;local l={}local m=library.getCoreUnit()local n={}local o=require("atlas")if type(o)~="table"then error("Invalid atlas")unit.exit()end;for p,q in pairs(o)do l[p]=b.New(p,q)end;function n.CurrentGalaxyId()return 0 end;function n.CurrentGalaxy()return l[n.CurrentGalaxyId()]end;function n.ParsePosition(r)local s,t,u,v;local p,w,x,y,z=g(r,i)if p~=nil then p=tonumber(p)w=tonumber(w)if w==0 then s=tonumber(x)t=tonumber(y)u=tonumber(z)local A=d.New(s,t,u)v=n.CurrentGalaxy():GetBodyClosestToPosition(A)return c.New(l[p],v,A)else x=math.rad(x)y=math.rad(y)local B=l[p]:BodyById(w)local C=B.Geography.Radius+z;local D=e(x)local E=d.New(C*D*e(y),C*D*f(y),C*f(x))E=E+B.Geography.Center;return c.New(l[p],B,E)end end;a.Error("Invalid position string: ",r)return nil end;function n.CreatePos(A)local F=n.ClosestBody(A)local G=c.New(n.CurrentGalaxy(),F,A)return G end;function n.ClosestBody(A)local H=n.CurrentGalaxy()return H:GetBodyClosestToPosition(A)end;function n.VerticalReferenceVector()local I=d.New(m.getWorldGravity())local J,K=I:NormalizeLen()if K==0 then local E=d.New(construct.getWorldPosition())local B=n.ClosestBody(E)return(B.Geography.Center-E):Normalize()else return J end end;k=setmetatable(n,j)return k end;return j

      end)

      package.preload['YFS:controller/GateControl.lua']=(function()

      local a,b,c=require('YFS:../e/lib/src/util/PubSub.lua').Instance(),require('YFS:../e/lib/src/debug/Log.lua').Instance(),require('YFS:../e/lib/src/system/Stopwatch.lua')local d={}d.__index={}local e;function d.Instance()if e then return e end;local f={}local g=false;local h=true;local i=c.New()local j=library.getLinkByName("FollowGate")if j and(type(j.activate)~="function"or type(j.deactivate)~="function")then j=nil end;if j then b.Info("Found FollowGate switch")end;local function k(l,m)if m.state==g then i.Stop()b.Info("Gates reported in desired state")end end;local function n(o)g=o;i.Restart()end;function f.Open()n(true)end;function f.Close()n(false)end;function f.Enable(p)h=p end;function f.Enabled()return h end;function f.AreInDesiredState()return not h or not i.IsRunning()end;e=setmetatable(f,d)a.RegisterTable("RecData-GateControl",k)system:onEvent("onUpdate",function()if h and i.IsRunning()and i.Elapsed()>0.5 then i.Restart()a.Publish("SendData",{topic="GateControl",data={desiredState=g}})if j then if g then j.activate()else j.deactivate()end end end end)return e end;return d

      end)

      package.preload['YFS:../e/lib/src/element/Radar.lua']=(function()

      local a=require('YFS:../e/lib/src/debug/Log.lua').Instance()local b={}b.__index=b;RadarState={Operational=1,Broken=0,BadEnvironment=-1,Obstructed=-2,AlreadyInUse=-3}local c={"Distance acending","Distance descending","Size ascending","Size descending","Threat ascending","Threat descending"}local d=TableLen(c)local e={"RadarPvPAtmospheric"}local f={"RadarPVPSpaceSmallGroup","RadarPVPSpaceMediumGroup","RadarPVPSpaceLargeGroup"}local function g(h)local i=nil;for j,k in ipairs(h)do i=i or library.getLinkByClass(k)end;return i end;local l;function b.Instance()if l then return l end;local m={}local n=false;local o=1;local p={g(e),g(f)}local q=p[1]~=nil and 1 or 0;q=q+(p[2]~=nil and 1 or 0)local function r()for j,i in ipairs(p)do if i then if not n or i.getOperationalState()==RadarState.BadEnvironment then i.hideWidget()else i.showWidget()end end end end;function m.Show(s)n=s;a.Info("Radar ",s and"shown"or"hidden")if s then m.Sort(o)end end;function m.IsVisible()return n end;function m.NextMethod()local t=(o+1)%(d+1)if t==0 then t=1 end;m.Sort(t)end;function m.Sort(u)o=u;for j,i in ipairs(p)do if i and i.getSortMethod()~=p then if i.setSortMethod(o)then a.Error("Sort method set to ",c[o])end end end end;system:onEvent("onUpdate",r)l=setmetatable(m,b)return l end;return b

      end)

      package.preload['YFS:../e/lib/src/element/Telemeter.lua']=(function()

      local a=require('YFS:../e/lib/src/math/Vec3.lua')local b={}b.__index=b;function b.New(c)local d={}function d.Measure()local e=c.raycast()return{Hit=e.hit,Point=a.New(e.point),Distance=e.distance}end;function d.IsTelemeter()return type(c.getMaxDistance)=="function"and type(c.raycast)=="function"and type(c.getRayWorldOrigin)=="function"end;function d.MaxDistance()return c.getMaxDistance()end;return setmetatable(d,b)end;return b

      end)

      package.preload['YFS:controller/FloorDetector.lua']=(function()

      local a,b,c=require('YFS:../e/lib/src/element/Telemeter.lua'),require('YFS:../e/lib/src/debug/Log.lua').Instance(),require('YFS:../e/lib/src/math/Vec3.lua')local d={}d.__index=d;local e;local f="FloorDetector"function d.Instance()if e then return e end;e={}local g=false;local h=library.getLinkByName(f)local i;if h then i=a.New(h)if not i.IsTelemeter()then i=nil end else b.Error("No telementer by name '",f,"' found")end;function e.Present()return i~=nil end;function e.Measure()if i then return i.Measure()else return{Hit=false,Distance=0,Point=c.zero}end end;function e.MaxDist()return i and i.MaxDistance()or 0 end;return setmetatable(e,d)end;return d

      end)

      package.preload['YFS:../e/lib/src/system/Timer.lua']=(function()

      local a={}a.__index=a;local b;function a.Instance()if b then return b end;local c={}local d={}local e={}local f={}function c.Add(g,h,i)c.Remove(g)f[#f+1]={id=g,f=h,interval=i}d[g]=h end;function c.Remove(g)if d[g]~=nil then e[#e+1]=g;d[g]=nil end end;local function j(k)local l=d[k]if l~=nil then l()end end;system:onEvent("onUpdate",function()while#e>0 do unit.stopTimer(table.remove(e,1))end;while#f>0 do local m=table.remove(f,1)unit.setTimer(m.id,m.interval)end end)unit:onEvent("onTimer",function(unit,g)j(g)end)b=setmetatable(c,a)return b end;return a

      end)

      package.preload['YFS:Singletons.lua']=(function()

      local a={constants=require('YFS:YFSConstants.lua'),log=require('YFS:../e/lib/src/debug/Log.lua').Instance(),strUtil=require('YFS:../e/lib/src/util/StringUtil.lua'),commandLine=require('YFS:../e/lib/src/commandline/CommandLine.lua').Instance(),input=require('YFS:../e/lib/src/input/Input.lua').Instance(),pub=require('YFS:../e/lib/src/util/PubSub.lua').Instance(),calc=require('YFS:../e/lib/src/util/Calc.lua'),brakes=require('YFS:flight/Brakes.lua').Instance(),universe=require('YFS:../e/lib/src/universe/Universe.lua').Instance(),keys=require('YFS:../e/lib/src/input/Keys.lua'),gateCtrl=require('YFS:controller/GateControl.lua').Instance(),radar=require('YFS:../e/lib/src/element/Radar.lua').Instance(),floorDetector=require('YFS:controller/FloorDetector.lua').Instance(),timer=require('YFS:../e/lib/src/system/Timer.lua').Instance()}return a

      end)

      package.preload['YFS:../e/lib/src/math/Plane.lua']=(function()

      require('YFS:../e/lib/src/abstraction/Vehicle.lua')local a=require('YFS:../e/lib/src/universe/Universe.lua').Instance()local b={}b.__index=b;function b.New(c)local d={}local e=Right;d.Up=c;function d.Forward()return d.Up():Cross(e())end;function d.Right()return d.Forward():Cross(d.Up())end;return setmetatable(d,b)end;function b.NewByVertialReference()return b.New(function()return-a.VerticalReferenceVector()end)end;return b

      end)

      package.preload['YFS:flight/Waypoint.lua']=(function()

      require('YFS:../e/lib/src/abstraction/Vehicle.lua')local a=require('YFS:Singletons.lua')local b=require('YFS:../e/lib/src/math/Plane.lua')local c,d=a.calc,a.universe;local e,f,g,h=c.Ternary,math.max,math.abs,c.BetweenOrEqual;WPReachMode={ENTRY=1,EXIT=2}local i={}i.__index=i;local j=1000;i.DirectionMargin=j;local k,l,m,n,o=0,0,0,false,b.NewByVertialReference()function i.SetAlignmentAngleLimit(p)k=f(0,p)end;function i.SetAlignmentDistanceLimit(q)l=f(0,q)end;function i.SetPitchAlignmentThrustLimiter(p)m=p end;function i.SetAutoPitch(r)n=r end;function i.New(s,t,u,v,w)u=e(t>u and u>0,t,u)local x=nil;local y,z,A,B=false,false,Vec3.zero,n;local C=b.New(function()return A end)local D={}local function E(F)local G=o.Up()if z then return G end;local H=G;local I=(s-F.Destination()):Normalize()local J=d.ClosestBody(Current())local K=J.DistanceToHighestPossibleSurface(Current())local L=D.DistanceTo()>l and F.DistanceTo()>l;if L then local M=w>0 and K>w;if M then H=I;B=false elseif k>0 then local N=G:Dot(I)>0;if N and G:AngleToDeg(I)<k then H=I elseif not N and G:AngleToDeg(-I)<k then H=-I end end end;return H end;function D.Destination()return s end;function D.FinalSpeed()return t end;function D.MaxSpeed()return u end;function D.Margin()return v end;function D.WithinMargin(O)local P=v;if O==WPReachMode.ENTRY then if P>1 then P=P/2 end end;return D.DistanceTo()<=P end;function D.DistanceTo()return(s-Current()):Len()end;function D.DirectionTo()return(s-Current()):NormalizeInPlace()end;function D.SetLastInRoute(Q)y=Q end;function D.IsLastInRoute()return y end;function D.PathAlignmentDistanceLimitFromSurface()return w end;function D.LockYawTo(R,S)S=S or false;if x==nil or S then x=R end end;function D.IsYawLocked()return x~=nil end;function D.LockedYawDirection()return x end;function D.PreCalc(F)A=E(F)end;function D.ForceUpAlongVerticalRef()z=true end;local function T()return c.ProjectPointOnPlane(C.Right(),Current(),Current()+C.Forward()*j)end;function D.Roll(F)return c.ProjectPointOnPlane(C.Forward(),Current(),Current()+C.Up()*j)end;function D.Pitch(F)if B then local U,V=Velocity():Normalize(),C.Forward()if D.DistanceTo()>10 and Velocity():Len()>c.Kph2Mps(50)and h(U:AngleToDeg(o.Up()),40,140)and h(o.Up():AngleToDeg(D.DirectionTo()),15,180-15)and h(V:AngleToDeg(D.DirectionTo()),0,75)then return Current()+U*j end end;return T()end;function D.Yaw(F)local W;if x then W=x elseif D.DistanceTo()>50 then W=D.DirectionTo()else W=D.Destination()-F.Destination()W:NormalizeInPlace()end;if not x and g(W:Dot(A))>0.9 then D.LockYawTo(Forward(),false)W=Forward()end;return c.ProjectPointOnPlane(A,Current(),Current()+W*j)end;return setmetatable(D,i)end;return i

      end)

      package.preload['YFS:GlobalTypes.lua']=(function()

      Criteria=require('YFS:../e/lib/src/input/Criteria.lua')Vec3=require('YFS:../e/lib/src/math/Vec3.lua')Task=require('YFS:../e/lib/src/system/Task.lua')Point=require('YFS:flight/route/Point.lua')PointOptions=require('YFS:flight/route/PointOptions.lua')Stopwatch=require('YFS:../e/lib/src/system/Stopwatch.lua')Waypoint=require('YFS:flight/Waypoint.lua')Plane=require('YFS:../e/lib/src/math/Plane.lua')

      end)

      package.preload['YFS:../e/lib/src/element/Lock.lua']=(function()

      local a=require('YFS:../e/lib/src/util/StringUtil.lua')local b=require('YFS:../e/lib/src/debug/Log.lua').Instance()EngineType={NOT_ENGINE=0,ATMO=1,SPACE=2,ROCKET=3}EngineSize={XS=1,S=2,M=3,L=4,XL=5}local function c(d)if a.EndsWith(d," xs")then return EngineSize.XS end;if a.EndsWith(d," s")then return EngineSize.S end;if a.EndsWith(d," m")then return EngineSize.M end;if a.EndsWith(d," l")then return EngineSize.L end;return EngineSize.XL end;local function e(d)if d:match("atmospheric engine")then return EngineType.ATMO elseif d:match("space engine")then return EngineType.SPACE elseif d:match("rocket engine")then return EngineType.ROCKET end;return EngineType.NOT_ENGINE end;local function f(g)if g==EngineType.ATMO then return"Atmospheric"end;if g==EngineType.ROCKET then return"Rocket"end;return"Space"end;local function h(i)if i==EngineSize.XS then return"XS"end;if i==EngineSize.S then return"S"end;if i==EngineSize.M then return"M"end;if i==EngineSize.L then return"L"end;return"XL"end;local j={}j.__index=j;function j.New()local k=math.mininteger;local i={}local l={}local m={}l[EngineType.ATMO]=m;local n={}l[EngineType.SPACE]=n;local o={}l[EngineType.ROCKET]=o;for p=EngineSize.XS,EngineSize.XL,1 do m[p]=0;n[p]=0;o[p]=0 end;function i.AddLimit(q,r,s)l[q][r]=s end;function i.ValidateCo()local t=true;local u=library.getCoreUnit()for v,w in ipairs(u.getElementIdList())do local x=u.getElementItemIdById(w)local y=system.getItem(x)local z=y.displayNameWithSize:lower()local g=e(z)local r=c(z)if g~=EngineType.NOT_ENGINE then local A=l[g]if A[r]~=k then A[r]=A[r]-1 end end;coroutine.yield()end;for g=EngineType.ATMO,EngineType.ROCKET do for r=EngineSize.XS,EngineSize.XL do local s=l[g][r]if s~=k and s<0 then b.Error(math.abs(s)," too many engines of type: ",f(g)," ",h(r))t=false end end;coroutine.yield()end;return t end;return setmetatable(i,j)end;return j

      end)

      package.preload['YFS:version_out.lua']=(function()

      local a={APP_NAME="Yoarii's Flight System",APP_VERSION="850e7fe / 20231223 22:22"}return a

      end)

      package.preload['YFS:variants/CoreLinkCheck.lua']=(function()

      local a=require('YFS:Singletons.lua')local b=a.log;local function c()local d=system.getItem(unit.getItemId())local e=d.displayNameWithSize:lower():match("emergency")local f=library.getCoreUnit()~=nil;if not f then b.Error(d.displayNameWithSize," must be linked to the core.")end;return f,e end;return c

      end)

      package.preload['YFS:controller/ControlCommands.lua']=(function()

      require('YFS:../e/lib/src/abstraction/Vehicle.lua')require('YFS:GlobalTypes.lua')local a=require('YFS:Singletons.lua')local b,c,d,e,f,g,h,i,j=a.log,a.brakes,a.calc,a.universe,a.keys,a.pub,a.constants,a.gateCtrl,a.radar;local k,l=e.VerticalReferenceVector,Plane.NewByVertialReference()local m={}m.__index=m;function m.New(n,o,p,q,r,s,t)local a={}local u=p.GetRouteController()local function v()local w=u.ActivateTempRoute().AddCurrentPos()w.Options().Set(PointOptions.LOCK_DIRECTION,{Forward():Unpack()})p.StartFlight()end;local function x(y)y.Option("-lockdir").AsEmptyBoolean().Default(false)y.Option("-maxspeed").AsNumber().Default(0)y.Option("-margin").AsNumber().Default(0.1)y.Option("-forceVerticalUp").AsBoolean().Default(true)end;local function z(A)local B=PointOptions.New()B.Set(PointOptions.MAX_SPEED,d.Kph2Mps(A.maxspeed))B.Set(PointOptions.MARGIN,A.margin)if A.lockdir then B.Set(PointOptions.LOCK_DIRECTION,{Forward():Unpack()})end;return B end;function a.RegisterCommonCommands(C)if not C then local function D(E)if player.isFrozen()or not E then c.Forced(E)end end;n.Register(f.brake,Criteria.New().LCtrl().OnPress(),function()D(true)end)n.Register(f.brake,Criteria.New().LCtrl().OnRelease(),function()D(false)end)end;o.Accept("idle",function()b.Info("Going idle!")p.GoIdle()end)o.Accept("hold",function()v()end)o.Accept("print-pos",function(F)b.Info("Current pos:",e.CreatePos(Current()):AsPosString())b.Info("Alignment pos:",e.CreatePos(Current()+Forward()*Waypoint.DirectionMargin):AsPosString())end)local G=q.Boolean("showWidgetsOnStart",false)n.Register(f.option8,Criteria.New().LShift().OnPress(),function()G=not G;g.Publish("ShowInfoWidgets",G)end)n.Register(f.option0,Criteria.New().LShift().OnPress(),function()j.Show(not j.IsVisible())end)n.Register(f.option0,Criteria.New().OnPress(),function()j.NextMethod()end)n.Register(f.gear,Criteria.New().OnPress(),function()if IsFrozen()then p.StartParking((Current()-e.ClosestBody(Current()).Geography.Center):Len(),"Parking")end end)local H=function(I,J,K)local B=I.Options()B.Set(PointOptions.MARGIN,q.Number("parkMargin"))B.Set(PointOptions.GATE,J)if K then B.Set(PointOptions.LOCK_DIRECTION,{K:Unpack()})end end;local function L(w)w.AddTag("ReturnTag")i.Enable(true)g.Publish("ResetWSAD",true)p.StartFlight()end;n.Register(f.gear,Criteria.New().LCtrl().LShift().OnPress(),function()if not IsFrozen()then return end;local y=Current()local M=y+l.Up()*q.Number("parkVertDist")local N=y+l.Forward()*q.Number("parkForwardDist")+l.Up()*q.Number("parkVertDist")local O={g1={y:Unpack()},g2={M:Unpack()},g3={N:Unpack()},fwd={l.Forward():Unpack()}}t.Put("returnData",O)local w=u.ActivateTempRoute("Undock")H(w.AddCoordinate(y),q.Boolean("parkUseGates"),l.Forward())H(w.AddCoordinate(M),false,l.Forward())H(w.AddCoordinate(N),false)L(w)end)n.Register(f.gear,Criteria.New().LShift().OnPress(),function()if not IsFrozen()then return end;local P=t.Get("returnData",{})local Q=Vec3.New(P.g1)local M=Vec3.New(P.g2)local N=Vec3.New(P.g3)local R=Vec3.New(P.fwd)if not(Q:IsZero()and M:IsZero()and N:IsZero()and R:IsZero())then local w=u.ActivateTempRoute("Returning")H(w.AddCoordinate(N),false)H(w.AddCoordinate(M),false,R)H(w.AddCoordinate(Q),q.Boolean("parkUseGates"),R)L(w)end end)end;local function S()local T=u.CurrentEdit()if T==nil then b.Error("No route being edited")end;return T end;function a.RegisterRouteCommands()o.Accept("route-list",function(A)local U=u.GetRouteNames()b.Info(#U," available routes")for F,w in ipairs(U)do b.Info(w)end end)o.Accept("route-edit",function(A)if u.EditRoute(A.commandValue)then b.Info("Route open for edit")end end).AsString()o.Accept("route-create",function(A)u.CreateRoute(A.commandValue)end).AsString().Must()o.Accept("route-save",function(A)u.SaveRoute()end).AsEmpty()o.Accept("route-discard",function(A)u.Discard()end)o.Accept("route-delete",function(A)u.DeleteRoute(A.commandValue)end).AsString().Must()local V=o.Accept("route-rename",function(A)u.RenameRoute(A.from,A.to)end).AsEmpty()V.Option("from").AsString().Must()V.Option("to").AsString().Must()o.Accept("route-print",function(A)local T=S()if T==nil then return end;for W,I in ipairs(T.Points())do b.Info(W,":",d.Ternary(I.HasWaypointRef(),I.WaypointRef(),I.Pos()))local X=I.Options()for Y,Z in pairs(X.Data())do b.Info("- ",Y,": ",Z)end end end)o.Accept("route-activate",function(A)if not s.MayStartRoute(A.commandValue)then return end;if u.ActivateRoute(A.commandValue,A.index,q.Number("routeStartDistanceLimit"),q.Number("gateControlDistance"))then i.Enable(true)p.StartFlight()g.Publish("ResetWSAD",true)b.Info("Flight started")end end).AsString().Must().Option("index").AsNumber()local _=o.Accept("route-add-current-pos",function(A)local T=S()if T==nil then return end;local a0=T.AddCurrentPos()a0.SetOptions(z(A))b.Info("Added current position to route")end).AsEmpty()x(_)local a1=o.Accept("route-add-named-pos",function(A)local a2=u.LoadWaypoint(A.commandValue)if a2 then local T=S()if T==nil then return end;local I=T.AddWaypointRef(A.commandValue,a2.Pos())if I then I.SetOptions(z(A))b.Info("Added position to route")else b.Error("Could not add postion")end end end).AsString()x(a1)o.Accept("route-delete-pos",function(A)local T=S()if T==nil then return end;if T.RemovePoint(A.commandValue)then b.Info("Point removed")else b.Error("Could not remove point")end end).AsNumber().Must()local function a3(a4,a5)local T=S()if T==nil then return end;if T.MovePoint(a4,a5)then b.Info("Point moved:",a4," to ",a5)else b.Error("Could not move point")end end;local a6=o.Accept("route-move-pos",function(A)a3(A.from,A.to)end)a6.Option("from").AsNumber().Must()a6.Option("to").AsNumber().Must()o.Accept("route-move-pos-forward",function(A)local a7=A.commandValue;a3(a7,a7+1)end).AsNumber().Must()o.Accept("route-move-pos-back",function(A)local a7=A.commandValue;a3(a7,a7-1)end).AsNumber().Must()local a8=o.Accept("route-set-pos-option",function(A)local T=S()if T==nil then return end;if not A.endIx then A.endIx=A.ix end;if A.maxSpeed and A.maxSpeed<0 then b.Error("Max speed must be larger than 0")return end;if A.ix>A.endIx then b.Error("Start index must be less or equal to end index")return end;if not(T.CheckBounds(A.ix)and T.CheckBounds(A.endIx))then b.Error("Index out of bounds")return end;if A.margin and A.margin<0.1 then b.Error("Margin must be larger or equal to 0.1m")return end;if A.finalSpeed and A.finalSpeed<0 then b.Error("Final speed must be >= 0")return end;b.Info("Setting point options for point indexes ",A.ix," through ",A.endIx)for W=A.ix,A.endIx,1 do if A.toggleSkippable then local a9=not T.GetPointOption(W,PointOptions.SKIPPABLE,false)if T.SetPointOption(W,PointOptions.SKIPPABLE,a9)then b.Info("Set skippable option to ",a9)end end;if A.toggleSelectable then local a9=not T.GetPointOption(W,PointOptions.SELECTABLE,true)if T.SetPointOption(W,PointOptions.SELECTABLE,a9)then b.Info("Set selectable option to ",a9)end end;if A.margin then T.SetPointOption(W,PointOptions.MARGIN,A.margin)end;if A.finalSpeed then T.SetPointOption(W,PointOptions.FINAL_SPEED,d.Kph2Mps(A.finalSpeed))end;if A.maxSpeed then T.SetPointOption(W,PointOptions.MAX_SPEED,d.Kph2Mps(A.maxSpeed))end;if A.toggleGate then local a9=not T.GetPointOption(W,PointOptions.GATE,false)T.SetPointOption(W,PointOptions.GATE,a9)b.Info("Set gate option to ",a9)end end end).AsEmpty()a8.Option("ix").AsNumber().Must()a8.Option("endIx").AsNumber()a8.Option("toggleSkippable").AsEmptyBoolean()a8.Option("toggleSelectable").AsEmptyBoolean()a8.Option("margin").AsNumber()a8.Option("finalSpeed").AsNumber()a8.Option("maxSpeed").AsNumber()a8.Option("toggleGate").AsEmptyBoolean()o.Accept("route-print-pos-options",function(A)local T=S()if T==nil then return end;for W,Y in ipairs(PointOptions.ALL)do local aa=T.GetPointOption(A.commandValue,Y,nil)if aa~=nil then b.Info(Y,": ",aa)end end end).AsNumber()local ab=o.Accept("pos-save-current-as",function(A)if A.auto then local ac=u.FirstFreeWPName()if not ac then b.Error("Could not find a free waypoint name")return end;A.name=ac elseif not A.name then b.Error("No name provided")return end;local ad=e.CreatePos(Current()).AsPosString()if u.StoreWaypoint(A.name,ad)then b.Info("Current position saved as ",A.name)end end).AsEmpty()ab.Option("name").AsString()ab.Option("auto").AsEmptyBoolean()o.Accept("pos-save-as",function(A)local I=e.ParsePosition(A.pos)if I then u.StoreWaypoint(A.commandValue,I.AsPosString())end end).AsString().Must().Option("pos").AsString().Must()o.Accept("pos-list",function(F)for F,A in ipairs(u.GetWaypoints())do b.Info(A.name,": ",A.point:Pos())end end)local ae=o.Accept("pos-rename",function(A)u.RenameWaypoint(A.old,A.new)end)ae.Option("old").Must().AsString()ae.Option("new").Must().AsString()o.Accept("pos-delete",function(A)local af=u.DeleteWaypoint(A.commandValue)if af then b.Info("Deleted waypoint: '",A.commandValue,"', position was ",af.pos)end end).AsString().Must()local ag=o.Accept("pos-create-along-gravity",function(A)local ad=Current()-k()*A.u;local ah=e.CreatePos(ad).AsPosString()if u.StoreWaypoint(A.commandValue,ah)then b.Info("Stored postion ",ah," as ",A.commandValue)end end).AsString().Must()ag.Option("-u").AsNumber().Must()local ai=o.Accept("pos-create-relative",function(A)local aj=A.f or 0;local ak=A.u or 0;local w=A.r or 0;if aj==0 and ak==0 and w==0 then b.Error("Must provide atleast one direction distance")else local ad=Current()+Forward()*aj+Right()*w+Up()*ak;local ah=e.CreatePos(ad).AsPosString()if u.StoreWaypoint(A.commandValue,ah)then b.Info("Stored postion ",ah," as ",A.commandValue)end end end).AsString().Must()ai.Option("u").AsNumber()ai.Option("f").AsNumber()ai.Option("r").AsNumber()local al=o.Accept("pos-print-relative",function(A)local aj=A.f or 0;local ak=A.u or 0;local w=A.r or 0;if aj==0 and ak==0 and w==0 then b.Error("Must provide atleast one direction distance")else local ad=Current()+Forward()*aj+Right()*w+Up()*ak;local ah=e.CreatePos(ad).AsPosString()b.Info("Position is at: ",ah)end end)al.Option("u").AsNumber()al.Option("f").AsNumber()al.Option("r").AsNumber()local function am(A)local an=0;for F,ao in ipairs({"x","y","z"})do if A[ao]~=nil then an=an+1 end end;return an end;local ap=o.Accept("create-vertical-route",function(A)local aq=am(A)local ar;if aq==0 then ar=-k()elseif aq~=3 then b.Error("Either none or all three vector components must be provided")return else ar=Vec3.New(A.x,A.y,A.z)end;local T=u.CreateRoute(A.commandValue)if T then local as=T.AddCurrentPos()local at=as.Options()at.Set(PointOptions.LOCK_DIRECTION,Forward())at.Set(PointOptions.MARGIN,h.flight.defaultStartEndMargin)local au=Current()+ar*A.distance;local av=e.ClosestBody(Current())local aw=av:IsInAtmo(Current())local ax=e.ClosestBody(au)local ay=ax:IsInAtmo(au)if A.followGravInAtmo then if aw and ay then b.Warning("Start and end point are in atmosphere, skipping additional gravity-aligned point in space.")elseif ay and not aw then b.Error("Cannot calculate extra gravity aligned point when start point is not within atmosphere")return elseif aw and not ay then local az=Current()-k()*av:DistanceToAtmoEdge(Current())local aA=(az-au):Len()*0.05;az=az-k()*aA;local aB=T.AddCoordinate(az)aB.Options().Set(PointOptions.LOCK_DIRECTION,Forward())aB.Options().Set(PointOptions.MARGIN,A.extraPointMargin)b.Info("Added extra gravity-aligned point in space at ",aB.Pos(),"with a margin of ",A.extraPointMargin,"m")end end;local aC=T.AddCoordinate(au)local aD=aC.Options()aD.Set(PointOptions.LOCK_DIRECTION,Forward())aD.Set(PointOptions.MARGIN,h.flight.defaultStartEndMargin)if u.SaveRoute()then b.Info("Created a route by name '",A.commandValue,"' with start at current position and direction with the endpoint at ",aC.Pos())else b.Error("Could not create the route")end end end).AsString().Must()ap.Option("distance").AsNumber().Must()ap.Option("followGravInAtmo").AsEmptyBoolean()ap.Option("extraPointMargin").AsNumber().Default(5)ap.Option("x").AsNumber()ap.Option("y").AsNumber()ap.Option("z").AsNumber()local function aE(Z)return string.format("-x %0.14f -y %0.14f -z %0.14f",Z.x,Z.y,Z.z)end;o.Accept("print-vertical-up",function(F)b.Info(aE(-k()))end)local aF=o.Accept("sub-pos",function(A)local aF;if A.sub then local aG=e.ParsePosition(A.sub)if not aG then return end;aF=aG.Coordinates()else b.Info("No subtrahend specified, using current position")aF=Current()end;local ad=e.ParsePosition(A.commandValue)if ad then local aA=ad.Coordinates()-aF;local ar,aH=aA:NormalizeLen()b.Info("-distance ",aH," ",aE(ar))end end).AsString().Must()aF.Option("-sub").AsString()local aI=o.Accept("closest-on-line",function(A)local aJ=e.ParsePosition(A.a)local aK=e.ParsePosition(A.b)if not(aJ and aK)then return end;local I=d.NearestPointOnLine(aJ.Coordinates(),(aJ.Coordinates()-aK:Coordinates()):NormalizeInPlace(),Current())local aL=e.CreatePos(I)b.Info("Closest point on the line passing through a and b is at ",aL.AsPosString())end)aI.Option("a").AsString().Must()aI.Option("b").AsString().Must()o.Accept("get-parallel-from-route",function(A)local w=u.LoadRoute(A.commandValue)if not w then return end;local aM=w.Points()if#aM<2 then b.Error("Only one point in route, can't make a parallel point from that.")end;local aN=e.ParsePosition(aM[2].Pos()):Coordinates()local aO=e.ParsePosition(aM[1].Pos()):Coordinates()local aA=aN-aO;local ar,aH=aA:NormalizeLen()b.Info("-distance ",aH," ",aE(ar))end).AsString().Must()o.Accept("floor",function(A)r.ActivateFloorMode(A.commandValue)end).AsString().Must()end;local function aP(aQ)local aR;local a0=u.LoadWaypoint(aQ)if a0 then aR={pos=a0.Pos(),coord=e.ParsePosition(a0.Pos()).Coordinates()}else local ad=e.ParsePosition(aQ)if ad then aR={pos=ad.AsPosString(),coord=ad.Coordinates()}end end;if not aR then b.Error("Given input is not a :pos{} string or a named waypoint")end;return aR end;local function aS(aR,aT,aU,aV,aW)if aU~=0 then aU=d.Kph2Mps(aU)end;local aX=Vec3.zero;if aT then aX=Forward()end;i.Enable(false)p.GotoTarget(aR,aX,aV,aU,0,false,aW)g.Publish("ResetWSAD",true)b.Info("Moving to ",e.CreatePos(aR).AsPosString())end;function a.RegisterMoveCommands()local aY=function(A)local aR=Current()+Forward()*A.f+Right()*A.r-k()*A.u;aS(aR,A.lockdir,A.maxspeed,A.margin,A.forceVerticalUp)end;local aZ=o.Accept("move",aY)aZ.Option("-u").AsNumber().Must().Default(0)aZ.Option("-r").AsNumber().Must().Default(0)aZ.Option("-f").AsNumber().Must().Default(0)x(aZ)local a_=o.Accept("goto",function(A)local aR=aP(A.commandValue)if aR then local K,b0=(aR.coord-Current()):NormalizeLen()local b1=b0-A.offset;if b1>0 then aS(Current()+K*b1,A.lockdir,A.maxspeed,A.margin,A.forceVerticalUp)else b.Error("Offset larger than distance to target")end end end).AsString().Must()x(a_)a_.Option("offset").AsNumber().Default(0)local b2=function(A)local b3=-A.commandValue;p.Turn(b3,Up())end;o.Accept("turn",b2).AsNumber()local b4=function(A)local T=u.ActivateTempRoute()local a0=T.AddCoordinate(Current()+Right()*A.commandValue)local I=a0.Options()I.Set(PointOptions.LOCK_DIRECTION,{Forward():Unpack()})I.Set(PointOptions.MAX_SPEED,A.maxspeed or MaxSpeed())p.StartFlight()end;local b5=o.Accept("strafe",b4).AsNumber()b5.Option("-maxspeed").AsNumber()local function b6(ad)if ad then local T=u.ActivateTempRoute()T.AddCurrentPos()p.StartFlight()p.AlignTo(ad.Coordinates())b.Info("Aligning to ",ad.AsPosString())end end;o.Accept("align-to",function(A)local aR=aP(A.commandValue)if aR then local ad=e.ParsePosition(aR.pos)b6(ad)end end).AsString().Must()local b7=o.Accept("align-to-vector",function(A)local ad=e.CreatePos(Current()+Vec3.New(A.x,A.y,A.z))b6(ad)end)b7.Option("x").AsNumber().Must()b7.Option("y").AsNumber().Must()b7.Option("z").AsNumber().Must()o.Accept("set-waypoint",function(A)system.setWaypoint(A.commandValue,A.notify)end).AsString().Option("notify").AsEmptyBoolean()local b8=o.Accept("position-above",function(A)local b9=Vec3.New(A.cx,A.cy,A.cz)local ba=Vec3.New(A.fx,A.fy,A.fz)b.Info("Positioning above ",e.CreatePos(b9).AsPosString(),", with forward direction to ",e.CreatePos(ba).AsPosString())local w=u.ActivateTempRoute()w.AddCurrentPos()w.AddCoordinate(Current()-k()*A.heightMargin)local bb=(b9-e.ClosestBody(b9).Geography.Center):Normalize()ba=d.ProjectPointOnPlane(bb,b9,ba)local ar=(ba-b9):Normalize()w.AddCoordinate(b9+bb*A.heightMargin).Options().Set(PointOptions.LOCK_DIRECTION,ar)w.AddCoordinate(b9).Options().Set(PointOptions.LOCK_DIRECTION,ar)p.StartFlight()end).AsEmpty()b8.Option("heightMargin").AsNumber().Must()b8.Option("cx").AsNumber().Must()b8.Option("cy").AsNumber().Must()b8.Option("cz").AsNumber().Must()b8.Option("fx").AsNumber().Must()b8.Option("fy").AsNumber().Must()b8.Option("fz").AsNumber().Must()end;q.Callback("dockingMode",function(bc)bc=d.Clamp(bc,1,3)construct.setDockingMode(bc)end)return setmetatable(a,m)end;return m

      end)

      package.preload['YFS:../e/lib/src/util/Pagination.lua']=(function()

      local a={}function a.Paginate(b,c,d)if#b==0 then return{}end;local e=a.GetPageCount(b,d)c=math.min(e,math.max(c,1))local f=(c-1)*d+1;local g=f+d-1;local h={}local i=1;for j=f,g,1 do h[i]=b[j]i=i+1 end;return h end;function a.GetPageCount(b,d)return math.ceil(#b/d)end;return a

      end)

      package.preload['YFS:flight/route/Route.lua']=(function()

      require('YFS:../e/lib/src/abstraction/Vehicle.lua')require('YFS:GlobalTypes.lua')local a=require('YFS:Singletons.lua')local b,c,d,e=a.log,a.universe,a.calc,require('YFS:../e/lib/src/util/Pagination.lua')require('YFS:../e/lib/src/util/Table.lua')local f={}f.__index=f;function f.New()local a={}local g={}local h=1;local i={}local function j(k)return c.ParsePosition(g[k]:Pos()):Coordinates()end;function a.CheckBounds(k)return k>0 and k<=#g end;function a.Points()return g end;function a.AddPos(l)local m=c.ParsePosition(l)if m==nil then b.Error("Could not add position to route")return nil end;return a.AddPoint(Point.New(m:AsPosString()))end;function a.AddCoordinate(n)return a.AddPoint(Point.New(c.CreatePos(n):AsPosString()))end;function a.AddWaypointRef(o,m)if o==nil or#o==0 then return nil end;return a.AddPoint(Point.New(m or"",o))end;function a.AddCurrentPos()return a.AddCoordinate(Current())end;function a.AddPoint(p)g[#g+1]=p;return p end;function a.SetPointOption(q,r,s)if a.CheckBounds(q)then g[q].Options().Set(r,s)return true else b.Error("Point index outside bounds")return false end end;function a.GetPointOption(q,r,t)if a.CheckBounds(q)then local u=g[q].Options()return u.Get(r,t)else b.Error("Point index outside bounds")end;return t end;function a.Clear()g={}h=1 end;function a.Next()if a.LastPointReached()then return nil end;local v=g[h]h=h+1;return v end;function a.LastPointReached()return h>#g end;local function w()for x=1,#g-1 do g[x].Options().Set(PointOptions.LOCK_DIRECTION,g[x+1].Options().Get(PointOptions.LOCK_DIRECTION))end;ReverseInplace(g)end;function a.FindPointsWithin(y,z)local A={}for x,v in ipairs(g)do local B=j(x)if y:Dist(B)<=z then A[#A+1]=v end end;return A end;function a.FindClosestLeg(C)local D=1;local E=2;local F=math.maxinteger;local G=j(1)for x=2,#g,1 do local H=j(x)local I=C:Dist(d.NearestOnLineBetweenPoints(G,H,C))if I<F then F=I;D=x-1;E=x end;G=H end;return D,E end;function a.FindClosestPositionAlongRoute(n)local D,E=a.FindClosestLeg(n)return d.NearestOnLineBetweenPoints(j(D),j(E),n)end;local function J(D,E,K,L)local M={}for x=D,E do local N=g[x].Options().Get(PointOptions.SKIPPABLE,false)if x==D or x==E or x==K or x==L or not N then M[#M+1]=g[x]end end;g=M end;local function O(P,Q)local R=a.FindClosestPositionAlongRoute(P)local u=g[1].Options().Clone()u.Set(PointOptions.GATE,u.Get(PointOptions.GATE,false)and j(1):Dist(P)<Q)u.Set(PointOptions.LOCK_DIRECTION,g[2].Options().Get(PointOptions.LOCK_DIRECTION))g[1]=Point.New(c.CreatePos(R):AsPosString(),nil,u)end;function a.AdjustRouteBasedOnTarget(S,T,Q)local U,V=a.FindClosestLeg(S)local W;local X=#g;if V<=T then W="A"J(U,T,U,V)else W="B"J(T,V,U,V)w()end;O(S,Q)b.Info("Route adjusted (",W,": ",X," -> ",#g,")")end;function a.RemovePoint(k)if not a.CheckBounds(k)then return false end;table.remove(g,k)return true end;function a.MovePoint(Y,Z)if not a.CheckBounds(Y)or not a.CheckBounds(Z)or Z==Y then return false end;local _=table.remove(g,Y)table.insert(g,Z,_)return true end;function a.GetRemaining(a0)local a1=0;local G;for x=h,#g,1 do local m=c.ParsePosition(g[x].Pos())if m then if G then a1=a1+(G-m.Coordinates()):Len()end;G=m.Coordinates()end end;local k=d.Ternary(a.LastPointReached(),-1,0)local H=j(h+k)a1=a1+(a0-H):Len()return{Legs=#g-h,TotalDistance=a1}end;function a.GetPointPage(a2,a3)return e.Paginate(a.Points(),a2,a3)end;function a.GetPageCount(a3)return e.GetPageCount(a.Points(),a3)end;function a.WaitForGate(a4,z)local F=a.FindPointsWithin(a4,z)for a5,v in ipairs(F)do if v.Options().Get(PointOptions.GATE,false)then return true end end;return false end;function a.AddTag(a6)i[a6]=true end;function a.HasTag(a6)return i[a6]~=nil end;return setmetatable(a,f)end;return f

      end)

      package.preload['YFS:../e/lib/src/util/DistanceFormat.lua']=(function()

      local a=200000;local b=1000;function DistanceFormat(c)if c>=a then return{value=c/a,unit="su"}elseif c>=b then return{value=c/b,unit="km"}else return{value=c,unit="m"}end end;return DistanceFormat

      end)

      package.preload['YFS:flight/route/RouteController.lua']=(function()

      require('YFS:../e/lib/src/abstraction/Vehicle.lua')require('YFS:GlobalTypes.lua')local a=require('YFS:Singletons.lua')local b,c,d,e=a.log,a.pub,a.universe,a.constants;local f,g,h=require('YFS:flight/route/Route.lua'),require('YFS:../e/lib/src/util/Pagination.lua'),require('YFS:../e/lib/src/util/DistanceFormat.lua')require('YFS:../e/lib/src/util/Table.lua')local i={}i.__index=i;local j;i.NAMED_POINTS="NamedPoints"i.NAMED_ROUTES="NamedRoutes"function i.Instance(k)if j then return j end;local a={}local l=k;local m;local n;local o;local p;local q;local r;function a.GetRouteNames()local s=l.Get(i.NAMED_ROUTES)or{}local t={}for u,v in pairs(s)do if u==o then u=u.." (editing)"end;table.insert(t,u)end;table.sort(t)return t end;function a.GetRoutePage(w,x)return g.Paginate(a.GetRouteNames(),w,x)end;function a.GetPageCount(x)return g.GetPageCount(a.GetRouteNames(),x)end;function a.GetWaypointPage(w,x)return g.Paginate(a.GetWaypoints(),w,x)end;function a.GetWaypointPages(x)return g.GetPageCount(a.GetWaypoints(),x)end;local function y()local z={}for v,A in ipairs(a.GetWaypoints())do z[A.name]=A end;return z end;function a.FirstFreeWPName()local z=y()for B=1,999 do local C=string.format("WP%0.3d",B)if z[C]==nil then return C end end;return nil end;function a.RenameWaypoint(D,C)local z=y()local E=z[D]local F=z[C]if not E then b.Info("No waypoint by that name found")return elseif F then b.Info("A waypoint by that name already exists")end;Task.New("RenameWaypoint",function()if n~=nil then b.Error("Can't rename a waypoint when a route is being edited")return end;a.StoreWaypoint(C,E.point:Pos())for v,u in pairs(a.GetRouteNames())do local G=a.LoadRoute(u)if G then local H=false;for v,A in ipairs(G.Points())do if A.HasWaypointRef()and A.WaypointRef()==D then H=true;A.SetWaypointRef(C)b.Info("Waypoint ref. updated in route '",u,"': '",D,"' -> '",C,"'")end end;if H then a.StoreRoute(u,G)end end;coroutine.yield()end;a.DeleteWaypoint(D)end)end;function a.Count()return TableLen(a.GetRouteNames())end;function a.routeExists(u)local s=l.Get(i.NAMED_ROUTES)or{}return s[u]~=nil end;function a.LoadRoute(u)local s=l.Get(i.NAMED_ROUTES)or{}local I=s[u]if I==nil then b.Error("No route by name '",u,"' found.")return nil end;local J=f.New()if not I.points then b.Warning("Route is in an old format, please re-save it!")I.points=I end;for v,K in ipairs(I.points)do local A=Point.LoadFromPOD(K)if A.HasWaypointRef()then local L=A.WaypointRef()b.Debug("Loading waypoint reference '",L,"'")local M=a.LoadWaypoint(L)if M==nil then b.Error("The referenced waypoint '",L,"' in route '",u,"' was not found")return nil end;A=Point.New(M.Pos(),L,A.Options())end;J.AddPoint(A)end;b.Info("Route '",u,"' loaded")return J end;function a.LoadFloorRoute(u)q=a.LoadRoute(u)if a then r=u else r=nil end;return q end;function a.FloorRoute()return q end;function a.FloorRouteName()return r end;function a.SelectableFloorPoints()local N={}if q then local O=q.Points()local P=a.CalculateDistances(O)for B,A in ipairs(O)do if A.Options().Get(PointOptions.SELECTABLE,true)then N[#N+1]={visible=true,name=(function()if A.HasWaypointRef()then return A.WaypointRef()or""end;local Q=h(P[B])return string.format("%0.1f%s",Q.value,Q.unit)end)(),activate=string.format("route-activate '%s' -index %d",r,B),index=B}end end end;return N end;function a.EditRoute(u)if n~=nil then b.Error("A route is already being edited.")return nil end;n=a.LoadRoute(u)if n==nil then return end;o=u;c.Publish("RouteOpenedForEdit",true)return n end;function a.DeleteRoute(u)local s=l.Get(i.NAMED_ROUTES)or{}local J=s[u]if J==nil then b.Error("No route by name '",u,"' found.")return end;s[u]=nil;l.Put(i.NAMED_ROUTES,s)b.Info("Route '",u,"' deleted")if u==o then n=nil;o=nil;b.Info("No route is currently being edited")end end;function a.StoreRoute(u,J)local s=l.Get(i.NAMED_ROUTES)or{}local I={points={}}for v,A in ipairs(J.Points())do I.points[#I.points+1]=A.Persist()end;s[u]=I;l.Put(i.NAMED_ROUTES,s)b.Info("Route '",u,"' saved.")return true end;function a.RenameRoute(R,S)if a.routeExists(S)then b.Error("Route already exists")else local G=a.LoadRoute(R)if G then a.StoreRoute(S,G)a.DeleteRoute(R)b.Info("Route renamed from ",R," to ",S)return true end end;return false end;function a.StoreWaypoint(u,T)local A=d.ParsePosition(T)if A==nil then return false end;if u==nil or string.len(u)==0 then b.Error("No name provided")return false end;local U=l.Get(i.NAMED_POINTS)or{}U[u]=Point.New(T).Persist()l.Put(i.NAMED_POINTS,U)b.Info("Waypoint saved as '",u,"'")return true end;local function V()local W=l.Get(i.NAMED_POINTS)or{}return W end;function a.GetWaypoints()local X=V()local Y={}for u,v in pairs(X)do table.insert(Y,u)end;table.sort(Y)local t={}for v,u in pairs(Y)do table.insert(t,{name=u,point=a.LoadWaypoint(u,X)})end;return t end;function a.LoadWaypoint(u,U)if not u then return nil end;U=U or V()local Z=U[u]if Z==nil then return nil end;return Point.LoadFromPOD(Z)end;function a.DeleteWaypoint(u)local U=V()local _=U[u]if _ then U[u]=nil;l.Put(i.NAMED_POINTS,U)else b.Error("No waypoint by name '",u,"' found.")end;return _ end;function a.CurrentRoute()return m end;function a.CurrentEdit()return n end;function a.CurrentEditName()return o end;function a.doBasicCheckesOnActivation(u,a0)if not u or string.len(u)==0 then b.Error("No route name provided")return nil end;if o~=nil and u==o and n~=nil then b.Info("Cannot activate route currently being edited, please save first.")return nil end;local J=a.LoadRoute(u)if J==nil then return nil elseif#J.Points()<2 then b.Error("Less than 2 points in route '",u,"'")return nil end;if a0<1 or a0>#J.Points()then b.Error("Destination index must be >= 1 and <= ",#J.Points()," it was: ",a0)return nil end;return J end;function a.ActivateRoute(u,a0,a1,a2)a1=a1 or 0;a2=a2 or e.route.gateControlDistance;local a3=a.doBasicCheckesOnActivation(u,a0 or 1)if a3==nil then return false end;local a4=Current()a0=a0 or#a3.Points()a3.AdjustRouteBasedOnTarget(a4,a0,a2)local a5=a3.FindClosestPositionAlongRoute(a4)local a6=a5:Dist(a4)if a1>0 and a6>a1 then b.Error(string.format("Currently %0.2fm from closest point in route. Please move within %0.2fm of %s and try again.",a6,a1,d.CreatePos(a5):AsPosString()))return false end;m=a3;p=u;b.Info("Route '",u,"' activated at index "..a0)return true end;function a.ActivateTempRoute(u)m=f.New()p=u or"---"return m end;function a.CreateRoute(u)if n~=nil then b.Error("A route is being edited, can't create a new one.")return nil end;if u==nil or#u==0 then b.Error("No name provided for route")return nil end;if a.routeExists(u)then b.Error("Route already exists")return nil end;n=f.New()o=u;a.SaveRoute()b.Info("Route '",u,"' created")n=a.EditRoute(u)return n end;function a.SaveRoute()local t=false;if n and o~=nil then t=a.StoreRoute(o,n)o=nil;n=nil;b.Info("Route saved")t=true else b.Error("No route currently opened for edit.")end;return t end;function a.Discard()if n and o~=nil then n=nil;o=nil;b.Info("All changes discarded.")else b.Error("No route currently opened for edit, nothing to discard.")end end;function a.ActiveRouteName()return p end;function a.ActivateHoldRoute()local J=a.ActivateTempRoute()local A=J.AddCurrentPos()local a7=A.Options()a7.Set(PointOptions.LOCK_DIRECTION,{Forward():Unpack()})a7.Set(PointOptions.FORCE_VERT,true)end;function a.CalculateDistances(O)local Q={}if#O>0 then local a8=d.ParsePosition(O[1].Pos()):Coordinates()Q[#Q+1]=0;for B=2,#O do local a9=d.ParsePosition(O[B].Pos()):Coordinates()local aa=(a9-a8):Len()Q[#Q+1]=Q[#Q]+aa;a8=a9 end end;return Q end;j=setmetatable(a,i)return j end;return i

      end)

      package.preload['YFS:../e/lib/src/storage/DBStoredData.lua']=(function()

      local a=require("json")local function b(c)if type(c)~="table"then return nil end;local d=nil;for e,f in pairs(c)do local g=type(f)if g=="function"then return e else d=b(f)end;if d then return d end end;return d end;local h={}h.__index=h;function h.New(f,i)local g=type(f)local j=b(f)if j then error(string.format("Functions not allowed in PODs: '%s'",j))end;local k={valueType=g,value=f,dirty=i or false}function k.Persist()k.dirty=false;local l=a.encode({t=k.valueType,v=k.value})return l end;return setmetatable(k,h)end;function h.NewFromDB(m)if m~=nil then local n;xpcall(function()n=a.decode(m)end,traceback)if n~=nil and type(n)=="table"and n.t and n.v~=nil then return h.New(n.v)end end;return nil end;return h

      end)

      package.preload['YFS:../e/lib/src/storage/BufferedDB.lua']=(function()

      local a=require('YFS:../e/lib/src/system/Task.lua')local b=require('YFS:../e/lib/src/debug/Log.lua').Instance()require('YFS:../e/lib/src/util/Table.lua')local c=require('YFS:../e/lib/src/storage/DBStoredData.lua')local d={}d.__index=d;function d.New(e)if type(e)~="table"or not e.getStringValue then error("databank parameter of BufferedDB.New must be a link to a databank")end;local f={}local g={}local h=e;local i=false;local j=0;local k;local function l()i=true;while true do if f.IsDirty()then for m,n in pairs(g)do coroutine.yield()if n.dirty then h.setStringValue(m,n.Persist())j=j-1 end end end;coroutine.yield()end end;function f.BeginLoad()if k then return end;k=a.New("BufferedDB",function()local o=h.getKeyList()for p,q in ipairs(o)do local r=c.NewFromDB(h.getStringValue(q))if r then g[q]=r else b.Error("Could not load key '",q,"'")end;if p%20==0 then coroutine.yield()end end end).Then(l).Catch(function(s)b.Error("Error in BeginLoad:",s.Error())end)end;function f.Clear()if i then g={}j=0;h.clear()else error("Call to Clear before loading is completed")end end;function f.IsLoaded()return i end;function f.IsDirty()return j>0 end;function f.Get(m,t)if i then local u=g[m]if u then return u.value end else error("Call to Get before loading is completed")end;return t end;function f.Number(m,t)return f.Get(m,t)end;function f.Boolean(m,t)return f.Get(m,t)end;function f.Put(m,n)if i then g[m]=c.New(n,true)j=j+1 else error("Call to Put before loading is completed")end end;function f.Size()return TableLen(g)end;return setmetatable(f,d)end;return d

      end)

      package.preload['YFS:../e/lib/src/element/Container.lua']=(function()

      local a=library.getCoreUnit()local b=4;local c=6;local d=0.8;if a==nil then error("No core linked")end;local e={}e["basic container xs"]={Cap=1000,Factor=1}e["uncommon optimised container xs"]={Cap=1300,Factor=1}e["advanced optimised container xs"]={Cap=1690,Factor=1}e["rare optimised container xs"]={Cap=2197,Factor=1}e["exotic optimised container xs"]={Cap=2856,Factor=1}e["uncommon gravity-inverted container xs"]={Cap=900,Factor=0.9}e["advanced gravity-inverted container xs"]={Cap=810,Factor=0.81}e["rare gravity-inverted container xs"]={Cap=729,Factor=0.73}e["exotic gravity-inverted container xs"]={Cap=656,Factor=0.66}e["basic container s"]={Cap=8000,Factor=1}e["uncommon optimised container s"]={Cap=10400,Factor=1}e["advanced optimised container s"]={Cap=13520,Factor=1}e["rare optimised container s"]={Cap=17576,Factor=1}e["exotic optimised container s"]={Cap=22849,Factor=1}e["uncommon gravity-inverted container s"]={Cap=7200,Factor=0.9}e["advanced gravity-inverted container s"]={Cap=6480,Factor=0.81}e["rare gravity-inverted container s"]={Cap=5832,Factor=0.73}e["exotic gravity-inverted container s"]={Cap=5249,Factor=0.66}e["basic container m"]={Cap=64000,Factor=1}e["uncommon optimised container m"]={Cap=83200,Factor=1}e["advanced optimised container m"]={Cap=108160,Factor=1}e["rare optimised container m"]={Cap=140608,Factor=1}e["exotic optimised container m"]={Cap=182790,Factor=1}e["uncommon gravity-inverted container m"]={Cap=57600,Factor=0.9}e["advanced gravity-inverted container m"]={Cap=51840,Factor=0.81}e["rare gravity-inverted container m"]={Cap=46656,Factor=0.73}e["exotic gravity-inverted container m"]={Cap=41990,Factor=0.66}e["basic container l"]={Cap=128000,Factor=1}e["uncommon optimised container l"]={Cap=166400,Factor=1}e["advanced optimised container l"]={Cap=216320,Factor=1}e["rare optimised container l"]={Cap=281216,Factor=1}e["exotic optimised container l"]={Cap=365581,Factor=1}e["uncommon gravity-inverted container l"]={Cap=115200,Factor=0.9}e["advanced gravity-inverted container l"]={Cap=103680,Factor=0.81}e["rare gravity-inverted container l"]={Cap=93312,Factor=0.73}e["exotic gravity-inverted container l"]={Cap=83981,Factor=0.66}e["basic container xl"]={Cap=256000,Factor=1}e["uncommon optimised container xl"]={Cap=332800,Factor=1}e["advanced optimised atmoFuelTankHandlingcontainer xl"]={Cap=432640,Factor=1}e["rare optimised container xl"]={Cap=562432,Factor=1}e["exotic optimised container xl"]={Cap=731162,Factor=1}e["uncommon gravity-inverted container xl"]={Cap=230400,Factor=0.9}e["advanced gravity-inverted container xl"]={Cap=207360,Factor=0.81}e["rare gravity-inverted container xl"]={Cap=186624,Factor=0.73}e["exotic gravity-inverted container xl"]={Cap=167962,Factor=0.66}e["expanded basic container xxl"]={Cap=512000,Factor=1}e["expanded uncommon optimised container xxl"]={Cap=665600,Factor=1}e["expanded advanced optimised container xxl"]={Cap=865280,Factor=1}e["expanded rare optimised container xxl"]={Cap=1124864,Factor=1}e["expanded exotic optimised container xxl"]={Cap=1462323,Factor=1}e["expanded uncommon gravity-inverted container xxl"]={Cap=460800,Factor=0.9}e["expanded advanced gravity-inverted container xxl"]={Cap=414720,Factor=0.81}e["expanded rare gravity-inverted container xxl"]={Cap=373248,Factor=0.73}e["expanded exotic gravity-inverted container xxl"]={Cap=335923,Factor=0.66}e["atmospheric fuel tank xs"]={Cap=100,Factor=1,FuelMass=b}e["atmospheric fuel tank s"]={Cap=400,Factor=1,FuelMass=b}e["atmospheric fuel tank m"]={Cap=1600,Factor=1,FuelMass=b}e["atmospheric fuel tank l"]={Cap=12800,Factor=1,FuelMass=b}e["space fuel tank xs"]={Cap=100,Factor=1,FuelMass=c}e["space fuel tank s"]={Cap=400,Factor=1,FuelMass=c}e["space fuel tank m"]={Cap=1600,Factor=1,FuelMass=c}e["space fuel tank l"]={Cap=12800,Factor=1,FuelMass=c}e["rocket fuel tank xs"]={Cap=400,Factor=1,FuelMass=d}e["rocket fuel tank s"]={Cap=800,Factor=1,FuelMass=d}e["rocket fuel tank m"]={Cap=6400,Factor=1,FuelMass=d}e["rocket fuel tank l"]={Cap=50000,Factor=1,FuelMass=d}local function f(g)local h=e[g]if not h then error(string.format("Unknown container: %s",g))end;return h end;ContainerType={Standard=1,Atmospheric=2,Space=4,Rocket=8,Fuel=14,All=15}local i={}i.__index=i;local j;function i.New(k,l,m)local n={name=a.getElementNameById(k)}local function o(p)return m.Cap*(1+p/10)end;local function q(p)return m.Cap*(1+p/5)end;local function r()return a.getElementMassById(k)-l end;function n.FuelFillFactor(s)if not m.FuelMass then return 0 end;local t=r()local u=t;if s.FuelTankOptimization>0 or s.ContainerOptimization>0 then u=t/(1-(s.FuelTankOptimization+s.ContainerOptimization)*0.05)end;local v;if m.FuelMass==d then v=o(s.RocketFuelTankHandling)elseif m.FuelMass==c then v=q(s.SpaceFuelTankHandling)else v=q(s.AtmoFuelTankHandling)end;local w=u/m.FuelMass;local x=w/v;return x end;function n.ActualContentMass(s)local t=r()local u=t;if s.ContainerOptimization>0 then u=t/(1-s.ContainerOptimization*0.05)end;return u end;function n.Name()return n.name end;return setmetatable(n,i)end;local function y(k)local z=a.getElementItemIdById(k)local A=system.getItem(z)local B=A.displayNameWithSize:lower()local m=f(B)return i.New(k,A.unitMass,m)end;local function C(D,E)return D&E==E end;function i.GetAllCo(F)local G={}if not j then j={}j[ContainerType.Standard]={}j[ContainerType.Atmospheric]={}j[ContainerType.Space]={}j[ContainerType.Rocket]={}for H,k in ipairs(a.getElementIdList())do local I=a.getElementClassById(k)I=I:lower()if not I:find("itemcontainer")then if I:find("atmofuelcontainer")then table.insert(j[ContainerType.Atmospheric],y(k))elseif I:find("spacefuelcontainer")then table.insert(j[ContainerType.Space],y(k))elseif I:find("rocketfuelcontainer")then table.insert(j[ContainerType.Rocket],y(k))elseif I:find("container")and I:find("fuel")then table.insert(j[ContainerType.Standard],y(k))end end;if H%10==0 then coroutine.yield()end end end;if C(F,ContainerType.Atmospheric)then CopyList(G,j[ContainerType.Atmospheric])end;if C(F,ContainerType.Space)then CopyList(G,j[ContainerType.Space])end;if C(F,ContainerType.Rocket)then CopyList(G,j[ContainerType.Rocket])end;if C(F,ContainerType.Standard)then CopyList(G,j[ContainerType.Standard])end;return G end;return i

      end)

      package.preload['YFS:../e/lib/src/element/ContainerTalents.lua']=(function()

      local a={}a.__index=a;function a.New(b,c,d,e,f,g)local h={ContainerProficiency=b or 0,FuelTankOptimization=c or 0,ContainerOptimization=d or 0,AtmoFuelTankHandling=e or 0,SpaceFuelTankHandling=f or 0,RocketFuelTankHandling=g or 0}return setmetatable(h,a)end;return a

      end)

      package.preload['YFS:../e/render/src/native/Vec2.lua']=(function()

      local a=math.atan;local b=math.sqrt;local c=math.cos;local d=math.sin;local e=math.abs;local f={}f.__index=f;function f.New(g,h)local i={}if g and h then i.x=g;i.y=h elseif type(g)=="table"then i.x,i.y=g.x or g[1],g.y or g[2]elseif type(g)=="number"then i.x=g;i.y=g else i.x=0;i.y=0 end;return setmetatable(i,f)end;f.unit_x=f.New(1,0)f.unit_y=f.New(0,1)f.zero=f.New(0,0)function f.FromCartesian(j,k)return f.New(j*c(k),j*d(k))end;function f.Clone(l)return f.New(l.x,l.y)end;function f.Add(l,m)return f.New(l.x+m.x,l.y+m.y)end;function f.Sub(l,m)return f.New(l.x-m.x,l.y-m.y)end;function f.Mul(l,m)return f.New(l.x*m.x,l.y*m.y)end;function f.Div(l,m)return f.New(l.x/m.x,l.y/m.y)end;function f.Normalize(l)if l:IsZero()then return f.New()end;return l:Scale(1/l:Len())end;function f.Trim(l,n)return l:Normalize():Scale(math.min(l:Len(),n))end;function f.Cross(l,m)return l.x*m.y-l.y*m.x end;function f.Dot(l,m)return l.x*m.x+l.y*m.y end;function f.Len(l)return b(l.x*l.x+l.y*l.y)end;function f.Len2(l)return l.x*l.x+l.y*l.y end;function f.Dist(l,m)local o=l.x-m.x;local p=l.y-m.y;return b(o*o+p*p)end;function f.Dist2(l,m)local o=l.x-m.x;local p=l.y-m.y;return o*o+p*p end;function f.Scale(l,m)return f.New(l.x*m,l.y*m)end;function f.Rotate(l,q)local r=c(q)local i=d(q)return f.New(r*l.x-i*l.y,i*l.x+r*l.y)end;function f.Perpendicular(l)return f.New(-l.y,l.x)end;function f.AngleTo(l,m)if m then local s=a(m.y,m.x)-a(l.y,l.x)if s>math.pi then s=s-2*math.pi elseif s<=-math.pi then s=s+2*math.pi end;return s end;return a(l.y,l.x)end;function f.Lerp(l,m,i)return l+(m-l)*i end;function f.Unpack(l)return l.x,l.y end;function f.ComponentMin(l,m)return f.New(math.min(l.x,m.x),math.min(l.y,m.y))end;function f.ComponentMax(l,m)return f.New(math.max(l.x,m.x),math.max(l.y,m.y))end;function f.IsVec2(l)return type(l)=="table"and type(l.x)=="number"and type(l.y)=="number"end;function f.IsZero(l)return l.x==0 and l.y==0 end;function f.ToPolar(l)local j=b(l.x^2+l.y^2)local k=a(l.y,l.x)k=k>0 and k or k+2*math.pi;return j,k end;function f.FlipX(l)return f.New(-l.x,l.y)end;function f.FlipY(l)return f.New(l.x,-l.y)end;function f.Abs(l)return f.New(e(l.x),e(l.y))end;function f.ToString(l)return string.format("(%+0.3f,%+0.3f)",l.x,l.y)end;function f.__tostring(l)return l:ToString()end;function f.__unm(l)return f.New(-l.x,-l.y)end;function f.__eq(l,m)if not f.IsVec2(l)or not f.IsVec2(m)then return false end;return l.x==m.x and l.y==m.y end;function f.__add(l,m)return l:Add(m)end;function f.__sub(l,m)return l:Sub(m)end;function f.__mul(l,m)if f.IsVec2(m)then return l:Mul(m)end;return l:Scale(m)end;function f.__div(l,m)if f.IsVec2(m)then return l:Div(m)end;return l:Scale(1/m)end;function f.FromString(i)if i then local g,h=i:match("^%(%s?([+-]*%d*%.?%d+)%s?,%s?([+-]*%d*%.?%d+)%s?%)$")g=tonumber(g)h=tonumber(h)if g and h then return f.New(g,h)end end;return nil end;return f

      end)

      package.preload['YFS:info/Fuel.lua']=(function()

      require('YFS:GlobalTypes.lua')local a=require('YFS:Singletons.lua')local b,c=a.log,a.pub;local d,e,f,g=require('YFS:../e/lib/src/element/Container.lua'),require('YFS:../e/lib/src/element/ContainerTalents.lua'),require('YFS:../e/lib/src/system/Task.lua'),require('YFS:../e/render/src/native/Vec2.lua')require('YFS:../e/lib/src/util/Table.lua')local h={}h.__index=h;local i;function h.New(j)if i then return i end;local k=e.New(j.Number("containerProficiency",0),j.Number("fuelTankOptimization",0),j.Number("containerOptimization",0),j.Number("atmoFuelTankHandling",0),j.Number("spaceFuelTankHandling",0),j.Number("rocketFuelTankHandling",0))local a={}f.New("FuelMonitor",function()local l=Stopwatch.New()l.Start()local m={atmo=d.GetAllCo(ContainerType.Atmospheric),space=d.GetAllCo(ContainerType.Space),rocket=d.GetAllCo(ContainerType.Rocket)}while true do if l.IsRunning()and l.Elapsed()<2 then coroutine.yield()else local n={}for o,p in pairs(m)do for q,r in ipairs(p)do local s=r.FuelFillFactor(k)local t={name=r.Name(),factorBar=g.New(1,s),percent=s*100,visible=true,type=o}local u=n[o]or{}u[#u+1]=t;n[o]=u end;if n[o]then table.sort(n[o],function(v,w)return v.name<w.name end)end end;c.Publish("FuelByType",DeepCopy(n))l.Restart()end end end).Then(function(...)b.Info("No fuel tanks detected")end).Catch(function(x)b.Error(x.Name(),x.Error())end)j.Callback("containerProficiency",function(y)k.ContainerProficiency=y end)j.Callback("fuelTankOptimization",function(y)k.FuelTankOptimization=y end)j.Callback("containerOptimization",function(y)k.ContainerOptimization=y end)j.Callback("atmoFuelTankHandling",function(y)k.AtmoFuelTankHandling=y end)j.Callback("spaceFuelTankHandling",function(y)k.SpaceFuelTankHandling=y end)j.Callback("rocketFuelTankHandling",function(y)k.RocketFuelTankHandling=y end)i=setmetatable(a,h)return i end;return h

      end)

      package.preload['YFS:Settings.lua']=(function()

      local a,b,c=require('YFS:../e/lib/src/debug/Log.lua').Instance(),require('YFS:../e/lib/src/commandline/CommandLine.lua').Instance(),require('YFS:YFSConstants.lua')local d;local e={}e.__index=e;function e.Create(f)if d then return d end;local g={}local h={}local function i(j,k)local l=h[j]if l then for m,n in pairs(l)do n(k)end end end;local o={containerProficiency={default=0},fuelTankOptimization={default=0},containerOptimization={default=0},atmoFuelTankHandling={default=0},spaceFuelTankHandling={default=0},rocketFuelTankHandling={default=0}}local n=c.flight;local p=n.speedPid;local q=n.axis.light;local r=n.axis.heavy;local s=c.route;local t={engineWarmup={default=1},speedp={default=p.p},speedi={default=p.i},speedd={default=p.d},speeda={default=p.a},lightp={default=q.p},lighti={default=q.i},lightd={default=q.d},lighta={default=q.a},heavyp={default=r.p},heavyi={default=r.i},heavyd={default=r.d},heavya={default=r.a},autoShutdownFloorDistance={default=s.autoShutdownFloorDistance},autoBrakeDelay={default=1},yawAlignmentThrustLimiter={default=s.yawAlignmentThrustLimiter},pitchAlignmentThrustLimiter={default=s.pitchAlignmentThrustLimiter},rollAlignmentThrustLimiter={default=s.rollAlignmentThrustLimiter},autoPitch={default=false},routeStartDistanceLimit={default=s.routeStartDistanceLimit},showWidgetsOnStart={default=c.widgets.showOnStart},throttleStep={default=c.flight.throttleStep},manualControlOnStartup={default=false},turnAngle={default=c.flight.defaultTurnAngle},minimumPathCheckOffset={default=n.minimumPathCheckOffset},showFloor={default="-"},pathAlignmentAngleLimit={default=n.pathAlignmentAngleLimit},pathAlignmentDistanceLimit={default=n.pathAlignmentDistanceLimit},pathAlignmentDistanceLimitFromSurface={default=0},setWaypointAlongRoute={default=false},commChannel={default=""},shutdownDelayForGate={default=2},openGateWaitDelay={default=3},gateControlDistance={default=s.gateControlDistance},dockingMode={default=1},globalMaxSpeed={default=0},showRadarOnStart={default=false},defaultRadarMode={default=1},allowForwardToggle={default=false},autoBrakeAngle={default=45},parkMaxSpeed={default=50},parkMargin={default=0.5},parkVertDist={default=0},parkForwardDist={default=0},parkUseGates={default=false}}for u,v in pairs(o)do t[u]=v end;local w=b.Accept("set",function(x)for j,m in pairs(t)do local y=x[j]if y~=nil then f.Put(j,y)i(j,y)a.Info("Set '",j,"' to '",y,"'")end end end)for j,v in pairs(t)do local z=string.format("-%s",j)if type(v.default)=="number"then w.Option(z).AsNumber()elseif type(v.default)=="string"then w.Option(z).AsString()elseif type(v.default)=="boolean"then w.Option(z).AsBoolean()end end;b.Accept("reset-settings",function(m)for j,k in pairs(t)do f.Put(j,k.default)a.Info("Reset '",j,"' to '",k.default,"'")end;g.Reload()end)local A={autoBrakeDelay=0,allowForwardToggle=true,manualControlOnStartup=true,minimumPathCheckOffset=5000,turnAngle=8,yawAlignmentThrustLimiter=360,pitchAlignmentThrustLimiter=360,rollAlignmentThrustLimiter=360,pathAlignmentDistanceLimitFromSurface=0,autoPitch=true}local function B(C)for u,v in pairs(A)do if C then v=t[u].default end;f.Put(u,v)a.Info("Set ",u," to ",v)end;g.Reload()end;b.Accept("strict-mode",function()B(true)a.Info("Settings adjusted for strict mode")end)b.Accept("free-mode",function()B(false)a.Info("Settings adjusted for free mode")end)b.Accept("get",function(x)local D=t[x.commandValue]if D==nil then a.Error("Unknown setting: ",x.commandValue)return end;a.Info(x.commandValue,": ",g.Get(x.commandValue,D.default))end).AsString().Must()b.Accept("get-all",function(m)local E={}for j,m in pairs(t)do E[#E+1]=j end;table.sort(E)for m,j in pairs(E)do a.Info(j,": ",g.Get(j))end end)b.Accept("set-full-container-boosts",function(m)for j,m in pairs(o)do b.Exec(string.format("set -%s %d",j,5))end end)function g.Callback(j,F)if not h[j]then h[j]={}end;table.insert(h[j],F)end;function g.Get(j,G)local D=t[j]if G==nil then return f.Get(j,D.default)end;return f.Get(j,G)end;function g.Boolean(j,G)local v=g.Get(j,G)return v end;function g.Number(j,G)local v=g.Get(j,G)return v end;function g.String(j,G)local v=g.Get(j,G)return v end;function g.Reload()for j,m in pairs(t)do local H=g.Get(j)i(j,H)end end;d=setmetatable(g,e)return d end;function e.Instance()if not d then error("Settings not yet created")end;return d end;return e

      end)

      package.preload['YFS:flight/AxisControl.lua']=(function()

      require('YFS:../e/lib/src/abstraction/Vehicle.lua')local a,b,c=require('YFS:Singletons.lua'),require('YFS:../e/lib/src/math/Vec3.lua'),require("cpml/pid")local d,e,f=a.constants,a.pub,a.calc;local g,h,i,j,k=f.SignLargestAxis,f.SignedRotationAngle,unit.setEngineCommand,d.flight.lightConstructMassThreshold,b.zero;local l=180/math.pi;local m={}m.__index=m;ControlledAxis={Pitch=1,Roll=2,Yaw=3}local n={}n[ControlledAxis.Pitch]=k;n[ControlledAxis.Roll]=k;n[ControlledAxis.Yaw]=k;local o={}o.__index=o;function o.New(p)local q={}local r=nil;local s=nil;local t=nil;local u=nil;local v=nil;local w,x=require('YFS:Settings.lua').Instance(),d.flight.axis;local y=x.light;local z=x.heavy;local A=c(y.p,y.i,y.d,y.a)local B=c(z.p,z.i,z.d,z.a)w.Callback("lightp",function(C)A=c(C,A.i,A.d,A.amortization)end)w.Callback("lighti",function(C)A=c(A.p,C,A.d,A.amortization)end)w.Callback("lightd",function(C)A=c(A.p,A.i,C,A.amortization)end)w.Callback("lighta",function(C)A=c(A.p,A.i,A.d,C)end)w.Callback("heavyp",function(C)B=c(C,B.i,B.d,B.amortization)end)w.Callback("heavyi",function(C)B=c(B.p,C,B.d,B.amortization)end)w.Callback("heavyd",function(C)B=c(B.p,B.i,C,B.amortization)end)w.Callback("heavya",function(C)B=c(B.p,B.i,B.d,C)end)local D;local E=TotalMass()local F={speed=0,acceleration=0,offset=0}if p==ControlledAxis.Pitch then r=Forward;s=Right;t=LocalRight;D="PitchData"elseif p==ControlledAxis.Roll then r=Up;s=Forward;t=LocalForward;D="RollData"elseif p==ControlledAxis.Yaw then r=Forward;s=Up;t=LocalUp;D="YawData"end;function q.ReceiveEvents()u=system:onEvent("onUpdate",q.Update,q)end;function q.StopEvents()system:clearEvent("update",u)end;function q.SetTarget(G)if G==nil then q.Disable()else v=G end end;function q.Disable()v=nil;n[p]=k end;function q.Speed()local H=LocalAngVel()*l;H=H*t()return H:Len()*g(H)end;function q.Acceleration()local H=LocalAngAcc()*l;return(H*t()):Len()end;function q.AxisFlush(I)if v then local J=(v-Current()):Normalize()local K=h(s(),r(),J)F.offset=K*l;A:inject(K)B:inject(K)local C;if E>j then C=B:get()else C=A:get()end;n[p]=s()*C end end;function q.Apply()local L=n[ControlledAxis.Pitch]+n[ControlledAxis.Roll]+n[ControlledAxis.Yaw]i("torque",{0,0,0},{L:Unpack()},true,true,"","","",0.1)end;function q.Update()F.speed=q.Speed()F.acceleration=q.Acceleration()e.Publish(D,F)E=TotalMass()end;function q.OffsetDegrees()return F.offset end;return setmetatable(q,m)end;return o

      end)

      package.preload['YFS:flight/AxisManager.lua']=(function()

      local a=require('YFS:flight/AxisControl.lua')local b={}b.__index=b;local c;function b.Instance()if c then return c end;local d={}local e,f,g=a.New(ControlledAxis.Pitch),a.New(ControlledAxis.Roll),a.New(ControlledAxis.Yaw)function d.ReceiveEvents()e.ReceiveEvents()f.ReceiveEvents()g.ReceiveEvents()end;function d.StopEvents()e.StopEvents()f.StopEvents()g.StopEvents()end;function d.SetYawTarget(h)if h then g.SetTarget(h)else g.Disable()end end;function d.SetPitchTarget(h)if h then e.SetTarget(h)else e.Disable()end end;function d.SetRollTarget(h)if h then f.SetTarget(h)else f.Disable()end end;function d.Flush(i)e.AxisFlush(i)f.AxisFlush(i)g.AxisFlush(i)g.Apply()end;function d.Yaw()return g end;function d.Pitch()return e end;function d.Roll()return f end;c=setmetatable(d,b)return c end;return b

      end)

      package.preload['YFS:flight/AdjustmentTracker.lua']=(function()

      local a=require("cpml/pid")local b={}b.__index=b;function b.New(c)local d={}local e;if c then e=a(0.01,0.1,5,0.5)else e=a(1,0.5,5,0.5)end;local f=0;function d.LastDistance()return f end;function d.Feed(g)f=g;e:inject(g)return e:get()end;function d.ResetPID()e:reset()end;return setmetatable(d,b)end;return b

      end)

      package.preload['YFS:../e/lib/src/abstraction/Constants.lua']=(function()

      local a={PHYSICS_INTERVAL=1/60}return a

      end)

      package.preload['YFS:../e/lib/src/abstraction/Engine.lua']=(function()

      require('YFS:../e/lib/src/abstraction/Vehicle.lua')local a=require('YFS:../e/lib/src/util/Calc.lua')local b=require('YFS:../e/lib/src/abstraction/Constants.lua')local c=a.Ternary;local d=math.abs;local e=math.min;local f=construct.getMaxThrustAlongAxis;local function g()return f(IsInAtmo()and"longitudinal atmospheric_engine"or"longitudinal space_engine",{LocalForward():Unpack()})end;local function h()return f(IsInAtmo()and"lateral atmospheric_engine"or"lateral space_engine",{LocalRight():Unpack()})end;local function i()return f(IsInAtmo()and"vertical atmospheric_engine"or"vertical space_engine",{LocalUp():Unpack()})end;local function j()return f("vertical hover_engine",{LocalUp():Unpack()})end;local function k()return f("vertical booster_engine",{LocalUp():Unpack()})end;local l=1;local m=2;local n=3;local o=4;local function p(q,r)local s,t;if IsInAtmo()then s=l;t=m else s=n;t=o end;local u={FMaxPlus=0,FMaxMinus=0}for v,w in ipairs(q)do local x=w()u.FMaxPlus=u.FMaxPlus==0 and x[s]or u.FMaxPlus;u.FMaxMinus=u.FMaxMinus==0 and x[t]or u.FMaxMinus end;return r and u.FMaxPlus or u.FMaxMinus end;local y={}y.__index=y;local z;function y.Instance()if z then return z end;z={}function z.GetAvailableThrust(A,B,C)if B:IsZero()then return 0 end;B=a.WorldDirectionToLocal(B)local D=TotalMass()local E=a.WorldDirectionToLocal(GravityDirection())local F=Vec3.zero;if E:Dot(B)>0 then F=E*G()*D end;local H={{dir=-LocalRight(),thrust=d(z:MaxLeftwardThrust())},{dir=LocalRight(),thrust=d(z:MaxRightwardThrust())},{dir=-LocalUp(),thrust=d(z:MaxDownwardThrust())},{dir=LocalUp(),thrust=d(z:MaxUpwardThrust())},{dir=-LocalForward(),thrust=d(z:MaxBackwardThrust())},{dir=LocalForward(),thrust=d(z:MaxForwardThrust())}}local I=math.huge;local J=nil;for K,L in ipairs(H)do local M=L.dir:Dot(B)L.thrust=L.thrust+F:Dot(L.dir)if M>0.001 and L.thrust>0.01 then local N=L.thrust;if N<I then I=N end;if not J then J=L elseif L.dir:AngleTo(B)<J.dir:AngleTo(B)then J=L end end end;if not J then return 0 end;local O=J.thrust;if A and J.dir:AngleToDeg(B)>10 then O=I end;local P=B*O;if C and IsInAtmo()then P=P*AtmoDensity()end;return P:Len()/D end;function z:MaxForwardThrust()return p({g},true)end;function z:MaxBackwardThrust()return p({g},false)end;function z:MaxRightwardThrust()return p({h},true)end;function z:MaxLeftwardThrust()return p({h},false)end;function z:MaxUpwardThrust()return p({i,j,k},true)end;function z:MaxDownwardThrust()return p({i},false)end;return setmetatable(z,y)end;return y

      end)

      package.preload['YFS:../e/lib/src/util/Ray.lua']=(function()

      local a=require('YFS:../e/lib/src/math/Vec3.lua')local b={}b.__index=b;function b.New(c,d)local e={Start=c,Dir=d}return setmetatable(e,b)end;return b

      end)

      package.preload['YFS:flight/state/Hold.lua']=(function()

      require('YFS:../e/lib/src/abstraction/Vehicle.lua')local a=require('YFS:Singletons.lua')local b,c,d,e=a.log,a.pub,a.gateCtrl,a.timer;local f={}f.__index=f;local g="Hold"function f.New(h)local a={}local i=false;local j=h.GetSettings()local k=h.GetRouteController()local function l()if h.GetFlightCore().WaitForGate()then e.Add("WaitForGatesToClose",function()unit.exit()end,j.Number("shutdownDelayForGate"))else unit.exit()end end;function a.Enter()c.RegisterTable("FloorMonitor",a.floorMonitor)if h.GetFlightCore().WaitForGate()then d.Close()end end;function a.Leave()c.Unregister("FloorMonitor",a.floorMonitor)end;function a.Flush(m,n,o,p)if not n.WithinMargin(WPReachMode.EXIT)then h.SetState(Travel.New(h))end end;function a.Update()end;function a.AtWaypoint(q,n,o)i=q end;function a.Name()return g end;function a.floorMonitor(r,s)local t=k.CurrentRoute()local u=true;if t then u=t.HasTag("ReturnTag")or t.HasTag("RegularParkingTag")end;if(not IsFrozen()or u)and i and s.Hit and s.Distance<=j.Get("autoShutdownFloorDistance")then b.Info("Floor detected at last waypoint, going idle.")h.SetState(Idle.New(h))l()end end;function a.DisablesAllThrust()return false end;function a.PreventNextWp()return false end;setmetatable(a,f)return a end;return f

      end)

      package.preload['YFS:flight/state/Idle.lua']=(function()

      local a=require('YFS:Singletons.lua')local b,c=a.log,a.pub;local d={}d.__index=d;local e="Idle"function d.New(f)local a={}local g=f.GetSettings()function a.Enter()c.RegisterTable("FloorMonitor",a.floorMonitor)end;function a.Leave()c.Unregister("FloorMonitor",a.floorMonitor)end;function a.Flush(h,i,j,k)end;function a.Update()end;function a.AtWaypoint(l,i,j)end;function a.Name()return e end;function a.DisablesAllThrust()return true end;function a.floorMonitor(m,n)if not n.Hit or n.Distance>g.Get("autoShutdownFloorDistance")then b.Info("Floor not detected, holding position.")f.GetRouteController().ActivateHoldRoute()f.GetFlightCore().StartFlight()end end;function a.PreventNextWp()return false end;return setmetatable(a,d)end;return d

      end)

      package.preload['YFS:flight/state/Travel.lua']=(function()

      require('YFS:../e/lib/src/abstraction/Vehicle.lua')local a=require('YFS:Singletons.lua')local b=a.floorDetector;local c={}c.__index=c;local d="Travel"function c.New(e)local a={}local f=e.GetRouteController()local g;function a.Enter()g=f.CurrentRoute()end;function a.Leave()end;function a.Flush(h,i,j,k)if not e.CheckPathAlignment(Current(),k,j,i)then e.SetState(ReturnToPath.New(e,k))end end;function a.Update()if g and g.HasTag("RegularParkingTag")then local l=b.Measure()if l.Hit then e.GetFlightCore().StartParking(l.Distance,"Settling")end end end;function a.AtWaypoint(m,i,j)if m then e.SetState(Hold.New(e))end end;function a.Name()return d end;function a.DisablesAllThrust()return false end;function a.PreventNextWp()return false end;return setmetatable(a,c)end;return c

      end)

      package.preload['YFS:flight/state/ReturnToPath.lua']=(function()

      require('YFS:GlobalTypes.lua')local a={}a.__index=a;local b="ReturnToPath"function a.New(c,d)local e={}local f=nil;function e.Enter()end;function e.Leave()c.SetTemporaryWaypoint()end;function e.Flush(g,h,i,j)if not f then f=Waypoint.New(d,0,0,c.GetSettings().Number("minimumPathCheckOffset",2),0)f.LockYawTo(h.LockedYawDirection()or Plane.NewByVertialReference().Forward())f.ForceUpAlongVerticalRef()c.SetTemporaryWaypoint(f)end;if f.WithinMargin(WPReachMode.ENTRY)then c.SetState(Travel.New(c))end end;function e.Update()end;function e.AtWaypoint(k,h,i)end;function e.Name()return b end;function e.DisablesAllThrust()return false end;function e.PreventNextWp()return false end;return setmetatable(e,a)end;return a

      end)

      package.preload['YFS:flight/state/OpenGates.lua']=(function()

      require('YFS:GlobalTypes.lua')local a=require('YFS:Singletons.lua')local b,c,d=a.log,a.gateCtrl,a.timer;local e={}e.__index=e;local f="OpenGates"function e.New(g,h,i)local a={}local j=nil;local k=g.GetSettings().String("commChannel")~=""local l=g.GetSettings().Number("openGateWaitDelay")local m=Stopwatch.New()function a.Enter()if k then c.Open()b.Info("Requesting gates to open.")d.Add("WaitOnGate",function()b.Info("Waiting on gates to open")end,2)end end;function a.Leave()d.Remove("WaitOnGate")g.SetTemporaryWaypoint()end;function a.Flush(n,o,p,q)if not j then j=Waypoint.New(h,0,0,o.Margin(),0)j.LockYawTo(i)g.SetTemporaryWaypoint(j)end end;function a.Update()if k then if c.AreInDesiredState()then if m.Elapsed()>l then g.SetState(Travel.New(g))elseif not m.IsRunning()then m.Start()b.Info("Giving gates ",l," seconds to be fully open")end end else g.SetState(Travel.New(g))end end;function a.AtWaypoint(r,o,p)end;function a.Name()return f end;function a.DisablesAllThrust()return false end;function a.PreventNextWp()return true end;return setmetatable(a,e)end;return e

      end)

      package.preload['YFS:flight/state/Require.lua']=(function()

      if not FLIGHT_STATES_INCLUDED then FLIGHT_STATES_INCLUDED=true;Hold=require('YFS:flight/state/Hold.lua')Idle=require('YFS:flight/state/Idle.lua')Travel=require('YFS:flight/state/Travel.lua')ReturnToPath=require('YFS:flight/state/ReturnToPath.lua')OpenGates=require('YFS:flight/state/OpenGates.lua')end

      end)

      package.preload['YFS:flight/FlightFSM.lua']=(function()

      require('YFS:../e/lib/src/abstraction/Vehicle.lua')require('YFS:GlobalTypes.lua')local a,b,c,d,e,f,g=require('YFS:../e/lib/src/math/Vec3.lua'),require('YFS:flight/AxisManager.lua'),require('YFS:flight/AdjustmentTracker.lua'),require('YFS:../e/lib/src/abstraction/Engine.lua').Instance(),require("cpml/pid"),require('YFS:../e/lib/src/util/Ray.lua'),require('YFS:Singletons.lua')local h,i,j,k,l,m,n=g.log,g.universe,g.calc,g.constants,g.pub,g.input,g.brakes;local o,p,q,r,s,t,u=AirFrictionAcceleration,k.flight.lightConstructMassThreshold,k.flight.defaultMargin,j.Sign,a.zero,unit.setEngineCommand,unit.setEngineThrust;require('YFS:flight/state/Require.lua')local v=j.Clamp;local w=math.abs;local x=math.min;local y=math.max;local z=math.maxinteger;local A=j.AngleToDot(45)local B=j.Kph2Mps(360)local C=0.8;local D={}D.__index=D;function D.New(E,F,H)local I=E.Number("minimumPathCheckOffset")E.Callback("minimumPathCheckOffset",function(J)I=J end)local K=j.Kph2Mps(E.Number("globalMaxSpeed"))E.Callback("globalMaxSpeed",function(L)K=j.Kph2Mps(L)end)E.Callback("pathAlignmentAngleLimit",Waypoint.SetAlignmentAngleLimit)E.Callback("pathAlignmentDistanceLimit",Waypoint.SetAlignmentDistanceLimit)E.Callback("pitchAlignmentThrustLimiter",Waypoint.SetPitchAlignmentThrustLimiter)E.Callback("autoPitch",Waypoint.SetAutoPitch)E.Callback("autoBrakeAngle",n.SetAutoBrakeAngle)E.Callback("autoBrakeDelay",n.SetAutoBrakeDelay)local M=1;local N=TotalMass()local O=b.Instance()local P=O.Yaw()local Q=O.Roll()local R=O.Pitch()local S=1;local T=1;local U=1;local V=false;local W=false;local X=false;local Y=c.New(N<p)local Z=c.New(N<p)local a0=c.New(N<p)local a1={targetSpeed=0,targetSpeedReason="",finalSpeed=0,finalSpeedDistance=0,distanceToAtmo=-1,atmoDistance=0,brakeMaxSpeed=0,waypointDist=0,speedDiff=0,pid=0,fsmState="No state",acceleration=0,controlAcc=0,absSpeed=0}local a2={long=0,lat=0,ver=0}local a3;local a4;local a5=k.flight.speedPid;local a6=e(a5.p,a5.i,a5.d,a5.a)local g={}function g.SetBooster(a7)if a7~=V then V=a7;W=true;h.Info("Boosters ",V and"activated"or"deactivated")end end;function g.SelectWP(a8)if a4 then return a4,true end;return a8,false end;local function a9(aa)local ab=aa.Atmosphere;local ac=ab.Present and ab.Thickness*(1-C)or 0;return ac end;local function ad(ae,aa)if not aa.Atmosphere.Present then return false end;local af=aa.Atmosphere.Radius;local ag=af-a9(aa)local ah=(ae-aa.Geography.Center):Len()return ah<af and ah>=ag end;local function ai(aj,aa)local ak=Current()local al=aa.Geography.Center;local am,an,ao=j.LineIntersectSphere(f.New(ak,aj.DirectionTo()),al,aa.Atmosphere.Radius)am=am and not aa:IsInAtmo(ak)return am,an,ao end;local function ap(aq,ar,as)if ar>=0 and ar<aq then a1.targetSpeed=ar;a1.targetSpeedReason=as;return ar end;return aq end;local function at(au)local av=j.Kph2Mps(au)if au<2 then av=av*2 end;return av end;local function aw(ax,au)local ay;local az;if IsInAtmo()then if N>p then ay=20;az=0.3 else ay=0.5;az=0 end else ay=20;az=0.0 end;if au>ay or au<=az then return ax end;return ap(ax,at(au),"Approaching")end;local function aA(aj)local aB=aj.Margin()return Y.LastDistance()>aB or Z.LastDistance()>aB or a0.LastDistance()>aB end;local function aC()return construct.getFrictionBurnSpeed()*0.98 end;local function aD(aE,aF,aj,aG)local aH=aF:Len()local au=y(0,aj.DistanceTo()-(aH*aE+0.5*Acceleration():Len()*aE*aE))local ak=Current()local aI=i.CurrentGalaxy():BodiesInPath(f.New(ak,aF:Normalize()))[1]local aJ=false;local aK=false;local aL=AtmoDensity()a1.finalSpeed=aj.FinalSpeed()a1.finalSpeedDistance=au;local aM=false;local aN=-1;local aO=ap(z,construct.getMaxSpeed(),"Construct max")if aI then aM,_,aN=ai(aj,aI)aJ=aI:IsInAtmo(ak)aK=aJ and not aI:IsInAtmo(aj.Destination())a1.distanceToAtmo=aN end;if aj.MaxSpeed()>0 then aO=ap(aO,aj.MaxSpeed(),"Route")end;if aL>0 then aO=ap(aO,aC(),"Burn speed")end;local aP=aI and ad(ak,aI)local aQ=aP and aj.DirectionTo():Dot(GravityDirection())>0.7;if aQ then au=y(au,au-a9(aI))end;local aR=aC()if aM then a1.finalSpeed=aR;a1.finalSpeedDistance=aN;if aN<=aj.DistanceTo()then local aS=n.CalcMaxAllowedSpeed(aN,aR)aO=ap(aO,aS,"Atmo entry")end elseif aQ then aO=ap(aO,aR,"Dead Zone")end;if aJ and not aK and aj.FinalSpeed()<=B then local aT=n.MaxSeenGravityInfluencedAvailableAtmoDeceleration()*0.1;if aT>0 then local aU=aj.FinalSpeed()local aV=j.CalcBrakeDistance(B,aT)local aW=au-aV;if aW>0 then aO=ap(aO,n.CalcMaxAllowedSpeed(aW,B,-aT),"Appr. fin.")a1.finalSpeed=B;a1.finalSpeedDistance=aW else aO=ap(aO,n.CalcMaxAllowedSpeed(au,aU,-aT),"Final atmo")end end end;if aJ and w(n.EffectiveBrakeDeceleration())<=G()then aO=ap(aO,at(au),"Brake/ineff")local aX=aj.FinalSpeed()if aO<aX and aX>0 then aO=ap(aX+1,aX,"Final spd")end elseif aJ and aK then else local aY=n.CalcMaxAllowedSpeed(au,aj.FinalSpeed())aO=ap(aO,aY,"Brake")a1.brakeMaxSpeed=aY end;if not aJ then if aH>0 and aj.FinalSpeed()==0 then local aZ=au/aH;if aZ<=10 then aO=ap(aO,aO*0.5,"Brake/red")end end end;a1.waypointDist=au;if aj.FinalSpeed()==0 then aO=aw(aO,au)local a_=(aj.Destination()-aG.Destination()):Normalize()local b0=i.VerticalReferenceVector()local b1=a_:AngleToDeg(b0)<5 or a_:AngleToDeg(-b0)<5;if aj.IsLastInRoute()and aA(aj)and b1 and au<400 then aO=ap(aO,aO*0.5,"Adj. apr.")end end;if K>0 then aO=ap(aO,K,"Global max")end;if H.Limited(aj.DirectionTo())then aO=ap(aO,0,"Geofence")end;return aO end;local function b2(b3,b4,b5,aG,b6)if w(b3:Dot(b5:DirectionTo()))<A then local b7=b4+Velocity()*b6+0.5*Acceleration()*b6*b6;local b8=j.NearestOnLineBetweenPoints(aG.Destination(),b5.Destination(),b7)local b9=(b8-b7):ProjectOn(b3)return b9:NormalizeLen()else return a.zero,0 end end;local function ba(b3,bb,b4,b5,aG)local bc,bd=b2(b3,b4,b5,aG,0)local be,bf=b2(b3,b4,b5,aG,4)local bg=a.zero;if bc:Dot(be)<0 then if bf>q and N>p then bg=be*j.CalcBrakeAcceleration(Velocity():Dot(b3),bd)end else local bh=v(bb.Feed(bd),0,1)bg=bc*bh*d.GetAvailableThrust(false,bc)end;return bg,bd,r(bc:Dot(b3))end;local function bi(b4,b5,aG)local bj,bk,bl=ba(Up(),a0,b4,b5,aG)local bm,bn,bo=ba(Right(),Z,b4,b5,aG)local bp,bq,br=ba(Forward(),Y,b4,b5,aG)a2.lat=bn*bo;a2.long=bq*br;a2.ver=bk*bl;return bj+bm+bp end;local function bs(bt,bu)if bt==nil then t("thrust",{0,0,0},{0,0,0},true,true,"","","",1)return end;local bg=bu-i:VerticalReferenceVector()*G()-o()if w(P.OffsetDegrees())<S and w(R.OffsetDegrees())<U and w(Q.OffsetDegrees())<T then bg=bg+bt*m.Throttle()end;t("vertical analog",{bg:ProjectOn(Up()):Unpack()},{0,0,0},true,true,"airfoil","ground","analog",0.1)t("longitudinal analog",{bg:ProjectOn(Forward()):Unpack()},{0,0,0},true,true,"","","",0.1)local bv=o():ProjectOn(Right())*(X and IsInAtmo()and 2 or 0)t("lateral analog",{(bg:ProjectOn(Right())+bv):Unpack()},{0,0,0},true,true,"","","",0.1)if W then W=false;u("rocket_engine",V and 1 or 0)end end;local function bw(aE,aj,aG)local bx=aj.DirectionTo()local aF=Velocity()local aH=aF:Len()local by=aD(aE,aF,aj,aG)local bz=by-aH;a1.speedDiff=bz;if bz>=0 then a6:inject(bz/100)else a6:reset()end;local bA=v(a6:get(),0,1)a1.pid=bA;local bt;if aj.DistanceTo()<=q then bt=a.zero else bt=bx*bA*d.GetAvailableThrust(not X,bx)end;a1.controlAcc=bt:Len()return bt,by end;function g.FsmFlush(aE,bB,bC)if a3.DisablesAllThrust()then bs(nil,s)n.Feed(s,s,0)else local ak=Current()local bD=j.NearestOnLineBetweenPoints(bC.Destination(),bB.Destination(),ak)a3.Flush(aE,bB,bC,bD)if n.Active()then g.SetBooster(false)end;local bt,by=bw(aE,bB,bC)local bu=bi(ak,bB,bC)n.Feed(bB.DirectionTo(),bt:Normalize(),by)bs(bt,bu)end end;function g.SetState(bE)if a3~=nil then a3.Leave()end;if bE==nil then a1.fsmState="No state"return else a1.fsmState=bE:Name()bE.Enter()end;a3=bE end;function g.SetEngineWarmupTime(bF)M=bF*2 end;function g.CheckPathAlignment(b4,bG,aG,b5)local bH=aG.Destination()local bI=aG.Margin()local bJ=b5.Destination()local bK=b5.Margin()local ao=(bJ-bH):Len()local bz=bK-bI;local bL=0;if ao~=0 then bL=bz/ao end;local bM=x(ao,(bH-Current()):Len())local bN=bI+bL*bM;local bO=(bG-b4):Len()return bO<=y(I,bN)end;function g.SetTemporaryWaypoint(bP)a4=bP end;function g.Update()if a3~=nil then a1.acceleration=Acceleration():Len()a1.absSpeed=Velocity():Len()a3.Update()l.Publish("FlightData",a1)l.Publish("AdjustmentData",a2)end;N=TotalMass()X=IsFrozen()end;function g.AtWaypoint(bQ,bB,bC)if a3~=nil then a3.AtWaypoint(bQ,bB,bC)end end;E.Callback("engineWarmup",function(bR)g.SetEngineWarmupTime(bR)end)E.Callback("speedp",function(bR)a6=e(bR,a6.i,a6.d,a6.amortization)end)E.Callback("speedi",function(bR)a6=e(a6.p,bR,a6.d,a6.amortization)end)E.Callback("speedd",function(bR)a6=e(a6.p,a6.i,bR,a6.amortization)end)E.Callback("speeda",function(bR)a6=e(a6.p,a6.i,a6.d,bR)end)E.Callback("yawAlignmentThrustLimiter",function(bR)S=bR end)E.Callback("pitchAlignmentThrustLimiter",function(bR)U=bR end)E.Callback("rollAlignmentThrustLimiter",function(bR)T=bR end)function g.GetSettings()return E end;function g.GetRouteController()return F end;local bS;function g.SetFlightCore(bT)bS=bT end;function g.GetFlightCore()return bS end;function g.DisablesAllThrust()return a3 and a3.DisablesAllThrust()or false end;function g.PreventNextWp()return a3 and a3.PreventNextWp()or false end;g.SetState(Idle.New(g))return setmetatable(g,D)end;return D

      end)

      package.preload['YFS:flight/FlightCore.lua']=(function()

      require('YFS:../e/lib/src/abstraction/Vehicle.lua')require('YFS:GlobalTypes.lua')local a=require('YFS:Singletons.lua')local b,c,d,e,f,g,h,i=a.log,a.gateCtrl,a.pub,a.universe,a.calc,a.constants,a.brakes,a.floorDetector;local j=a.universe.VerticalReferenceVector;local k,l,m,n,o=require('YFS:flight/AxisManager.lua'),f.Ternary,Plane.NewByVertialReference(),math.abs,Stopwatch.New()require('YFS:flight/state/Require.lua')local p={}p.__index=p;local q;local r=0;local s=g.flight.defaultMargin;function p.CreateWPFromPoint(t,u,v)local w=t.Options()local x=Vec3.New(w.Get(PointOptions.LOCK_DIRECTION,Vec3.zero))local y=w.Get(PointOptions.MARGIN,s)local z;if w.Get(PointOptions.FORCE_FINAL_SPEED)then z=w.Get(PointOptions.FINAL_SPEED,r)else z=l(u,0,w.Get(PointOptions.FINAL_SPEED,r))end;local A=w.Get(PointOptions.MAX_SPEED,0)local B=e.ParsePosition(t.Pos()).Coordinates()local C=Waypoint.New(B,z,A,y,v)C.SetLastInRoute(u)if x~=Vec3.zero then C.LockYawTo(x,true)end;if w.Get(PointOptions.FORCE_VERT,false)then C.ForceUpAlongVerticalRef()end;return C end;function p.New(D,E)local a={}local F=0;local G=0;local H=k.Instance()local I=E.GetSettings()local J=Stopwatch.New()local function K()return Waypoint.New(Current(),0,0,s,0)end;local L=K()local M=L;local N=nil;function a.GetRouteController()return D end;function a.NextWP()if N==nil then return end;local O=N.Next()if O==nil then return end;M=L;L=p.CreateWPFromPoint(O,N.LastPointReached(),I.Number("pathAlignmentDistanceLimitFromSurface"))local P=(L.Destination()-M.Destination()):NormalizeInPlace()if n(P:Dot(m.Up()))>0.9 then L.LockYawTo(m.Forward(),false)end end;function a.WaitForGate()return N and c.Enabled()and N.WaitForGate(Current(),I.Number("gateControlDistance"))end;function a.StartParking(Q,R)if not i.Present()then b.Error("No floor detector present")return end;c.Enable(true)local S=Current()+j()*Q;d.Publish("ResetWSAD",true)a.GotoTarget(S,m.Forward(),1,f.Kph2Mps(I.Number("parkMaxSpeed")),0,false,true,R)D.CurrentRoute().AddTag("RegularParkingTag")end;function a.StartFlight()N=D.CurrentRoute()if not N then b.Error("Can't start a flight without a route")return end;J.Start()L=K()a.NextWP()if a.WaitForGate()then E.SetState(OpenGates.New(E,Current(),m.Forward()))else E.SetState(Travel.New(E))end end;function a.GoIdle()E.SetState(Idle.New(E))end;function a.Turn(T,U)local V=Current()local W=f.ProjectPointOnPlane(U,V,V+Forward()*Waypoint.DirectionMargin)W=f.RotateAroundAxis(W,V,T,U)local P=(W-Current()):NormalizeInPlace()L.LockYawTo(P,true)d.Publish("ForwardDirectionChanged",P)return P end;function a.AlignTo(t)if L then local V=Current()local X=f.ProjectPointOnPlane(-e.VerticalReferenceVector(),V,t)local P=(X-V):NormalizeInPlace()L.LockYawTo(P,true)d.Publish("ForwardDirectionChanged",P)end end;function a.ReceiveEvents()F=system:onEvent("onFlush",a.fcFlush)G=system:onEvent("onUpdate",a.fcUpdate)H.ReceiveEvents()end;function a.StopEvents()system:clearEvent("flush",F)system:clearEvent("update",G)H.StopEvents()end;function a.GotoTarget(S,x,y,A,z,Y,Z,R)local _=D.ActivateTempRoute(R)local a0=_.AddCoordinate(S)local w=a0.Options()w.Set(PointOptions.MAX_SPEED,A)w.Set(PointOptions.MARGIN,y)w.Set(PointOptions.FINAL_SPEED,z)w.Set(PointOptions.FORCE_FINAL_SPEED,Y)w.Set(PointOptions.FORCE_VERT,Z)if not x:IsZero()then w.Set(PointOptions.LOCK_DIRECTION,{x:Unpack()})end;a.StartFlight()end;function a.fcUpdate()local a1,a2,a3=xpcall(function()E.Update()h.BrakeUpdate()if N and J.Elapsed()>0.5 then J.Restart()d.Publish("RouteData",{remaining=N.GetRemaining(Current()),activeRouteName=D.ActiveRouteName()})end;if L~=nil then d.Publish("WaypointData",L)if I.Boolean("setWaypointAlongRoute",false)then system.setWaypoint(e.CreatePos(L.Destination()).AsPosString(),false)end end end,traceback)if not a1 then system.print(a2)unit.exit()end end;function a.fcFlush()local a1,a2,a3=xpcall(function()local a4=0;if not o.IsRunning()then o.Start()end;a4=o.Elapsed()o.Restart()if L and N then local a5=M;local a6,a7=E.SelectWP(L)if a7 then a5=Waypoint.New(Current(),0,0,L.Margin(),L.PathAlignmentDistanceLimitFromSurface())end;E.FsmFlush(a4,a6,a5)a6.PreCalc(a5)H.SetYawTarget(a6.Yaw(a5))H.SetPitchTarget(a6.Pitch(a5))H.SetRollTarget(a6.Roll(a5))if a6.WithinMargin(WPReachMode.ENTRY)then E.AtWaypoint(N.LastPointReached(),a6,a5)local x=(a6.Destination()-a5.Destination()):NormalizeInPlace()a6.LockYawTo(x,false)if not E.PreventNextWp()then a.NextWP()end end else unit.setEngineCommand("all",{0,0,0},{0,0,0},true,true,"","","",1)end;if not E.DisablesAllThrust()then H.Flush(a4)end;h:BrakeFlush()end,traceback)if not a1 then system.print(a2)unit.exit()end end;q=setmetatable(a,p)return q end;return p

      end)

      package.preload['YFS:../e/lib/src/util/ValueTree.lua']=(function()

      local a={}a.__index=a;function a.New()local b={}local c={}function b.Set(d,e)local f={}for g in string.gmatch(d,"[a-zA-Z0-9_]+")do table.insert(f,g)end;if not c then c={}end;local h=c;for i,g in ipairs(f)do if i==#f then break end;if not h[g]then h[g]={}end;h=h[g]end;h[f[#f]]=e end;function b.Pick()local j=c;c=nil;return j end;function b.Peek()return c end;return setmetatable(b,a)end;return a

      end)

      package.preload['YFS:screen/layout_out.lua']=(function()

      local a={fonts={p14={font="Play",size=14},p18={font="Play",size=18},p24={font="Play",size=24},p36={font="Play",size=36}},styles={bkgDark={fill="#000000ff"},bkgLight={fill="#111111ff"},icon={fill="#ffffffff"},headerText={fill="#555555ff",align="h0,v3"},headerTextRight={fill="#555555ff",align="h2,v3"},info={fill="#ffffffff",align="h2,v3"},units={fill="#ffffffff",align="h2,v3"},routeButton={align="h1,v2",fill="#546263ff"},routeButtonHover={fill="#2f6fd0ff"},routeCover={fill="#111111ff",stroke={color="#111111ff",distance=1}},routeEndpointText={fill="#000000ff",align="h1,v2"},routeName={fill="#ffffffff",align="h1,v3"},routeEditTableHeader={fill="#888888ff",align="h0, v3"},routeEditTableData={fill="#ffffffff",align="h0,v3"},routeEditTableDataCentered={fill="#ffffffff",align="h1,v3"},routeEditTableDataRight={fill="#ffffffff",align="h2,v3"},routeEditHover={fill="#2f6fd0ff",align="h0,v3"},routeEditHoverRight={fill="#2f6fd0ff",align="h2,v3"},routeEditHoverRed={fill="#ff0000ff",align="h0,v3"},routeEditTableDataCenteredHover={fill="#2f6fd0ff",align="h1,v3"},editRouteRouteName={fill="#ffffffff",align="h0,v3"},split={stroke={distance=2,color="#181818FF"}}},pages={status={components={{type="box",layer=1,style="bkgDark",pos1="(0,0)",pos2="(1024,240)"},{type="box",layer=1,style="icon",pos1="(40,20)",pos2="(60,40)",replicate={x_count=2,y_count=2,x_step=40,y_step=40}},{type="box",layer=1,style="icon",pos1="(60,40)",pos2="(80,60)"},{type="text",layer=1,style="headerText",pos1="(120,20)",text="Total mass",font="p18"},{type="text",layer=1,style="info",pos1="(280,50)",font="p36",text="$num(path{mass:total}:init{0}:format{%0.2f}:interval{0.5})"},{type="text",layer=1,style="units",pos1="(260,70)",font="p14",text="$str(path{mass:totalUnit}:init{kg}:interval{0.5})"},{type="text",layer=1,style="headerText",pos1="(300,20)",text="Current speed",font="p18"},{type="text",layer=1,style="info",pos1="(460,50)",font="p36",text="$num(path{flightData:absSpeed}:init{0}:format{%0.2f}:interval{0.5})"},{type="text",layer=1,style="units",pos1="(440,70)",font="p14",text="$str(path{flightData:speedUnit}:init{km/h}:interval{0.5})"},{type="text",layer=1,style="headerText",pos1="(480,20)",text="Current route",font="p18"},{type="text",layer=1,style="info",pos1="(640,50)",font="p36",text="$str(path{route/current:name}:init{-}:interval{0.5})"},{type="box",layer=1,style="icon",pos1="(60,140)",pos2="(80,160)",replicate={x_count=1,y_count=2,y_step=40}},{type="box",layer=1,style="icon",pos1="(40,160)",pos2="(60,180)",replicate={x_count=2,y_count=1,x_step=40}},{type="text",layer=1,style="headerText",pos1="(120,140)",text="Remaining distance",font="p18"},{type="text",layer=1,style="info",pos1="(280,170)",font="p36",text="$num(path{finalWp:distance}:init{0}:format{%0.2f}:interval{0.5})"},{type="text",layer=1,style="units",pos1="(260,190)",font="p14",text="$str(path{finalWp:distanceUnit}:init{km}:interval{0.5})"},{type="text",layer=1,style="headerText",pos1="(300,140)",text="Next WP distance",font="p18"},{type="text",layer=1,style="info",pos1="(460,170)",font="p36",text="$num(path{nextWp:distance}:init{0}:format{%0.2f}:interval{0.5})"},{type="text",layer=1,style="units",pos1="(440,190)",font="p14",text="$str(path{nextWp:distanceUnit}:init{km}:interval{0.5})"},{type="text",layer=1,style="headerText",pos1="(480,140)",text="Deviation",font="p18"},{type="text",layer=1,style="info",pos1="(640,170)",font="p36",text="$str(path{deviation:distance}:init{}:interval{0.5})"},{type="text",layer=1,style="units",pos1="(620,190)",font="p14",text="m"}}},floor={components={{type="box",layer=1,style="bkgLight",pos1="(0,241)",pos2="(1024,613)"},{type="box",layer=1,visible=true,pos1="(40,280)",pos2="(160,320)",style="routeButton",mouse={inside={set_style="routeButtonHover"},click={command="$str(path{floorSelection:routeName}:init{}:format{route-activate '%s'})"}}},{type="box",layer=1,visible=true,pos1="(40,300)",pos2="(60,320)",style="routeCover",replicate={x_count=2,x_step=160}},{type="box",layer=1,visible=true,pos1="(140,300)",pos2="(160,320)",style="routeCover",replicate={x_count=2,x_step=160}},{type="text",layer=1,visible=true,pos1="(100,300)",text="End",style="routeEndpointText",font="p14",hitable=false},{type="box",layer=1,visible=true,pos1="(40,380)",pos2="(160,420)",style="routeButton",mouse={inside={set_style="routeButtonHover"},click={command="$str(path{floorSelection:routeName}:init{}:format{route-activate '%s' -index 1})"}}},{type="text",layer=1,pos1="(100, 360)",visible=true,style="routeName",font="p24",text="$str(path{floorSelection:routeName}:init{})"},{type="box",layer=1,visible=true,pos1="(40,380)",pos2="(60,400)",style="routeCover"},{type="box",layer=1,visible=true,pos1="(140,380)",pos2="(160,400)",style="routeCover"},{type="text",layer=1,visible=true,pos1="(100,400)",text="Start",style="routeEndpointText",font="p14",hitable=false},{type="text",layer=1,style="routeEditTableData",font="p24",pos1="(180, 300)",text="$num(path{floorSelection/points/[#]:index}:init{0})",visible="$bool(path{floorSelection/points/[#]:visible}:init{false})",replicate={y_count=8,y_step=30,x_count=3,x_step=260,column_mode=true}},{type="text",layer=1,style="routeEditTableData",font="p24",pos1="(220, 300)",text="$str(path{floorSelection/points/[#]:name}:init{})",visible="$bool(path{floorSelection/points/[#]:visible}:init{false})",mouse={click={command="$str(path{floorSelection/points/[#]:activate}:init{}:format{%s})"},inside={set_style="routeEditHover"}},replicate={y_count=8,y_step=30,x_count=3,x_step=260,column_mode=true}},{type="text",layer=1,font="p24",style="routeEditTableData",pos1="(20,600)",text="$num(path{floorSelection:currentPage}:init{1}:format{< %0.0f})",mouse={click={command="#fl-prev-floor-page"},inside={set_style="routeEditHover"}}},{type="text",layer=1,font="p24",style="routeEditTableDataRight",pos1="(120,600)",text="$num(path{floorSelection:pageCount}:init{1}:format{ / %0.0f >})",mouse={click={command="#fl-next-floor-page"},inside={set_style="routeEditHoverRight"}}},{type="image",layer=2,pos1="(935,580)",dimensions="(20,20)",sub="(0,480)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",mouse={click={command="activatepage{status,routeSelection}"},inside={set_style="routeEditHover"}}},{type="text",layer=1,font="p24",style="routeEditTableData",pos1="(960,600)",text="Exit",mouse={click={command="activatepage{status,routeSelection}"},inside={set_style="routeEditHover"}}}}},routeSelection={components={{type="box",layer=1,style="bkgLight",pos1="(0,241)",pos2="(1024,613)"},{type="box",layer=1,visible="$bool(path{routeSelection/routes/[#]:visible}:init{false})",pos1="(40,280)",pos2="(160,320)",style="routeButton",mouse={inside={set_style="routeButtonHover"},click={command="$str(path{routeSelection/routes/[#]:name}:init{}:format{route-activate '%s'})"}},replicate={x_count=6,x_step=160}},{type="box",layer=1,visible="$bool(path{routeSelection/routes/[#]:visible}:init{false})",pos1="(40,300)",pos2="(60,320)",style="routeCover",replicate={x_count=6,x_step=160}},{type="box",layer=1,visible="$bool(path{routeSelection/routes/[#]:visible}:init{false})",pos1="(140,300)",pos2="(160,320)",style="routeCover",replicate={x_count=6,x_step=160}},{type="text",layer=1,visible="$bool(path{routeSelection/routes/[#]:visible}:init{false})",pos1="(100,300)",text="End",style="routeEndpointText",font="p14",hitable=false,replicate={x_count=6,x_step=160}},{type="box",layer=1,visible="$bool(path{routeSelection/routes/[#]:visible}:init{false})",pos1="(40,380)",pos2="(160,420)",style="routeButton",mouse={inside={set_style="routeButtonHover"},click={command="$str(path{routeSelection/routes/[#]:name}:init{}:format{route-activate '%s' -index 1})"}},replicate={x_count=6,x_step=160}},{type="text",layer=1,pos1="(100, 360)",visible="$bool(path{routeSelection/routes/[#]:visible}:init{false})",style="routeName",font="p24",text="$str(path{routeSelection/routes/[#]:name}:init{})",replicate={x_count=6,x_step=160}},{type="box",layer=1,visible="$bool(path{routeSelection/routes/[#]:visible}:init{false})",pos1="(40,380)",pos2="(60,400)",style="routeCover",replicate={x_count=6,x_step=160}},{type="box",layer=1,visible="$bool(path{routeSelection/routes/[#]:visible}:init{false})",pos1="(140,380)",pos2="(160,400)",style="routeCover",replicate={x_count=6,x_step=160}},{type="text",layer=1,visible="$bool(path{routeSelection/routes/[#]:visible}:init{false})",pos1="(100,400)",text="Start",style="routeEndpointText",font="p14",hitable=false,replicate={x_count=6,x_step=160}},{type="box",layer=1,visible="$bool(path{routeSelection/routes/[#]:visible}:init{false})",pos1="(40,440)",pos2="(160,460)",style="routeButton",mouse={inside={set_style="routeButtonHover"},click={command="$str(path{routeSelection/routes/[#]:name}:init{}:format{floor '%s'})"}},replicate={x_count=6,x_step=160}},{type="text",layer=1,visible="$bool(path{routeSelection/routes/[#]:visible}:init{false})",pos1="(100,450)",text="Waypoints",style="routeEndpointText",font="p14",hitable=false,replicate={x_count=6,x_step=160}},{type="text",layer=1,font="p24",style="routeEditTableData",pos1="(20,600)",text="$num(path{routeSelection:routePage}:init{1}:format{< %0.0f})",mouse={click={command="#rsel-prev-route-page"},inside={set_style="routeEditHover"}}},{type="text",layer=1,font="p24",style="routeEditTableDataRight",pos1="(120,600)",text="$num(path{routeSelection:pageCount}:init{1}:format{ / %0.0f >})",mouse={click={command="#rsel-next-route-page"},inside={set_style="routeEditHoverRight"}}},{type="image",layer=2,pos1="(800,580)",dimensions="(20,20)",sub="(0,460)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",mouse={click={command="activatepage{routeEdit}"},inside={set_style="routeEditHover"}}},{type="text",layer=1,pos1="(825,600)",text="Edit",style="routeEditTableData",font="p24",mouse={click={command="activatepage{routeEdit}"},inside={set_style="routeEditHover"}}},{type="image",layer=2,pos1="(880,580)",dimensions="(20,20)",sub="(0,0)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",mouse={click={command="activatepage{details}"},inside={set_style="routeEditHover"}}},{type="text",layer=1,pos1="(905,600)",text="Details",style="routeEditTableData",font="p24",mouse={click={command="activatepage{details}"},inside={set_style="routeEditHover"}}}}},routeEdit={components={{type="box",layer=1,style="bkgDark",pos1="(0,0)",pos2="(1024,613)"},{type="text",layer=1,style="headerText",font="p36",pos1="(30,50)",text="Waypoints"},{type="text",layer=1,style="routeEditTableHeader",font="p14",pos1="(30,110)",text="Waypoint name"},{type="text",layer=1,style="routeEditTableHeader",font="p14",pos1="(300,110)",text="Delete"},{type="text",layer=1,style="routeEditTableHeader",font="p14",pos1="(370,110)",text="Insert"},{type="text",layer=1,style="routeEditTableHeader",font="p14",pos1="(430,110)",text="Ins + facing"},{type="text",layer=1,style="routeEditTableData",font="p24",pos1="(30, 140)",text="$str(path{availableWaypoints/wayPoints/[#]:name}:init{})",visible="$bool(path{availableWaypoints/wayPoints/[#]:visible}:init{false})",mouse={click={command="$str(path{availableWaypoints/wayPoints/[#]:pos}:init{}:format{set-waypoint -notify %s})"},inside={set_style="routeEditHover"}},replicate={y_count=10,y_step=30}},{type="text",layer=1,style="routeEditTableData",font="p24",pos1="(300, 140)",text="X",visible="$bool(path{availableWaypoints/wayPoints/[#]:visible}:init{false})",mouse={click={command="$str(path{availableWaypoints/wayPoints/[#]:name}:init{}:format{pos-delete '%s'})"},inside={set_style="routeEditHoverRed"}},replicate={y_count=10,y_step=30}},{type="text",layer=1,style="routeEditTableData",font="p24",pos1="(370, 140)",text=">>",visible="$bool(path{availableWaypoints/wayPoints/[#]:visible}:init{false})",mouse={click={command="$str(path{availableWaypoints/wayPoints/[#]:name}:init{}:format{route-add-named-pos '%s'})"},inside={set_style="routeEditHover"}},replicate={y_count=10,y_step=30}},{type="text",layer=1,style="routeEditTableData",font="p24",pos1="(430, 140)",text=">>",visible="$bool(path{availableWaypoints/wayPoints/[#]:visible}:init{false})",mouse={click={command="$str(path{availableWaypoints/wayPoints/[#]:name}:init{}:format{route-add-named-pos '%s' -lockdir})"},inside={set_style="routeEditHover"}},replicate={y_count=10,y_step=30}},{type="image",layer=2,pos1="(165,540)",dimensions="(20,20)",sub="(0,1040)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",mouse={click={command="pos-save-current-as -auto"},inside={set_style="routeEditHover"}}},{type="text",layer=1,style="routeEditTableDataCentered",font="p24",pos1="(256, 560)",text="Add Current",visible=true,mouse={click={command="pos-save-current-as -auto"},inside={set_style="routeEditTableDataCenteredHover"}}},{type="text",layer=1,font="p24",style="routeEditTableData",pos1="(20,520)",text="$num(path{availableWaypoints:currentPage}:init{1}:format{< %0.0f})",mouse={click={command="#re-prev-wp-page"},inside={set_style="routeEditHover"}}},{type="text",layer=1,font="p24",style="routeEditTableDataRight",pos1="(120,520)",text="$num(path{availableWaypoints:pageCount}:init{1}:format{/ %0.0f >})",mouse={click={command="#re-next-wp-page"},inside={set_style="routeEditHoverRight"}}},{type="line",layer=1,pos1="(512,50)",pos2="(512,563)",style="split"},{type="text",layer=1,style="headerTextRight",font="p36",pos1="(994,50)",text="Routes"},{type="text",layer=1,font="p24",style="editRouteRouteName",pos1="(530,50)",text="$str(path{editRoute:selectRouteName}:init{})"},{type="text",layer=1,style="routeEditTableData",font="p24",text="$num(path{editRoute:ix}:init{1}:format{< %0.0f})",pos1="(530,100)",mouse={click={command="#re-previous-route"},inside={set_style="routeEditHover"}}},{type="text",layer=1,style="routeEditTableDataRight",font="p24",text="$num(path{editRoute:count}:init{1}:format{/ %0.0f >})",pos1="(630,100)",mouse={click={command="#re-next-route"},inside={set_style="routeEditHoverRight"}}},{type="image",layer=2,pos1="(815,84)",dimensions="(20,20)",sub="(0,20)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",mouse={click={command="$str(path{editRoute:selectRouteName}:format{route-edit '%s'}:init{})"},inside={set_style="routeEditHover"}}},{type="text",layer=1,font="p24",style="routeEditTableData",pos1="(840,100)",text="Edit",mouse={click={command="$str(path{editRoute:selectRouteName}:format{route-edit '%s'}:init{})"},inside={set_style="routeEditHover"}}},{type="image",layer=2,pos1="(895,84)",dimensions="(20,20)",sub="(0,120)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",mouse={click={command="$str(path{editRoute:selectRouteName}:format{route-delete '%s'}:init{})"},inside={set_style="routeEditHoverRed"}}},{type="text",layer=1,font="p24",style="routeEditTableData",pos1="(920,100)",text="Delete",mouse={click={command="$str(path{editRoute:selectRouteName}:format{route-delete '%s'}:init{})"},inside={set_style="routeEditHoverRed"}}},{type="text",layer=1,style="routeEditTableHeader",font="p14",pos1="(530,170)",text="Waypoint name"},{type="text",layer=1,style="routeEditTableHeader",font="p14",pos1="(720,170)",text="Gate"},{type="text",layer=1,style="routeEditTableHeader",font="p14",pos1="(770,170)",text="Skip"},{type="text",layer=1,style="routeEditTableHeader",font="p14",pos1="(820,170)",text="Sel"},{type="text",layer=1,style="routeEditTableHeader",font="p14",pos1="(870,170)",text="Up"},{type="text",layer=1,style="routeEditTableHeader",font="p14",pos1="(900,170)",text="Down"},{type="text",layer=1,style="routeEditTableHeader",font="p14",pos1="(950,170)",text="Remove"},{type="text",layer=1,style="routeEditTableDataRight",font="p24",pos1="(545, 200)",text="$num(path{editRoute/points/[#]:index}:init{0}:format{%0.f})",visible="$bool(path{editRoute/points/[#]:visible}:init{false})",replicate={y_count=10,y_step=30}},{type="text",layer=1,style="routeEditTableData",font="p24",pos1="(570, 200)",text="$str(path{editRoute/points/[#]:pointName}:init{})",visible="$bool(path{editRoute/points/[#]:visible}:init{false})",mouse={click={command="$str(path{editRoute/points/[#]:position}:init{}:format{set-waypoint -notify %s})"},inside={set_style="routeEditHover"}},replicate={y_count=10,y_step=30}},{type="image",layer=2,pos1="(720,180)",dimensions="(20,20)",sub="(0,180)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",visible="$bool(path{editRoute/points/[#]:gate}:init{false})",mouse={click={command="$num(path{editRoute/points/[#]:index}:init{0}:format{route-set-pos-option -ix %d -toggleGate})"},inside={set_style="routeEditHover"}},replicate={y_count=10,y_step=30}},{type="image",layer=2,pos1="(720,180)",dimensions="(20,20)",sub="(0,160)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",visible="$bool(path{editRoute/points/[#]:notGate}:init{false})",mouse={click={command="$num(path{editRoute/points/[#]:index}:init{0}:format{route-set-pos-option -ix %d -toggleGate})"},inside={set_style="routeEditHover"}},replicate={y_count=10,y_step=30}},{type="image",layer=2,pos1="(770,180)",dimensions="(20,20)",sub="(0,180)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",visible="$bool(path{editRoute/points/[#]:skippable}:init{false})",mouse={click={command="$num(path{editRoute/points/[#]:index}:init{0}:format{route-set-pos-option -ix %d -toggleSkippable})"},inside={set_style="routeEditHover"}},replicate={y_count=10,y_step=30}},{type="image",layer=2,pos1="(770,180)",dimensions="(20,20)",sub="(0,160)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",visible="$bool(path{editRoute/points/[#]:notSkippable}:init{false})",mouse={click={command="$num(path{editRoute/points/[#]:index}:init{0}:format{route-set-pos-option -ix %d -toggleSkippable})"},inside={set_style="routeEditHover"}},replicate={y_count=10,y_step=30}},{type="image",layer=2,pos1="(820,180)",dimensions="(20,20)",sub="(0,180)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",visible="$bool(path{editRoute/points/[#]:selectable}:init{false})",mouse={click={command="$num(path{editRoute/points/[#]:index}:init{0}:format{route-set-pos-option -ix %d -toggleSelectable})"},inside={set_style="routeEditHover"}},replicate={y_count=10,y_step=30}},{type="image",layer=2,pos1="(820,180)",dimensions="(20,20)",sub="(0,160)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",visible="$bool(path{editRoute/points/[#]:notSelectable}:init{false})",mouse={click={command="$num(path{editRoute/points/[#]:index}:init{0}:format{route-set-pos-option -ix %d -toggleSelectable})"},inside={set_style="routeEditHover"}},replicate={y_count=10,y_step=30}},{type="image",layer=2,pos1="(870,180)",dimensions="(20,20)",sub="(0,320)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",visible="$bool(path{editRoute/points/[#]:visible}:init{false})",mouse={click={command="$num(path{editRoute/points/[#]:index}:init{0}:format{route-move-pos-back %0.f})"},inside={set_style="routeEditHover"}},replicate={y_count=10,y_step=30}},{type="image",layer=2,pos1="(900,180)",dimensions="(20,20)",sub="(0,300)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",visible="$bool(path{editRoute/points/[#]:visible}:init{false})",mouse={click={command="$num(path{editRoute/points/[#]:index}:init{0}:format{route-move-pos-forward %0.f})"},inside={set_style="routeEditHover"}},replicate={y_count=10,y_step=30}},{type="text",layer=1,style="routeEditTableData",font="p24",pos1="(950, 200)",text="<<",visible="$bool(path{editRoute/points/[#]:visible}:init{false})",mouse={click={command="$num(path{editRoute/points/[#]:index}:init{0}:format{route-delete-pos %0.f})"},inside={set_style="routeEditHoverRed"}},replicate={y_count=10,y_step=30}},{type="text",layer=1,style="routeEditTableData",font="p24",text="$num(path{editRoute:currentPage}:init{1}:format{< %0.0f})",pos1="(530,520)",mouse={click={command="#re-prev-point-page"},inside={set_style="routeEditHover"}}},{type="text",layer=1,style="routeEditTableDataRight",font="p24",text="$num(path{editRoute:pageCount}:init{1}:format{/ %0.0f >})",pos1="(630,520)",mouse={click={command="#re-next-point-page"},inside={set_style="routeEditHoverRight"}}},{type="image",layer=2,pos1="(605,540)",dimensions="(20,20)",sub="(0,1040)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",mouse={click={command="route-add-current-pos"},inside={set_style="routeEditHover"}}},{type="text",layer=1,style="routeEditTableData",font="p24",pos1="(630, 560)",text="Add current",visible=true,mouse={click={command="route-add-current-pos"},inside={set_style="routeEditHover"}}},{type="image",layer=2,pos1="(765,540)",dimensions="(20,20)",sub="(0,1060)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",mouse={click={command="route-add-current-pos -lockdir"},inside={set_style="routeEditHover"}}},{type="text",layer=1,style="routeEditTableData",font="p24",pos1="(790, 560)",text="Add + facing",visible=true,mouse={click={command="route-add-current-pos -lockdir"},inside={set_style="routeEditHover"}}},{type="text",layer=1,font="p24",style="routeEditTableData",pos1="(630,600)",text="X Discard",mouse={click={command="route-discard"},inside={set_style="routeEditHoverRed"}}},{type="image",layer=2,pos1="(755,580)",dimensions="(20,20)",sub="(0,100)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",mouse={click={command="route-save"},inside={set_style="routeEditHover"}}},{type="text",layer=1,font="p24",style="routeEditTableData",pos1="(780,600)",text="Save",mouse={click={command="route-save"},inside={set_style="routeEditHover"}}},{type="image",layer=2,pos1="(935,580)",dimensions="(20,20)",sub="(0,480)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",mouse={click={command="activatepage{status,routeSelection}"},inside={set_style="routeEditHover"}}},{type="text",layer=1,font="p24",style="routeEditTableData",pos1="(960,600)",text="Exit",mouse={click={command="activatepage{status,routeSelection}"},inside={set_style="routeEditHover"}}}}},details={components={{type="box",layer=1,style="bkgDark",pos1="(0,0)",pos2="(1024,613)"},{type="text",pos1="(10, 25)",text="Version: 850e7fe / 20231223 22:22",layer=1,font="p24",style="routeEditTableData"},{type="text",layer=1,style="routeEditTableData",font="p24",text="$str(path{:floor}:format{Floor detection: %s}:init{0})",pos1="(10,50)"},{type="image",layer=2,pos1="(935,580)",dimensions="(20,20)",sub="(0,480)",subDimensions="(20,20)",style="icon",url="assets.prod.novaquark.com/94617/4158c26e-9db3-4a28-9468-b84207e44eec.png",mouse={click={command="activatepage{status,routeSelection}"},inside={set_style="routeEditHover"}}},{type="text",layer=1,font="p24",style="routeEditTableData",pos1="(960,600)",text="Exit",mouse={click={command="activatepage{status,routeSelection}"},inside={set_style="routeEditHover"}}}}}}}return a

      end)

      package.preload['YFS:../e/render/e/stream/e/serializer.lua']=(function()

      local a=table.concat;local b=string.format;local function c(table,d,e)e[d]="{"d=d+1;if#table==0 then local f=false;for g,h in pairs(table)do f=true;local i=type(g)if i=="string"then e[d]=b("[%q]=",g)elseif i=="number"then e[d]="["..g.."]="elseif i=="boolean"then e[d]="["..tostring(g).."]="else e[d]="notsupported="end;d=d+1;local j=type(h)if j=="table"then d=c(h,d,e)elseif j=="string"then e[d]=b("%q",h)elseif j=="number"then e[d]=h elseif j=="boolean"then e[d]=tostring(h)else e[d]='"Not Supported"'end;e[d+1]=","d=d+2 end;if f then d=d-1 end else for k=1,#table do local h=table[k]local j=type(h)if j=="table"then d=c(h,d,e)elseif j=="string"then e[d]=b("%q",h)elseif j=="number"then e[d]=h elseif j=="boolean"then e[d]=tostring(h)else e[d]='"Not Supported"'end;e[d+1]=","d=d+2 end;d=d-1 end;e[d]="}"return d end;function serialize(h)local e={}local j=type(h)if j=="table"then c(h,1,e)elseif j=="string"then return b("%q",h)elseif j=="number"then return h elseif j=="boolean"then return tostring(h)else return'"Not Supported"'end;return a(e)end;function deserialize(l)return load("return "..l)()end

      end)

      package.preload['YFS:../e/render/e/stream/src/Stream.lua']=(function()

      local a=require('YFS:../e/render/e/stream/e/serializer.lua')local b=string.byte;local c=table.concat;local d=1+1+1+2+1+3+1+1+1+2+1;local e="#%0.1d|%0.2x|%0.3d|%0.1d|%0.2d|%s"local f="^#(%d)|(%x%x)|(%d+)|(%d)|(%d+)|(.*)$"local g={Reset=0,Poll=1,Ack=2,Data=3}local h={}h.__index=h;function h.New(i,j,k)local l={}local m=i.BlockSize()-d;local getTime=getTime or system.getUtcTime;i.Clear()local n={queue={},waitingForReply=false,seq=-1,payloadChecksum=0}local o={queue={},waitingForReply=false,seq=0}local p=getTime()local function q(r)local s=0;for t=1,r:len()do s=s~b(r,t)end;return s end;local function u(v)n.queue[#n.queue+1]=v end;local function w(x)if x==0 then local y=c(n.queue)if q(y)==n.payloadChecksum then local z=deserialize(y)j.OnData(z)end;n.queue={}end end;local function A(B)if B==n.seq then return true end;n.seq=B;return false end;local function C(D,E,F,G,v,H)H=H or 0;F.seq=F.seq+1;if F.seq>9 then F.seq=0 end;v=v or""local I=string.format(e,D and 1 or 0,H,E,F.seq,G,v)return I end;local function J()local K=i.Read()local L,H,x,B,G,v=K:match(f)v=v or""local M=x and G and L and H;if M then G=tonumber(G)L=tonumber(L)x=tonumber(x)H=tonumber("0x"..H)M=G and x and L and H end;if not M then return true,nil,0,"",0 end;if A(B)then return true,nil,0,"",0 end;return L==1,G,x,v,H end;local function N()o.queue={}o.waitingForReply=false;n.queue={}n.waitingForReply=false end;function l.Tick()local L,G,x,v,H=J()if G then if L then n.payloadChecksum=H end;j.OnTimeout(false,l)p=getTime()if L then n.queue={}end;if i.IsController()then if G==g.Data then u(v)w(x)end;o.waitingForReply=false else local O=false;if G==g.Poll or G==g.Data then if G==g.Data then u(v)w(x)end;if#o.queue>0 then i.Send(table.remove(o.queue,1))else O=true end elseif G==g.Reset then N()O=true end;if O then i.Send(C(true,0,o,g.Ack))end end end;if getTime()-p>=k then j.OnTimeout(true,l)n.payloadChecksum=0;p=getTime()N()end;if i.IsController()and not o.waitingForReply then if#o.queue==0 then i.Send(C(true,0,o,g.Poll))else i.Send(table.remove(o.queue,1))end;o.waitingForReply=true end end;function l.Write(P)local r=serialize(P)local H=q(r)local E=math.ceil(r:len()/m)if E>999 then error("Too large data")end;local L=true;while r:len()>0 do E=E-1;local Q=r:sub(1,m)r=r:sub(m+1)o.queue[#o.queue+1]=C(L,E,o,g.Data,Q,H)L=false;H=0 end end;function l.WaitingToSend()return#o.queue>0 end;setmetatable(l,h)j.RegisterStream(l)return l end;return h

      end)

      package.preload['YFS:../e/render/e/stream/src/device/ScreenDevice.lua']=(function()

      local a={}a.__index=a;function a.New(b)local c={}function c.Send(d)b.setScriptInput(d)end;function c.Read()local d=b.getScriptOutput()b.clearScriptOutput()return d end;function c.Clear()b.clearScriptOutput()end;function c.IsController()return true end;function c.BlockSize()return 1024 end;return setmetatable(c,a)end;return a

      end)

      package.preload['YFS:../e/lib/src/util/MassFormat.lua']=(function()

      local a=1000;local b=1000*1000;function MassFormat(c)if c>=b then return{value=c/b,unit="kt"}elseif c>=a then return{value=c/a,unit="t"}else return{value=c,unit="kg"}end end;return MassFormat

      end)

      package.preload['YFS:controller/ScreenController.lua']=(function()

      require('YFS:../e/lib/src/abstraction/Vehicle.lua')require('YFS:GlobalTypes.lua')local a=require('YFS:Singletons.lua')local b,c,d,e,f=a.log,a.pub,a.strUtil,a.commandLine,a.calc;local g,h,i,j,k,l,m,n,o=require('YFS:../e/lib/src/util/ValueTree.lua'),require('YFS:screen/layout_out.lua'),require('YFS:../e/render/e/stream/src/Stream.lua'),require('YFS:../e/render/e/stream/src/device/ScreenDevice.lua'),require('YFS:../e/lib/src/util/Pagination.lua'),require('YFS:../e/lib/src/util/DistanceFormat.lua'),require('YFS:../e/lib/src/util/MassFormat.lua'),math.max,math.min;local p={}p.__index=p;function p.New(q,r)local a={}local s=false;local t=q.GetRouteController()local u=g.New()local v=1;local w=6;local x=1;local y=10;local z=1;local A=24;local B;local C="#re-"local D="#rsel-"local E="#fl-"local F=1;local G=10;local H=1;c.RegisterBool("RouteOpenedForEdit",function(I,I)H=1 end)function a.OnData(J)if J==nil then return end;local K=J["mouse_click"]if K~=nil then if d.StartsWith(K,C)then a.runRouteEditorCommand(d.RemovePrefix(K,C))elseif d.StartsWith(K,D)then a.runRouteSelectionCommand(d.RemovePrefix(K,D))elseif d.StartsWith(K,E)then a.runFloorSelectionCommand(d.RemovePrefix(K,E))else e.Exec(K)a.updateFloorData()a.updateEditRouteData()a.sendRoutes()end end end;function a.OnTimeout(L,B)if L then s=false elseif not s then B.Write({screen_layout=h})local M=r.String("showFloor")local N=false;if M~="-"then N=a.ActivateFloorMode(M)if not N then b.Error("Could not activate floor mode")end end;if not N then B.Write({activate_page="status,routeSelection"})end;a.sendRoutes()s=true end end;function a.RegisterStream(B)end;function a.runRouteEditorCommand(O)if O=="previous-route"then F=n(1,F-1)elseif O=="next-route"then F=o(#t.GetRouteNames(),F+1)elseif O=="prev-point-page"then local P=t.CurrentEdit()if P then H=n(1,H-1)end elseif O=="next-point-page"then local P=t.CurrentEdit()if P then H=o(H+1,P.GetPageCount(G))end elseif O=="prev-wp-page"then x=n(1,x-1)elseif O=="next-wp-page"then x=o(x+1,t.GetWaypointPages(y))end;a.updateEditRouteData()end;function a.runRouteSelectionCommand(O)if O=="next-route-page"then v=o(v+1,t.GetPageCount(w))elseif O=="prev-route-page"then v=n(1,v-1)end;a.sendRoutes()end;function a.runFloorSelectionCommand(O)if O=="next-floor-page"then z=o(z+1,k.GetPageCount(t.SelectableFloorPoints(),A))elseif O=="prev-floor-page"then z=n(1,z-1)end;a.updateFloorData()end;function a.sendRoutes()local Q={routePage=v,pageCount=t.GetPageCount(w),routes={}}for R,P in ipairs(t.GetRoutePage(v,w))do Q.routes[tostring(R)]={visible=true,name=P}end;for R=TableLen(Q.routes)+1,w,1 do Q.routes[tostring(R)]={visible=false,name=""}end;u.Set("routeSelection",Q)end;function a.updateEditRouteData()local S=t.GetRouteNames()local T={ix=F,count=#S,currentPage=H,pageCount=H,selectRouteName="",routeName="",points={}}if#S>0 then T.selectRouteName=S[F]end;local U=t.CurrentEdit()local V=0;if U then T.name=t.CurrentEditName()T.pageCount=U.GetPageCount(G)local W=U.GetPointPage(H,G)V=#W;local X=t.CalculateDistances(W)for Y,Z in ipairs(W)do local _=Z.Options()local a0=_.Get(PointOptions.GATE,false)local a1=_.Get(PointOptions.SKIPPABLE,false)local a2=_.Get(PointOptions.SELECTABLE,true)local a3={visible=true,index=Y+(H-1)*G,position=Z.Pos(),gate=a0,notGate=not a0,skippable=a1,notSkippable=not a1,selectable=a2,notSelectable=not a2}if Z.HasWaypointRef()then a3.pointName=Z.WaypointRef()else local a4=l(X[Y])a3.pointName=string.format("%0.1f%s",a4.value,a4.unit)end;T.points[tostring(Y)]=a3 end else T.name="-"end;for R=V+1,G,1 do T.points[tostring(R)]={visible=false,gate=false,notGate=false,skippable=false,notSkippable=false,selectable=false,notSelectable=false}end;u.Set("editRoute",T)local a5={currentPage=x,pageCount=t.GetWaypointPages(y),wayPoints={}}local a6=t.GetWaypointPage(x,y)for Y,Z in ipairs(a6)do a5.wayPoints[tostring(Y)]={visible=true,name=Z.name,pos=Z.point.Pos()}end;for R=#a6+1,y,1 do a5.wayPoints[tostring(R)]={visible=false}end;u.Set("availableWaypoints",a5)end;function a.updateFloorData()local W=t.SelectableFloorPoints()local a7={routeName=t.FloorRouteName(),points={},currentPage=z,pageCount=k.GetPageCount(W,A)}local a2=k.Paginate(W,z,A)a7.currentPage=z;for R,Z in ipairs(a2)do a7.points[tostring(R)]=Z end;for R=#a2+1,A,1 do a7.points[tostring(R)]={visible=false,name="",index="0"}end;u.Set("floorSelection",a7)end;function a.ActivateFloorMode(a8)local P=t.LoadFloorRoute(a8)if P then z=1;a.updateFloorData()B.Write({activate_page="status,floor"})end;return P~=nil end;local function a9()local aa=library.getLinkByClass("ScreenUnit")if not aa then return end;b.Info("Screen found")local ab=Stopwatch.New()ab.Start()c.RegisterTable("FlightData",function(I,J)u.Set("flightData/absSpeed",f.Mps2Kph(J.absSpeed))local ac=l(J.waypointDist)u.Set("nextWp/distance",ac.value)u.Set("nextWp/distanceUnit",ac.unit)ac=m(TotalMass())u.Set("mass/total",ac.value)u.Set("mass/totalUnit",ac.unit)end)c.RegisterTable("RouteData",function(I,J)local ac=l(J.remaining.TotalDistance)u.Set("finalWp/distance",ac.value)u.Set("finalWp/distanceUnit",ac.unit)u.Set("route/current/name",J.activeRouteName)end)c.RegisterTable("AdjustmentData",function(I,J)u.Set("deviation/distance",string.format("%0.2f",Vec3.New(J.long,J.lat,J.ver):Len()))end)c.RegisterTable("FloorMonitor",function(I,ad)local ae=string.format("Hit: %s, distance: %0.2f, limit: %0.2f",tostring(ad.Hit),ad.Distance,r.Number("autoShutdownFloorDistance"))u.Set("floor",ae)end)B=i.New(j.New(aa),a,1)while aa do aa.activate()coroutine.yield()B.Tick()if not B.WaitingToSend()then if not ab.IsRunning()or ab.Elapsed()>2 then a.sendRoutes()a.updateEditRouteData()ab.Restart()end;local J=u.Pick()if J then B.Write(J)else B.Write('{"keepalive": ""}')end end end end;Task.New("ScreenController",a9).Then(function(...)b.Info("No screen connected")end).Catch(function(af)b.Error(af.Name(),af.Error())end)return setmetatable(a,p)end;return p

      end)

      package.preload['YFS:../e/render/e/stream/src/device/RxTx.lua']=(function()

      local a={}a.__index=a;function a.New(b,c,d,e)local f={}local g=d..(e and"-ctrl"or"-worker")local h=d..(e and"-worker"or"-ctrl")local i={}c.setChannelList({h})c:onEvent("onReceived",function(j,k,l)l=l:gsub("&#34;","\"")i[#i+1]=l end)function f.Send(m)m=m:gsub("\"","&#34;")b.send(g,m)end;function f.Read()return table.remove(i,1)or""end;function f.Clear()end;function f.IsController()return e end;function f.BlockSize()return 512 end;return setmetatable(f,a)end;return a

      end)

      package.preload['YFS:controller/Communication.lua']=(function()

      local a,b,c=require('YFS:Singletons.lua'),require('YFS:../e/render/e/stream/src/device/RxTx.lua'),require('YFS:../e/render/e/stream/src/Stream.lua')local d,e,f,g=a.log,a.pub,library.getLinkByClass("ReceiverUnit"),library.getLinkByClass("EmitterUnit")local h={}h.__index=h;function h.New(i)local j={}local k;local l=true;local m={}local function n()for o,p in pairs(m)do return o,p end;return nil,nil end;e.RegisterTable("SendData",function(q,r)if r.topic and r.data then m[r.topic]=r else d.Error("Got data to send without topic or value")end end)function j.OnData(s)local t=s.topic;local u=s.data;if not(t and u)then d.Error("Received data without topic or value")return end;m[t]=nil;e.Publish("RecData-"..t,u)end;function j.OnTimeout(v,k)if l and not v then d.Info("Communication established")elseif not l and v then d.Info("Communication lost")end;l=v end;function j.RegisterStream(k)end;setmetatable(j,h)if not(f and g)then d.Error("Emitter or receiver not linked")else k=c.New(b.New(g,f,i,true),j,1)system:onEvent("onUpdate",function()local t,u=n()if t and u then if not k.WaitingToSend()then k.Write(u)end;k.Tick()end end)d.Info("Communication enabled")end;return j end;return h

      end)

      package.preload['YFS:../e/STL/src/Template.lua']=(function()

      local function a(b)return'print(\''..b:gsub('\'','\\\''):gsub('\n','\\n')..'\')'end;local function c(...)local d={...}local e={}for f,g in pairs(d)do for h,i in pairs(g)do e[h]=i end end;return e end;local function j(b,k)local f=0;for l in b:gmatch("([^\n]*)\n?")do f=f+1;if f==k then return l end end;return nil end;local function m(b)return b:gsub("^%s*(.-)%s*$","%1")end;local n={globals={math=math,table=table,string=string,ipairs=ipairs,pairs=pairs}}function n.__call(self,...)return n.render(self,({...})[1])end;function n:render(o)if type(o or{})~='table'then error('Template parameters must be a table, got '..type(o))end;local f={}local p=c(n.globals,self.globals or{},o or{},{print=function(b)table.insert(f,tostring(b or''))end})self.callable(p)local e=table.concat(f,''):gsub('%s+',' ')e=e:sub(e:find('[^%s]')or 1):gsub('%s*$','')return e end;function n.new(q,r,s)local self={source=q,globals=r}local t=coroutine and coroutine.isyieldable()and coroutine.yield or function()end;q=q:gsub('{{(.-)}}','{%% print(%1) %%}')q=q:gsub('\n%s*{%%','{%%')q=q:gsub('%%}\n','%%}')local u={}while#q>0 do local v=q:find('{%%')local w=q:find('%%}')if v then if not w then error('Template error, missing Lua closing tag near: '..q:sub(0,16))end;local x=q:sub(1,v-1)if#x then table.insert(u,a(x))end;local y=q:sub(v,w+1):match('{%%(.-)%%}')or''table.insert(u,y)q=q:sub(w+2)else table.insert(u,a(q))q=''end;t()end;self.code=table.concat(u,'\n')local z=string.format('return function (_) _ENV = _; _ = _ENV[_]\n%s\nend',self.code)local f,A=load(z,nil,'t',{})if f and not A then f=f()end;if A then local f,k,B=A:match('^(.-):(%d+):(.+)')local C=j(self.source,k-1)local D=j(self.code,k-1)local E={raw=A,line=k-1,near=m(C or'N/A'),nearLua=m(D or'N/A'),message=m(B)}if s then s(self,E)else error(('Failed compiling template!\nError: %s\nLine: %d\nNear: %s\nCode: %s'):format(E.message,E.line,E.near,E.nearLua))end;return nil else self.callable=f end;return setmetatable(self,n)end;return n.new

      end)

      package.preload['YFS:hud/Hud.lua']=(function()

      require('YFS:GlobalTypes.lua')local a=require('YFS:Singletons.lua')local b,c,d,e,f=a.log,a.pub,a.input,a.calc,require('YFS:../e/STL/src/Template.lua')local g='<!DOCTYPE html>\n<html>\n\n<head>\n <style>\n .logo {\n position: fixed;\n top: 20px;\n left: 20px;\n }\n\n .ecuColor {\n color: rgb(255, 0, 0);\n }\n\n .throttleColor {\n color: white;\n }\n\n .throttle {\n position: fixed;\n top: 20px;\n left: 60px;\n font: 18px Montserrat;\n text-shadow: 2px 2px black;\n }\n\n .progress-container {\n width: 335px;\n text-align: center;\n }\n\n .progress-border {\n position: relative;\n height: 26px;\n margin: 0px;\n border: 2px solid white;\n color: #fff;\n background-color: black;\n border-radius: 10px;\n overflow: hidden;\n }\n\n .progress-bar {\n position: relative;\n height: 26px;\n color: #fff;\n }\n\n .progress-label {\n position: absolute;\n top: 50%;\n transform: translateY(-50%);\n width: 100%;\n font: 12px Montserrat;\n color: white;\n text-shadow: inherit;\n }\n </style>\n</head>\n\n<body>\n <div class="logo">\n <svg width="24" height="28" viewBox="0 0 24 28" xmlns="http://www.w3.org/2000/svg">\n <g>\n <path d="M14 12L24 0L12 10L0 0L10 12L12 28L14 12Z" fill="white" />\n </g>\n </svg>\n </div>\n {% if isECU then %}\n <div class="throttle ecuColor">ECU Active</div>\n {% else %}\n <div class="throttle throttleColor">{{throttle}}</div>\n {% end %}\n <div class="progress-container">\n {%\n for _, t in ipairs({ { t = "atmo", c = "#022966ff"}, { t = "space", c = "#616102ff"}, { t = "rocket", c =\n "#02A9BF"}\n })\n do\n\n local color = t.c\n local byType = fuelByType[t.t]\n\n if byType then\n local topMargin = 15\n for _, curr in ipairs(byType) do\n local percent = round(curr.percent, 1)\n %}\n <div class="progress-border" style="margin-top: {{topMargin - 2}}px;">\n <div class="progress-bar" style="width: {{percent}}%; background-color: {{t.c}};">\n </div>\n <div class="progress-label">\n <span style="float: left; margin-left: 10px;">{{curr.name}}</span>\n <span style="float: right; margin-right: 10px;">{{percent}} %</span>\n </div>\n </div>\n {%\n topMargin = 0\n end\n end\n end %}\n </div>\n</body>\n\n</html>'local h=0.3;local i={}i.__index=i;function i.New()local j={}local k={}local l={}local m=system.getItem(unit.getItemId())local n=m.displayNameWithSize:lower():match("emergency")system.showScreen(true)Task.New("HUD",function()local o=f(g,{log=b,tostring=tostring,round=e.Round},function(p,q)b.Error("Error compiling template: ",q)end)local r=Stopwatch.New()r.Start()while true do if r.Elapsed()>h then r.Restart()local s=o({throttle=player.isFrozen()and string.format("Throttle: %0.0f%% (Manual Control)",d.Throttle()*100)or"Automatic Control",fuelByType=l,isECU=n})system.setScreen(s)end;coroutine.yield()end end).Catch(function(t)b.Error(t.Name()," ",t.Error())end)c.RegisterTable("FlightData",function(u,v)k=v end)c.RegisterTable("FuelByType",function(u,v)l=v end)return setmetatable(j,i)end;return i

      end)

      package.preload['YFS:../e/lib/src/panel/ValueWidget.lua']=(function()

      local a={}a.__index=a;function a.New(b,c,d)local e={panelId=b,title=c,unit=d,widgetId=system.createWidget(b,"value"),dataId=nil,newValue=nil}if e.widgetId==nil then system.print("Could not create widget!")d.exit()end;function e.Close()system.removeDataFromWidget(e.dataId,e.widgetId)system.destroyData(e.dataId)system.destroyWidget(e.widgetId)end;function e.Set(f)e.newValue=tostring(f)end;function e.Update()if e.newValue~=nil then local g='{ "label":"'..e.title..'", "value": "'..e.newValue..'", "unit": "'..e.unit..'"}'if e.dataId==nil then system.destroyData(e.dataId)e.dataId=system.createData(g)system.addDataToWidget(e.dataId,e.widgetId)else system.updateData(e.dataId,g)end;e.newValue=nil end end;function e.WidgetId()return e.widgetId end;setmetatable(e,a)return e end;return a

      end)

      package.preload['YFS:../e/lib/src/panel/Panel.lua']=(function()

      local a=require('YFS:../e/lib/src/panel/ValueWidget.lua')local b={}b.__index=b;function b.New(c)local d={panelId=system.createWidgetPanel(c),widgets={},updateHandlerId=nil}function d.Close()system:clearEvent("update",d.updateHandlerId)d.Clear()system.destroyWidgetPanel(d.panelId)end;function d.Clear()for e,f in pairs(d.widgets)do f:Close()end;d.widgets={}end;function d.CreateValue(g,h)local i=a.New(d.panelId,g or"",h or"")d.widgets[i.WidgetId()]=i;return i end;function d.Update()for e,f in pairs(d.widgets)do f.Update()end end;d.updateHandlerId=system:onEvent("onUpdate",d.Update,d)return setmetatable(d,b)end;return b

      end)

      package.preload['YFS:../e/lib/src/panel/SharedPanel.lua']=(function()

      local a=require('YFS:../e/lib/src/panel/Panel.lua')local b=nil;local c={}c.__index=c;function c.Instance()if b then return b end;local d={}local e={}function d.Close(f)local g=e[f]if g~=nil then g:Close()e[f]=nil end end;function d.Get(f)if e[f]==nil then e[f]=a.New(f)end;return e[f]end;b=setmetatable(d,c)return d end;return c

      end)

      package.preload['YFS:info/InfoCentral.lua']=(function()

      local a=require('YFS:Singletons.lua')local b,c,d,e=a.pub,a.calc,require('YFS:../e/lib/src/panel/SharedPanel.lua').Instance(),string.format;local f={}f.__index=f;local g;function f.Instance()if g then return g end;local a={}local h={visible=false,panel=nil,wDeceleration=nil,wCurrentDec=nil,wPid=nil}local i={visible=false,targetSpeed=0,wStateName=nil,wPointDistance=nil,wAcceleration=nil,wCtrlAcceleration=nil,wTargetSpeed=nil,wFinalSpeed=nil,wSpeedDiff=nil,wBrakeMaxSpeed=nil,wPid=nil,wDistToAtmo=nil,wSpeed=nil,wAdjTowards=nil,wAdjDist=nil,wAdjAcc=nil,wAdjBrakeDistance=nil,wAdjSpeed=nil}local j={visible=false,panel=nil,wAdjTowards=nil,wAdjDist=nil,wAdjAcc=nil,wAdjBrakeDistance=nil,wAdjSpeed=nil}local k={visible=false,pitchPanels=nil,rollPanels=nil,yawPanels=nil}local l={visible=false,wDistance=nil,wMargin=nil,wFinalSpeed=nil,wMaxSpeed=nil}b.RegisterBool("ShowInfoWidgets",function(m,n)h.visible=n;i.visible=n;j.visible=n;k.visible=n;l.visible=n;if n then unit.showWidget()else unit.hideWidget()end;system.showHelper(n)end)unit.hideWidget()system.showHelper(false)b.RegisterTable("BrakeData",function(o,n)if not h.panel and h.visible then local p=d.Get("Brake")h.panel=p;h.wMaxDeceleration=p.CreateValue("Max deceleration","m/s2")h.wCurrentDec=p.CreateValue("Brake dec.","m/s2")h.wPid=p.CreateValue("Pid")h.wAutoBrakeAngle=p.CreateValue("Auto brake angle")elseif h.panel and not h.visible then d.Close("Brake")h.panel=nil end;if h.panel then h.wMaxDeceleration.Set(c.Round(n.maxDeceleration,2))h.wCurrentDec.Set(c.Round(n.currentDeceleration,2))h.wPid.Set(c.Round(n.pid,4))h.wAutoBrakeAngle.Set(e("%.1f/%.1f",n.autoBrakeAngle,n.setAutoBrakeAngle))end end)b.RegisterTable("FlightData",function(o,n)if not i.panel and i.visible then local p=d.Get("Movement")i.panel=p;i.wStateName=p.CreateValue("State","")i.wPointDistance=p.CreateValue("Point dist.","m")i.wAcceleration=p.CreateValue("Acceleration","m/s2")i.wCtrlAcceleration=p.CreateValue("Ctrl. acc.","m/s2")i.wTargetSpeed=p.CreateValue("Target speed")i.wFinalSpeed=p.CreateValue("Final speed")i.wSpeedDiff=p.CreateValue("Speed diff","km/h")i.wBrakeMaxSpeed=p.CreateValue("Brake Max Speed","km/h")i.wPid=p.CreateValue("Pid")i.wDistToAtmo=p.CreateValue("Atmo dist.","m")i.wSpeed=p.CreateValue("Abs. speed","km/h")elseif h.panel and not h.visible then d.Close("Movement")i.panel=nil end;if i.panel then i.wStateName.Set(n.fsmState)i.wPointDistance.Set(c.Round(n.waypointDist,2))i.wAcceleration.Set(e("%.1f",n.acceleration))i.wCtrlAcceleration.Set(e("%.1f",n.controlAcc))i.wTargetSpeed.Set(e("%.1f (%s)",c.Mps2Kph(n.targetSpeed),n.targetSpeedReason))i.wFinalSpeed.Set(e("%.1f km/h in %.1f m",c.Mps2Kph(n.finalSpeed),n.finalSpeedDistance))i.wSpeedDiff.Set(c.Round(c.Mps2Kph(n.speedDiff),1))i.wBrakeMaxSpeed.Set(c.Round(c.Mps2Kph(n.brakeMaxSpeed)))i.wPid.Set(c.Round(n.pid,4))i.wDistToAtmo.Set(c.Round(n.distanceToAtmo,1))i.wSpeed.Set(c.Round(c.Mps2Kph(n.absSpeed),1))end end)b.RegisterTable("AdjustmentData",function(o,n)if not j.panel and j.visible then local p=d.Get("Adjustment")j.panel=p;j.wLong=p.CreateValue("Long","m")j.wLat=p.CreateValue("Lat","m")j.wVert=p.CreateValue("Vert","m")elseif j.panel and not j.visible then d.Close("Adjustment")j.panel=nil end;if j.panel then j.wLong.Set(c.Round(n.long,2))j.wLat.Set(c.Round(n.lat,2))j.wVert.Set(c.Round(n.ver,2))end end)local function q(p,r,s)r.wTitle=p.CreateValue("Axis")r.wTitle.Set(s)r.wSpeed=p.CreateValue("Speed","°/s")r.wAcceleration=p.CreateValue("Acc.","°/s2")r.wOffset=p.CreateValue("Offset","°")end;local function t()if not k.pitchPanels and k.visible then local p=d.Get("Rotation")k.panel=p;k.pitchPanels={}q(p,k.pitchPanels,"--- Pitch ---")k.rollPanels={}q(p,k.rollPanels,"--- Roll ---")k.yawPanels={}q(p,k.yawPanels,"--- Yaw ---")elseif k.pitchPanels and not k.visible then d.Close("Rotation")j.pitchPanels=nil;j.rollPanels=nil;j.yawPanels=nil end end;local function u(p,n)p.wSpeed.Set(c.Round(n.speed,2))p.wAcceleration.Set(c.Round(n.acceleration,2))p.wOffset.Set(c.Round(n.offset,2))end;b.RegisterTable("PitchData",function(o,n)k.pitch=n;t()if k.panel then local p=k.pitchPanels;if p~=nil then u(p,n)end end end)b.RegisterTable("RollData",function(o,n)k.roll=n;t()if k.panel then local p=k.rollPanels;if p~=nil then u(p,n)end end end)b.RegisterTable("YawData",function(o,n)k.pitch=n;t()if k.panel then local p=k.yawPanels;if p~=nil then u(p,n)end end end)b.RegisterTable("WaypointData",function(o,v)if not l.panel and l.visible then local p=d.Get("Waypoint")l.panel=p;l.wDistance=p.CreateValue("Distance","m")l.wMargin=p.CreateValue("Margin","m")l.wFinalSpeed=p.CreateValue("Final speed","km/h")l.wMaxSpeed=p.CreateValue("Max speed","km/h")elseif l.panel and not l.visible then d.Close("Waypoint")l.panel=nil end;if l.panel then l.wDistance.Set(c.Round(v.DistanceTo(),3))l.wMargin.Set(c.Round(v.Margin(),3))l.wFinalSpeed.Set(c.Round(c.Kph2Mps(v.FinalSpeed()),1))l.wMaxSpeed.Set(c.Round(c.Kph2Mps(v.MaxSpeed()),1))end end)g=setmetatable(a,f)return g end;return f

      end)

      package.preload['YFS:controller/Wsad.lua']=(function()

      require('YFS:GlobalTypes.lua')local a=require('YFS:Singletons.lua')local b,c,d,e,f,g,h,i,j,k=a.log,a.universe,a.input,a.pub,a.gateCtrl,a.constants,a.calc,a.keys,a.floorDetector,a.gateCtrl;local l=c.VerticalReferenceVector;local m=h.Sign;local n=function()return not IsFrozen()end;local o=h.Clamp;local p=g.flight.defaultMargin;local q={}q.__index=q;function q.New(r,s,t,u)local a={}local v=t.Number("turnAngle")local w=0;local x=0;local y=0;local z=0;local A=Vec3.zero;local B=false;local C=false;local D=false;local E=0;local F=Plane.NewByVertialReference()local G=Vec3.zero;local H=false;local I=t.Boolean("allowForwardToggle")t.Callback("allowForwardToggle",function(J)I=J end)local function K()return H and I end;d.SetThrottle(1)local L=t.Get("throttleStep",g.flight.throttleStep)/100;d.SetThrottleStep(L)t.Callback("throttleStep",function(M)d.SetThrottleStep(M/100)end)local function N()if unit.isMouseControlActivated()or unit.isMouseDirectControlActivated()or unit.isMouseVirtualJoystickActivated()then b.Error("Must use control scheme 'Keyboard'")unit.exit()end end;N()local function O()if not u.AllowsManualControl()then b.Error("Manual control not authorized")return end;player.freeze(true)b.Info("Manual control enabled, auto shutdown disabled.")end;local function P()if IsFrozen()then player.freeze(false)b.Info("Manual control disabled, auto shutdown enabled.")else O()end end;local function Q()return MaxSpeed()*d.Throttle()end;local function R()local S=Current()local T=c.ClosestBody(S)return(S-T.Geography.Center):Len()end;local function U()w=R()C=true end;local function V(T)local S=Current()local W=50;local X=(F.Forward()*(K()and 1 or y)+F.Right()*z+F.Up()*x):Normalize()if T:IsInAtmo(S)and x==0 then if C and Velocity():ProjectOn(-l()):Len()<0.5 then w=R()C=false end;local Y=S+X*W;local Z=T.Geography.Center;return Z+(Y-Z):NormalizeInPlace()*w end;return Current()+X*W end;Task.New("WASD",function()local _=0.1;local a0=Stopwatch.New()a0.Start()local a1=false;e.RegisterBool("ResetWSAD",function(a2,a2)G=Vec3.zero;a1=false;A=Vec3.zero;H=false end)e.RegisterTable("ForwardDirectionChanged",function(a2,a3)A=a3 end)e.RegisterTable("YawData",function(a2,a3)if D then if m(a3.speed)~=E then s.AlignTo(Current()+F.Forward()*1000)D=false end end;E=m(a3.speed)end)U()while true do local S=Current()local T=c.ClosestBody(S)local a4=B;a1=K()or y~=0 or x~=0 or z~=0;if not a1 and B then G=Current()end;if IsFrozen()then if a1 then f.Enable(false)if A:IsZero()then A=F.Forward()end;if a0.Elapsed()>_ or B then a0.Restart()local a5=Q()local a6=V(T)s.GotoTarget(a6,A,p,a5,a5,true,true)end else if B then s.GotoTarget(G,A,p,0,construct.getMaxSpeed(),true,true)elseif not G:IsZero()and Velocity():Normalize():Dot(G-S)>=0 then local a7=p;s.GotoTarget(Current(),A,a7,h.Kph2Mps(2),0,false,true)G=Vec3.zero end end else d.SetThrottle(1)end;if a4 then B=false end;coroutine.yield()end end)local function a8(a3,a9)H=false;local aa=a3;a3=o(a3+a9,-1,1)if a3==0 then U()end;B=a3~=aa;f.Enable(false)return a3 end;local function ab(a9)x=a8(x,a9)end;local function ac(a9)y=a8(y,a9)end;local function ad(a9)z=a8(z,a9)end;local function ae()return Criteria.New().IgnoreLCtrl().IgnoreLShift()end;local function af()ac(1)end;local function ag()ac(-1)end;d.Register(i.forward,ae().OnRepeat(),af)d.Register(i.forward,ae().OnRelease(),ag)d.Register(i.backward,ae().OnRepeat(),ag)d.Register(i.backward,ae().OnRelease(),af)local function ah()ad(-1)end;local function ai()ad(1)end;d.RegisterMany({i.strafeleft,i.left},ae().OnRepeat(),ah)d.RegisterMany({i.strafeleft,i.left},ae().OnRelease(),ai)d.RegisterMany({i.straferight,i.right},ae().OnRepeat(),ai)d.RegisterMany({i.straferight,i.right},ae().OnRelease(),ah)local function aj()ab(1)end;local function ak()ab(-1)end;d.Register(i.up,ae().OnRepeat(),aj)d.Register(i.up,ae().OnRelease(),ak)d.Register(i.down,ae().OnRepeat(),ak)d.Register(i.down,ae().OnRelease(),aj)local function al(am)if n()then return end;A=s.Turn(am and v or-v,F.Up())end;d.Register(i.yawleft,ae().OnRepeat(),function()al(true)end)d.Register(i.yawright,ae().OnRepeat(),function()al(false)end)d.RegisterMany({i.yawleft,i.yawright},ae().OnRelease(),function()if n()then return end;D=true end)local function an(ao)if n()then return end;r.SetBooster(ao)end;d.Register(i.brake,Criteria.New().LCtrl().OnPress(),function()H=false;B=true;A=F.Forward()G=Current()end)d.Register(i.booster,ae().OnPress(),function()an(true)end)d.Register(i.booster,ae().OnRelease(),function()an(false)end)d.Register(i.option9,Criteria.New().LShift().OnPress(),P)d.Register(i.stopengines,ae().OnPress(),function()if n()then return end;H=not H;B=true end)if t.Get("manualControlOnStartup",false)then b.Info("Manual control on startup active.")O()end;t.Callback("turnAngle",function(ap)v=ap end)return setmetatable(a,q)end;return q

      end)

      package.preload['YFS:Access.lua']=(function()

      local a=require('YFS:Singletons.lua')local b,c=a.log,a.strUtil;local d={}d.__index=d;local e;function d.New(f,g)if e then return e end;local a={}local h,i,j,k="allowedRoutes","allowManualControl","orgAdmin","adminList"local function l()return construct.getOwner()end;local function m()return l().isOrganization end;local function n()return m()and f.Boolean(j,true)end;local function o()local p=l()if p.isOrganization then for q,r in ipairs(player.getOrgIds())do if r==p.id then return true end end end;return false end;local function s()local p=l()return not p.isOrganization and p.id==player.getId()end;local function t()local u,v=player.getName(),f.Get(k,{})for w,q in pairs(v)do if w==u then return true end end;return false end;local function x()return s()or m()and o()and n()or t()end;if x()then b.Info(player.getName()," is an admin")end;function a.CanExecute(y)return x()or c.StartsWith(y,"route-activate")end;function a.AllowsManualControl()return x()or f.Boolean(i,false)end;function a.AllowRoute(z)local A=f.Get(h,{})A[z]=true;f.Put(h,A or{})end;function a.DisallowRoute(z)local A=f.Get(h,{})A[z]=nil;f.Put(h,A or{})end;function a.MayStartRoute(z)local A=f.Get(h,{})local B=A and A[z]~=nil or x()if not B then b.Error("Not authorized to start route '",z,"'")end;return B end;e=setmetatable(a,d)g.Accept("allow-route",function(C)a.AllowRoute(C.commandValue)end).AsString().Must()g.Accept("disallow-route",function(C)a.DisallowRoute(C.commandValue)end).AsString().Must()g.Accept("print-allowed-routes",function(q)local D=f.Get(h,{})if TableLen(D)>0 then b.Info("Allowed routes:")for w,r in pairs(D)do b.Info(w)end else b.Info("No allowed routes")end end).AsEmpty()g.Accept("allow-manual-control",function(C)f.Put(i,true)end)g.Accept("disallow-manual-control",function(C)f.Put(i,false)end)local function E()local p=l()if not p.isOrganization then b.Error("Owner is not an organization")return false end;return true end;g.Accept("allow-org-admin",function(C)if E()then f.Put(j,true)b.Info("Owning organization is now considered an admin")end end)g.Accept("disallow-org-admin",function(C)if not E()then return end;if not t()then b.Error("Removing the orginaization as an admin would lock yourself out since you're not in the admin list, aborting!")return end;f.Put(j,false)b.Info("Owning organization is no longer considered an admin")end)local function F(u,G)local v=f.Get(k,{})local H=v[u]~=nil;v[u]=G or nil;f.Put(k,v)if G then b.Info(u," added to admin list")elseif H then b.Info(u," removed from admin list")else b.Error(u," is not in the admin list")end end;g.Accept("add-admin",function(C)F(C.commandValue,true)end).AsString().Must()g.Accept("remove-admin",function(C)local I=o()and n()local J=t()if C.commandValue==player.getName()then if not(I and J)then b.Error("Removing yourself as an admin would lock yourself out, aborting!")return end end;F(C.commandValue)end).AsString().Must()g.Accept("print-admins",function(q)local v=f.Get(k,{})if TableLen(v)>0 then b.Info("Admins:")for w,r in pairs(v)do b.Info(w)end else b.Info("No named admins")end;if n()then b.Info("Members of owning orgs are all admins")end end)return e end;return d

      end)

      package.preload['YFS:flight/GeoFence.lua']=(function()

      require('YFS:../e/lib/src/abstraction/Vehicle.lua')local a=require('YFS:Singletons.lua')local b,c,d=a.log,a.universe,require('YFS:../e/lib/src/math/Vec3.lua')local e={}e.__index=e;function e.New(f,g)local a={}local h=d.zero;local i={enabled=false,centerPos="",boundary=0}local j="geofence"local function k()local l=f.Get(j)if l then i.boundary=l.boundary;i.centerPos=l.centerPos;i.enabled=l.enabled;if i.centerPos~=nil and i.centerPos~=""then h=c.ParsePosition(i.centerPos).Coordinates()end;i.boundary=i.boundary or 150 end end;local function m()f.Put(j,i)local l=c.ParsePosition(i.centerPos)if l then h=l.Coordinates()end end;local n=g.Accept("geofence",function(o)if o.boundary<=0 then b.Error("Boundary must be > 0")return end;local l=c.ParsePosition(o.commandValue)if l then i.centerPos=l.AsPosString()i.boundary=o.boundary;i.enabled=true;m()h=l.Coordinates()end end).AsString().Must()n.Option("boundary").AsNumber().Must()g.Accept("disable-geofence",function()i.enabled=false;m()end)g.Accept("print-geofence",function(o)b.Info(i)end)function a.Limited(p)if i.enabled and i.centerPos~=nil and i.centerPos~=""then local q=Current()local r,s=(h-q):NormalizeLen()return s>i.boundary and r:Dot(p)<0 end;return false end;function a.Center()return h end;k()return setmetatable(a,e)end;return e

      end)

      package.preload['YFS:Start.lua']=(function()

      require('YFS:GlobalTypes.lua')local a=require('YFS:Singletons.lua')local b,c,d,e,f,g=a.pub,a.input,a.commandLine,a.log,a.radar,a.floorDetector;local h,i,j,k,l,m,n,o,p,q,r,s,t,u=require('YFS:controller/ControlCommands.lua'),require('YFS:flight/route/RouteController.lua'),require('YFS:../e/lib/src/storage/BufferedDB.lua'),require('YFS:info/Fuel.lua'),require('YFS:flight/FlightFSM.lua'),require('YFS:flight/FlightCore.lua'),require('YFS:controller/ScreenController.lua'),require('YFS:controller/Communication.lua'),require('YFS:Settings.lua'),require('YFS:hud/Hud.lua'),require('YFS:info/InfoCentral.lua'),require('YFS:controller/Wsad.lua'),require('YFS:Access.lua'),require('YFS:flight/GeoFence.lua')local function v(w)e.SetLevel(LVL.WARNING)local x="Routes"local y=library.getLinkByName(x)if not y then e.Error("Must link a databank named '",x,"'")unit.exit()return end;local z="Settings"local A=library.getLinkByName(z)if not A then e.Info("No DB named '",z,"' linked falling back to route DB.")A=y end;if w then e.Info("Running as ECU")end;local B=j.New(A)local C=j.New(y)local D=p.Create(B)local E;local F;local G;local H;local I;local J;local K=library.getLinkByName("FollowRemote")if K and(type(K.activate)~="function"or type(K.deactivate)~="function")then K=nil end;if K then e.Info("Found FollowRemote switch")K.activate()unit:onEvent("onStop",function()K.deactivate()end)end;Task.New("Main",function()B.BeginLoad()C.BeginLoad()while not B.IsLoaded()or not C.IsLoaded()do coroutine.yield()end;local L=t.New(B,d)d.SetAccess(L.CanExecute)local M=i.Instance(C)local N=l.New(D,M,u.New(B,d))local O=m.New(M,N)N.SetFlightCore(O)if not w then H=n.New(O,D)F=s.New(N,O,D,L)end;G=h.New(c,d,O,D,H,L,C)D.Reload()O.ReceiveEvents()local P=g.Measure()if not P.Hit or P.Distance>D.Get("autoShutdownFloorDistance")then e.Info("No floor detected within set limit during startup, holding postition.")M.ActivateHoldRoute()O.StartFlight()elseif w then e.Info("Floor detected, shutting down")unit.exit()else N.SetState(Idle.New(N))end;I=k.New(D)J=r.Instance()E=q.New()G.RegisterMoveCommands()G.RegisterCommonCommands(w)if not w then G.RegisterRouteCommands()f.Show(D.Boolean("showRadarOnStart"))f.Sort(D.Number("defaultRadarMode"))D.Callback("defaultRadarMode",function(Q)f.Sort(Q)end)end;b.Publish("ShowInfoWidgets",D.Boolean("showWidgetsOnStart",false))local R=D.String("commChannel")local S;if not w and R~=""then S=o.New(R)end end).Catch(function(T)e.Error(T.Name(),T.Error())end)Task.New("FloorMonitor",function()if g.Present()then e.Info("FloorMonitor started")local U=Stopwatch.New()U.Start()while true do coroutine.yield()if U.Elapsed()>0.3 then U.Restart()b.Publish("FloorMonitor",g.Measure())end end end end).Then(function(...)e.Info("Auto shutdown disabled")end).Catch(function(T)e.Error(T.Name(),T.Error())end)end;return v

      end)

      package.preload['YFS:variants/Limited.lua']=(function()

      require('YFS:GlobalTypes.lua')local a=require('YFS:../e/lib/src/debug/Log.lua').Instance()local b=require('YFS:../e/lib/src/element/Lock.lua')local c=require('YFS:version_out.lua')local d,e=require('YFS:variants/CoreLinkCheck.lua')()local f={}f.__index=f;function f.New()local g={}local h=b.New()function g.Start()a.Info(c.APP_NAME)a.Info(c.APP_VERSION)if d then local i=require('YFS:Start.lua')i(e)Task.New("Lock",function()if h.ValidateCo()then a.Info("Engine check passed")else error("Engine check failed")end end).Catch(function(j)unit.exit()end)else unit.exit()end end;function g.AddLimit(k,l,m)h.AddLimit(k,l,m)end;return setmetatable(g,f)end;return f

      end)
  - key: 4
    filter:
      slotKey: -5
      signature: onStart()
      args: []
    code: |-
      library.addEventHandlers(library)
      library.addEventHandlers(system)
      library.addEventHandlers(player)
      library.addEventHandlers(construct)
      library.addEventHandlers(unit)
      library.addEventHandlers(receiver)
      library.addEventHandlers(spaceRadar)
      library.addEventHandlers(atmoRadar)
  - key: 5
    filter:
      slotKey: -4
      signature: onActionStart(action)
      args:
        - variable: "*"
    code: system:triggerEvent('onActionStart',action)
  - key: 6
    filter:
      slotKey: -4
      signature: onActionLoop(action)
      args:
        - variable: "*"
    code: system:triggerEvent('onActionLoop',action)
  - key: 7
    filter:
      slotKey: -4
      signature: onActionStop(action)
      args:
        - variable: "*"
    code: system:triggerEvent('onActionStop',action)
  - key: 8
    filter:
      slotKey: -4
      signature: onUpdate()
      args: []
    code: system:triggerEvent('onUpdate')
  - key: 9
    filter:
      slotKey: -4
      signature: onFlush()
      args: []
    code: system:triggerEvent('onFlush')
  - key: 10
    filter:
      slotKey: -4
      signature: onInputText(text)
      args:
        - variable: "*"
    code: system:triggerEvent('onInputText',text)
  - key: 11
    filter:
      slotKey: -4
      signature: onCameraChanged(mode)
      args:
        - variable: "*"
    code: system:triggerEvent('onCameraChanged',mode)
  - key: 12
    filter:
      slotKey: -3
      signature: onParentChanged(oldId,newId)
      args:
        - variable: "*"
        - variable: "*"
    code: player:triggerEvent('onParentChanged',oldId,newId)
  - key: 13
    filter:
      slotKey: -2
      signature: onDocked(id)
      args:
        - variable: "*"
    code: construct:triggerEvent('onDocked',id)
  - key: 14
    filter:
      slotKey: -2
      signature: onUndocked(id)
      args:
        - variable: "*"
    code: construct:triggerEvent('onUndocked',id)
  - key: 15
    filter:
      slotKey: -2
      signature: onPlayerBoarded(id)
      args:
        - variable: "*"
    code: construct:triggerEvent('onPlayerBoarded',id)
  - key: 16
    filter:
      slotKey: -2
      signature: onVRStationEntered(id)
      args:
        - variable: "*"
    code: construct:triggerEvent('onVRStationEntered',id)
  - key: 17
    filter:
      slotKey: -2
      signature: onConstructDocked(id)
      args:
        - variable: "*"
    code: construct:triggerEvent('onConstructDocked',id)
  - key: 18
    filter:
      slotKey: -2
      signature: onPvPTimer(active)
      args:
        - variable: "*"
    code: construct:triggerEvent('onPvPTimer',active)
  - key: 19
    filter:
      slotKey: -1
      signature: onStop()
      args: []
    code: unit:triggerEvent('onStop')
  - key: 20
    filter:
      slotKey: -1
      signature: onTimer(timerId)
      args:
        - variable: "*"
    code: unit:triggerEvent('onTimer',timerId)
  - key: 21
    filter:
      slotKey: 0
      signature: onReceived(channel,message)
      args:
        - variable: "*"
        - variable: "*"
    code: receiver:triggerEvent('onReceived',channel,message)
  - key: 22
    filter:
      slotKey: 1
      signature: onEnter(id)
      args:
        - variable: "*"
    code: spaceRadar:triggerEvent('onEnter',id)
  - key: 23
    filter:
      slotKey: 1
      signature: onLeave(id)
      args:
        - variable: "*"
    code: spaceRadar:triggerEvent('onLeave',id)
  - key: 24
    filter:
      slotKey: 1
      signature: onIdentified(id)
      args:
        - variable: "*"
    code: spaceRadar:triggerEvent('onIdentified',id)
  - key: 25
    filter:
      slotKey: 2
      signature: onEnter(id)
      args:
        - variable: "*"
    code: atmoRadar:triggerEvent('onEnter',id)
  - key: 26
    filter:
      slotKey: 2
      signature: onLeave(id)
      args:
        - variable: "*"
    code: atmoRadar:triggerEvent('onLeave',id)
  - key: 27
    filter:
      slotKey: 2
      signature: onIdentified(id)
      args:
        - variable: "*"
    code: atmoRadar:triggerEvent('onIdentified',id)
  - key: 28
    filter:
      slotKey: -1
      signature: onStart()
      args: []
    code: local
      a=require('YFS:variants/Limited.lua').New()a.AddLimit(EngineType.ATMO,EngineSize.XS,10)a.Start()
events: []
methods: []
